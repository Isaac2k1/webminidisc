(this.webpackJsonpwebmd=this.webpackJsonpwebmd||[]).push([[0],{230:function(e,t,a){e.exports=a.p+"static/media/chrome-icon.f3b6c54c.svg"},259:function(e,t,a){e.exports=a(426)},282:function(e,t){},284:function(e,t){},317:function(e,t){},318:function(e,t){},410:function(e,t,a){},425:function(e,t,a){e.exports=function(){return new Worker(a.p+"ba79c8f0cad9f62107a2.worker.js")}},426:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(14),l=a.n(i),o=a(17);const c=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function s(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const a=e.installing;null!=a&&(a.onstatechange=()=>{console.log("state change",a.state),"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})},e.update()}).catch(e=>{console.error("Error during service worker registration:",e)})}var d=a(18),m=a(224);function u(e){return new Promise(t=>{setTimeout(t,e)})}async function p(e,t){let a=1,n=setInterval(()=>{a++,t(Math.min(100,1e3*a/e*100))},1e3);await u(e),window.clearInterval(n)}function g(e){return Object(o.d)(e,o.b)}function b(e){return`/webminidisc/${e}`}function h(e,t){localStorage.setItem(e,JSON.stringify(t))}function f(e,t){let a=localStorage.getItem(e);if(null===a)return t;try{return JSON.parse(a)}catch(n){return t}}function v(e){return e.normalize("NFD").replace(/[^\x00-\x7F]/g,"")}const E=a(384);var w={},y=a(38),k=a(19),C=a(15);const x=Object(k.b)({name:"uploadDialog",initialState:{visible:!1,writtenProgress:0,encryptedProgress:0,totalProgress:1,trackTotal:1,trackConverting:0,trackCurrent:0,titleCurrent:"",titleConverting:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setWriteProgress:(e,t)=>{e.encryptedProgress=t.payload.encrypted,e.writtenProgress=t.payload.written,e.totalProgress=t.payload.total},setTrackProgress:(e,t)=>{e.trackTotal=t.payload.total,e.trackCurrent=t.payload.current,e.trackConverting=t.payload.converting,e.titleCurrent=t.payload.titleCurrent,e.titleConverting=t.payload.titleConverting}}}),{reducer:S,actions:j}=x;var O=Object(C.enableBatching)(S);const T=Object(k.b)({name:"renameDialog",initialState:{visible:!1,title:"",index:-1},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setCurrentName:(e,t)=>{e.title=t.payload},setIndex:(e,t)=>{e.index=t.payload}}}),{reducer:D,actions:N}=T;var P=Object(C.enableBatching)(D);const F={visible:!1,error:""},M=Object(k.b)({name:"errorDialog",initialState:F,reducers:{setVisible:(e,t)=>{e.visible=t.payload},setErrorMessage:(e,t)=>{e.error=`${t.payload}`}}}),{actions:I,reducer:W}=M;var L=Object(C.enableBatching)(W);const R=Object(k.b)({name:"panicDialog",initialState:{visible:!1,dismissed:!1},reducers:{setVisible:(e,t)=>{e.visible=t.payload},dismiss:(e,t)=>{e.visible=!1,e.dismissed=!0}}}),{actions:A,reducer:B}=R;var $=Object(C.enableBatching)(B);const V={visible:!1,format:"LP2",titleSource:f("trackTitleSource","file"),titleFormat:f("trackTitleFormat","title")},U=Object(k.b)({name:"convertDialog",initialState:V,reducers:{setVisible:(e,t)=>{e.visible=t.payload},setFormat:(e,t)=>{e.format=t.payload},setTitleSource:(e,t)=>{e.titleSource=t.payload,h("trackTitleSource",e.titleSource)},setTitleFormat:(e,t)=>{e.titleFormat=t.payload,h("trackTitleFormat",e.titleFormat)}}}),{actions:z,reducer:_}=U;var G=Object(C.enableBatching)(_);const J=Object(k.b)({name:"dumpDialog",initialState:{visible:!1,inputDeviceId:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setInputDeviceId:(e,t)=>{e.inputDeviceId=t.payload}}}),{reducer:H,actions:Y}=J;var q=Object(C.enableBatching)(H);const K=Object(k.b)({name:"recordDialog",initialState:{visible:!1,trackTotal:1,trackDone:0,trackCurrent:0,titleCurrent:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setProgress:(e,t)=>{e.trackTotal=t.payload.trackTotal,e.trackDone=t.payload.trackDone,e.trackCurrent=t.payload.trackCurrent,e.titleCurrent=t.payload.titleCurrent}}}),{reducer:Q,actions:X}=K;var Z=Object(C.enableBatching)(Q);const ee={mainView:"WELCOME",loading:!1,pairingFailed:!1,pairingMessage:"",browserSupported:!0,darkMode:f("darkMode",!1),aboutDialogVisible:!1},te=Object(k.b)({name:"app",initialState:ee,reducers:{setState:(e,t)=>{e.mainView=t.payload},setLoading:(e,t)=>{e.loading=t.payload},setPairingFailed:(e,t)=>{e.pairingFailed=t.payload},setPairingMessage:(e,t)=>{e.pairingMessage=t.payload},setBrowserSupported:(e,t)=>{e.browserSupported=t.payload},setDarkMode:(e,t)=>{e.darkMode=t.payload,h("darkMode",e.darkMode)},showAboutDialog:(e,t)=>{e.aboutDialogVisible=t.payload}}}),{reducer:ae,actions:ne}=te;var re=Object(C.enableBatching)(ae);const ie=Object(k.b)({name:"main",initialState:{disc:null,deviceName:""},reducers:{setDisc:(e,t)=>{e.disc=t.payload},setDeviceName:(e,t)=>{e.deviceName=t.payload}}}),{reducer:le,actions:oe}=ie;var ce=Object(C.enableBatching)(le);let se=Object(y.c)({renameDialog:P,uploadDialog:O,errorDialog:L,panicDialog:$,convertDialog:G,dumpDialog:q,recordDialog:Z,appState:re,main:ce});const de=ne.setState.toString(),me=Object(k.a)({reducer:function(...e){const[t,a]=e;return a.type===de&&"WELCOME"===a.payload?ue:se(...e)},middleware:[e=>e=>async t=>{try{await e(t)}catch(a){console.error(a),e(A.setVisible(!0))}},...Object(k.c)()]}),ue=Object.freeze(me.getState());var pe=a(486),ge=a(431),be=a(487),he=a(470),fe=a(242),ve=a(478),Ee=a(225),we=a.n(Ee);function ye(){return async function(e){e(ne.setLoading(!0));let t=await w.netmdService.listContent(),a=await w.netmdService.getDeviceName();e(Object(C.batchActions)([oe.setDisc(t),oe.setDeviceName(a),ne.setLoading(!1)]))}}const ke={SP:d.Wireformat.pcm,LP2:d.Wireformat.lp2,LP105:d.Wireformat.l105kbps,LP4:d.Wireformat.lp4};async function Ce(e,t){const a=await e.arrayBuffer();return await new Promise((e,n)=>{we.a.read(new Blob([a]),{onSuccess:a=>{var n,r,i;const l=null!==(n=a.tags.title)&&void 0!==n?n:"Unknown Title",o=null!==(r=a.tags.artist)&&void 0!==r?r:"Unknown Artist",c=null!==(i=a.tags.album)&&void 0!==i?i:"Unknown Album";switch(t){case"title":e(l);break;case"artist-title":e(`${o} - ${l}`);break;case"album-title":e(`${c} - ${l}`);break;case"artist-album-title":e(`${o} - ${c} - ${l}`)}},onError:e=>{n(e)}})})}function xe(e,t,a,n){return async function(r,i){const{audioExportService:l,netmdService:o}=w,c=ke[t];r(j.setVisible(!0));const s=({written:e,encrypted:t,total:a})=>{r(j.setWriteProgress({written:e,encrypted:t,total:a}))};let m={current:0,converting:0,total:e.length,titleCurrent:"",titleConverting:""};const u=()=>{r(j.setTrackProgress(m))};let p=i().main.disc,g=p?1700-Object(d.getTracks)(p).map(e=>e.title||"").reduce((e,t)=>e+t.length,0):-1;let b;g=Math.floor(g/e.length);let h="",f=1;for await(let d of async function*(e){let a=[],n=0;!function r(){if(n===e.length)return m.converting=n,m.titleConverting="",void u();let i=e[n];m.converting=n,m.titleConverting=i.name,u(),n++,a.push(new Promise(async(e,a)=>{let n;try{await l.prepare(i),n=await l.export({format:t}),r(),e({file:i,data:n})}catch(o){b=o,h=`${i.name}: Unsupported or unrecognized format`,a(o)}}))}();let r=0;for(;r<a.length;)yield await a[r],delete a[r],r++}(e)){const{file:e,data:t}=d;let r=e.name;if("media"===a)try{r=await Ce(e,n)}catch(E){console.error(E)}const i=r.lastIndexOf(".");i>0&&(r=r.substring(0,i)),g>-1&&(r=r.substring(0,g)),m.current=f++,m.titleCurrent=r,u(),s({written:0,encrypted:0,total:100});try{await(null===o||void 0===o?void 0:o.upload(r,t,c,s))}catch(E){b=E,h=`${e.name}: Error uploading to device`;break}}let v=[j.setVisible(!1)];b&&(console.error(b),v=v.concat([I.setVisible(!0),I.setErrorMessage(h)])),r(Object(C.batchActions)(v)),ye()(r)}}var Se=a(467),je=a(158),Oe=a(472),Te=a(473),De=a(492),Ne=a(465),Pe=a(459),Fe=a(466),Me=a(463),Ie=a(464),We=a(462),Le=a(458);const Re=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),Ae=e=>{const t=Object(o.c)();let a=g(e=>e.appState.aboutDialogVisible);return r.a.createElement(Pe.a,{open:a,maxWidth:"sm",fullWidth:!0,TransitionComponent:Re,"aria-labelledby":"about-dialog-slide-title"},r.a.createElement(We.a,{id:"about-dialog-slide-title"},"About Web MiniDisc"),r.a.createElement(Me.a,null,r.a.createElement(Ie.a,null,"Web MiniDisc has been made possible by"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://www.ffmpeg.org/",target:"_blank"},"FFmpeg")," ","and"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://github.com/ffmpegjs/FFmpeg",target:"_blank"},"ffmpegjs"),", to read your audio files (wav, mp3, ogg, mp4, etc...)."),r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://github.com/dcherednik/atracdenc/",target:"_blank"},"Atracdenc"),", to support atrac3 encoding (lp2, lp4 audio formats)."),r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://emscripten.org/",target:"_blank"},"Emscripten"),", to run both FFmpeg and Atracdenc in the browser."),r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://github.com/cybercase/netmd-js",target:"_blank"},"netmd-js"),", to send commands to NetMD devices using Javascript."),r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://github.com/glaubitz/linux-minidisc",target:"_blank"},"linux-minidisc"),", to make the netmd-js project possible."),r.a.createElement("li",null,r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://material-ui.com/",target:"_blank"},"material-ui"),", to build the user interface.")),r.a.createElement(Ie.a,null,"Attribution"),r.a.createElement("ul",null,r.a.createElement("li",null,"MiniDisc logo from"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://en.wikipedia.org/wiki/MiniDisc",target:"_blank"},"https://en.wikipedia.org/wiki/MiniDisc")),r.a.createElement("li",null,"MiniDisc icon from"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://www.deviantart.com/blinkybill/art/Sony-MiniDisc-Plastic-Icon-473812540",target:"_blank"},"http://fav.me/d7u3g3g")))),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:()=>{t(ne.showAboutDialog(!1))}},"Close")))};var Be=a(468),$e=a(244),Ve=a(493),Ue=a(229),ze=a.n(Ue);const _e=function(){const e=Object(o.c)();let{mainView:t}=g(e=>e.appState),a=g(e=>e.main.disc);const[n,i]=r.a.useState(null),l=Boolean(n),c=()=>{i(null)},s=()=>{e((async function(e){if(!window.confirm("Proceed with Wipe Disc? This operation cannot be undone."))return;const{netmdService:t}=w;e(ne.setLoading(!0)),await t.wipeDisc(),ye()(e)})),c()},d=()=>{e(ye()),c()},m=()=>{var t;e(Object(C.batchActions)([N.setVisible(!0),N.setCurrentName(null!==(t=null===a||void 0===a?void 0:a.title)&&void 0!==t?t:""),N.setIndex(-1)])),c()},u=()=>{e(ne.setState("WELCOME")),c()},p=[];return"MAIN"===t&&(p.push(r.a.createElement(Ve.a,{key:"update",onClick:d},"Refresh")),p.push(r.a.createElement(Ve.a,{key:"title",onClick:m},"Rename Disc")),p.push(r.a.createElement(Ve.a,{key:"wipe",onClick:s},"Wipe Disc")),p.push(r.a.createElement(Ve.a,{key:"exit",onClick:u},"Exit"))),p.push(r.a.createElement(Ve.a,{key:"about",onClick:()=>{e(ne.showAboutDialog(!0)),c()}},"About")),p.push(r.a.createElement(Ve.a,{key:"github",onClick:c},r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"https://github.com/cybercase/webminidisc",target:"_blank"},"Fork me on GitHub"))),r.a.createElement(r.a.Fragment,null,r.a.createElement(Be.a,{"aria-label":"actions","aria-controls":"actions-menu","aria-haspopup":"true",onClick:e=>{i(e.currentTarget)}},r.a.createElement(ze.a,null)),r.a.createElement($e.a,{id:"actions-menu",anchorEl:n,keepMounted:!0,open:l,onClose:c},p))};var Ge=a(230),Je=a.n(Ge);const He=Object(he.a)(e=>({main:{position:"relative",flex:"1 1 auto",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},button:{marginTop:e.spacing(3),minWidth:150},spacing:{marginTop:e.spacing(1)},chromeLogo:{marginTop:e.spacing(1),width:96,height:96},why:{alignSelf:"flex-start",marginTop:e.spacing(3)},headBox:{display:"flex",justifyContent:"space-between"}})),Ye=e=>{const t=He(),a=Object(o.c)(),{browserSupported:i,pairingFailed:l,pairingMessage:c}=g(e=>e.appState);c.toLowerCase().match(/denied/);const[s,d]=Object(n.useState)(!1);return r.a.createElement(r.a.Fragment,null,r.a.createElement(De.a,{className:t.headBox},r.a.createElement(je.a,{component:"h1",variant:"h4"},"Web MiniDisc"),r.a.createElement(_e,null)),r.a.createElement(je.a,{component:"h2",variant:"body2"},"Brings NetMD Devices to the Web"),r.a.createElement(De.a,{className:t.main},i?r.a.createElement(r.a.Fragment,null,r.a.createElement(je.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"Press the button to connect to a NetMD device"),r.a.createElement(Se.a,{variant:"contained",color:"primary",onClick:()=>a((async function(e,t){e(ne.setPairingFailed(!1)),await w.audioExportService.init();try{if(await w.netmdService.connect())return void e(ne.setState("MAIN"))}catch(a){console.error(a)}try{if(await w.netmdService.pair())return void e(ne.setState("MAIN"));e(Object(C.batchActions)([ne.setPairingMessage("Connection Failed"),ne.setPairingFailed(!0)]))}catch(a){console.error(a);let t=a.message;e(Object(C.batchActions)([ne.setPairingMessage(t),ne.setPairingFailed(!0)]))}})),className:t.button},"Connect"),r.a.createElement(Oe.a,{error:!0,className:t.spacing,style:{visibility:l?"visible":"hidden"}},r.a.createElement(Te.a,null,c))):r.a.createElement(r.a.Fragment,null,r.a.createElement(je.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"This Web browser is not supported.\xa0",r.a.createElement(Ne.a,{rel:"noopener noreferrer",href:"#",onClick:e=>{e.preventDefault(),d(!0)}},"Learn Why")),r.a.createElement(Ne.a,{rel:"noopener noreferrer",target:"_blank",href:"https://www.google.com/chrome/"},r.a.createElement("img",{alt:"Chrome Logo",src:Je.a,className:t.chromeLogo})),r.a.createElement(je.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"Try using"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",target:"_blank",href:"https://www.google.com/chrome/"},"Chrome")," ","instead"),s?r.a.createElement(r.a.Fragment,null,r.a.createElement(je.a,{component:"p",variant:"body2",className:t.why},"Web MiniDisc requires a browser that supports both"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",target:"_blank",href:"https://wicg.github.io/webusb/"},"WebUSB")," ","and"," ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",target:"_blank",href:"https://webassembly.org/"},"WebAssembly"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"WebUSB is needed to control the NetMD device via the USB connection to your computer."),r.a.createElement("li",null,"WebAssembly is used to convert the music to a MiniDisc compatible format"))):null)),r.a.createElement(Ae,null))};var qe=a(3),Ke=a(243),Qe=a(11),Xe=a(485),Ze=a(239),et=a.n(Ze),tt=a(237),at=a.n(tt),nt=a(238),rt=a.n(nt),it=a(480),lt=a(484),ot=a(483),ct=a(481),st=a(482),dt=a(479),mt=a(490),ut=a(491);const pt=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),gt=e=>{let t=Object(o.c)(),a=g(e=>e.renameDialog.visible),n=g(e=>e.renameDialog.title),i=g(e=>e.renameDialog.index);const l=i<0?"Disc":"Track",c=()=>{t(N.setVisible(!1))},s=()=>{t(i<0?function({newName:e}){return async function(t){const{netmdService:a}=w;await a.renameDisc(e),t(N.setVisible(!1)),ye()(t)}}({newName:n}):function({index:e,newName:t}){return async function(a){const{netmdService:n}=w;a(N.setVisible(!1));try{await n.renameTrack(e,t)}catch(r){console.error(r),a(Object(C.batchActions)([I.setVisible(!0),I.setErrorMessage("Rename failed.")]))}ye()(a)}}({index:i,newName:n}))};return r.a.createElement(Pe.a,{open:a,onClose:c,maxWidth:"sm",fullWidth:!0,TransitionComponent:pt,"aria-labelledby":"rename-dialog-title"},r.a.createElement(We.a,{id:"rename-dialog-title"},"Rename ",l),r.a.createElement(Me.a,null,r.a.createElement(ut.a,{autoFocus:!0,id:"name",label:`${l} Name`,type:"text",fullWidth:!0,value:n,onKeyDown:e=>{"Enter"===e.key&&s()},onChange:e=>{t(N.setCurrentName(e.target.value.substring(0,120)))}})),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:c},"Cancel"),r.a.createElement(Se.a,{color:"primary",onClick:s},"Rename")))};var bt=a(476);const ht=Object(he.a)(e=>({progressPerc:{marginTop:e.spacing(1)},progressBar:{marginTop:e.spacing(3)},uploadLabel:{marginTop:e.spacing(3)}})),ft=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),vt=e=>{const t=ht();let{visible:a,writtenProgress:n,encryptedProgress:i,totalProgress:l,trackTotal:o,trackCurrent:c,trackConverting:s,titleCurrent:d,titleConverting:m}=g(e=>e.uploadDialog),u=Math.floor(n/l*100),p=Math.floor(i/l*100),b=Math.floor(s/o*100);return r.a.createElement(Pe.a,{open:a,maxWidth:"sm",fullWidth:!0,TransitionComponent:ft,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},r.a.createElement(We.a,{id:"alert-dialog-slide-title"},"Recording..."),r.a.createElement(Me.a,null,r.a.createElement(Ie.a,{id:"alert-dialog-slide-description"},100===b&&s===o?"Conversion completed":`Converting ${s+1} of ${o}: ${m}`),r.a.createElement(bt.a,{className:t.progressBar,variant:0===b?"indeterminate":"determinate",color:"primary",value:b}),r.a.createElement(De.a,{className:t.progressPerc},b,"%"),r.a.createElement(Ie.a,{id:"alert-dialog-slide-description",className:t.uploadLabel},"Uploading ",c," of ",o,": ",d),r.a.createElement(bt.a,{className:t.progressBar,variant:"buffer",color:"secondary",value:u,valueBuffer:p}),r.a.createElement(De.a,{className:t.progressPerc},u,"%")),r.a.createElement(Fe.a,null))},Et=Object(he.a)(e=>({progressPerc:{marginTop:e.spacing(1)},progressBar:{marginTop:e.spacing(3)}})),wt=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),yt=e=>{const t=Et();let{visible:a,trackTotal:n,trackDone:i,trackCurrent:l,titleCurrent:o}=g(e=>e.recordDialog),c=Math.round(l);return r.a.createElement(Pe.a,{open:a,maxWidth:"sm",fullWidth:!0,TransitionComponent:wt,"aria-labelledby":"record-dialog-slide-title","aria-describedby":"record-dialog-slide-description"},r.a.createElement(We.a,{id:"record-dialog-slide-title"},"Recording..."),r.a.createElement(Me.a,null,r.a.createElement(Ie.a,{id:"record-dialog-slide-description"},`Recording track ${i+1} of ${n}: ${o}`),r.a.createElement(bt.a,{className:t.progressBar,variant:l>=0?"determinate":"indeterminate",color:"primary",value:c}),r.a.createElement(De.a,{className:t.progressPerc},c>=0?`${c}%`:"")),r.a.createElement(Fe.a,null))},kt=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),Ct=e=>{const t=Object(o.c)();let{visible:a,error:i}=g(e=>e.errorDialog);const l=Object(n.useCallback)(()=>{t(I.setVisible(!1))},[t]);return r.a.createElement(Pe.a,{open:a,maxWidth:"sm",fullWidth:!0,TransitionComponent:kt,"aria-labelledby":"error-dialog-slide-title","aria-describedby":"error-dialog-slide-description"},r.a.createElement(We.a,{id:"alert-dialog-slide-title"},"Error"),r.a.createElement(Me.a,null,r.a.createElement(Ie.a,{id:"alert-dialog-slide-description"},i)),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:l},"Close")))},xt=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),St=e=>{const t=Object(o.c)();let{visible:a,dismissed:i}=g(e=>e.panicDialog);const l=Object(n.useCallback)(()=>{window.location.reload()},[]),c=Object(n.useCallback)(()=>{t(A.dismiss())},[t]);return r.a.createElement(Pe.a,{open:a&&!i,maxWidth:"sm",fullWidth:!0,scroll:"paper",TransitionComponent:xt,"aria-labelledby":"error-dialog-slide-title","aria-describedby":"error-dialog-slide-description"},r.a.createElement(We.a,{id:"alert-dialog-slide-title"},"Oops\u2026 Something unexpected happened."),r.a.createElement(Me.a,null,r.a.createElement(je.a,{color:"textSecondary",variant:"body1",component:"div"},"Try to restart the app. If the error persists, try the followings:",r.a.createElement("ol",null,r.a.createElement("li",null,"Use your browser in incognito mode."),r.a.createElement("li",null,"Use a blank MiniDisc."),r.a.createElement("li",null,"Try to use Web MiniDisc on another computer.")),"If this does not solve the error, your unit might not be supported yet or you have encountered a bug. The full error is reported in the JS console.")),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:c,size:"small"},"Ignore and Continue"),r.a.createElement(Se.a,{onClick:l,color:"primary"},"Restart the App")))};var jt=a(477),Ot=a(494),Tt=a(489),Dt=a(474);const Nt=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),Pt=Object(he.a)(e=>({container:{display:"flex",flexDirection:"row"},formControl:{minWidth:60},toggleButton:{minWidth:40},dialogContent:{display:"flex",flexWrap:"wrap",justifyContent:"space-between"},rightBlock:{display:"flex",flexDirection:"column"},titleFormControl:{marginTop:e.spacing(1)}})),Ft=e=>{const t=Object(o.c)(),a=Pt();let{visible:i,format:l,titleSource:c,titleFormat:s}=g(e=>e.convertDialog);const d=Object(n.useCallback)(()=>{t(z.setVisible(!1))},[t]),m=Object(n.useCallback)((e,a)=>{null!==a&&t(z.setFormat(a))},[t]),u=Object(n.useCallback)((e,a)=>{null!==a&&t(z.setTitleSource(a))},[t]),p=Object(n.useCallback)(e=>{t(z.setTitleFormat(e.target.value))},[t]),b=Object(n.useCallback)(()=>{d(),t(xe(e.files,l,c,s))},[t,e,l,c,s]);return r.a.createElement(Pe.a,{open:i,maxWidth:"xs",fullWidth:!0,TransitionComponent:Nt,"aria-labelledby":"convert-dialog-slide-title","aria-describedby":"convert-dialog-slide-description"},r.a.createElement(We.a,{id:"convert-dialog-slide-title"},"Upload Settings"),r.a.createElement(Me.a,{className:a.dialogContent},r.a.createElement(Oe.a,null,r.a.createElement(je.a,{component:"label",variant:"caption",color:"textSecondary"},"Recording Mode"),r.a.createElement(Ot.a,{value:l,exclusive:!0,onChange:m,size:"small"},r.a.createElement(jt.a,{className:a.toggleButton,value:"SP"},"SP"),r.a.createElement(jt.a,{className:a.toggleButton,value:"LP2"},"LP2"),r.a.createElement(jt.a,{className:a.toggleButton,value:"LP4"},"LP4"))),r.a.createElement("div",{className:a.rightBlock},r.a.createElement(Oe.a,{className:a.formControl},r.a.createElement(je.a,{component:"label",variant:"caption",color:"textSecondary"},"Track title"),r.a.createElement(Ot.a,{value:c,exclusive:!0,onChange:u,size:"small"},r.a.createElement(jt.a,{className:a.toggleButton,value:"file"},"Filename"),r.a.createElement(jt.a,{className:a.toggleButton,value:"media"},"Media tags"))),"media"===c?r.a.createElement(Oe.a,{className:a.titleFormControl},r.a.createElement(Tt.a,{value:s,color:"secondary",input:r.a.createElement(Dt.a,null),onChange:p},r.a.createElement(Ve.a,{value:"title"},"Title"),r.a.createElement(Ve.a,{value:"album-title"},"Album - Title"),r.a.createElement(Ve.a,{value:"artist-title"},"Artist - Title"),r.a.createElement(Ve.a,{value:"artist-album-title"},"Artist - Album - Title"))):null)),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:d},"Cancel"),r.a.createElement(Se.a,{onClick:b},"Ok")))};var Mt=a(233),It=a.n(Mt),Wt=a(234),Lt=a.n(Wt),Rt=a(235),At=a.n(Rt),Bt=a(232),$t=a.n(Bt);const Vt=()=>{const e=Object(n.useCallback)(()=>{var e;null===(e=w.netmdService)||void 0===e||e.prev()},[]),t=Object(n.useCallback)(()=>{var e;null===(e=w.netmdService)||void 0===e||e.play()},[]),a=Object(n.useCallback)(()=>{var e;null===(e=w.netmdService)||void 0===e||e.stop()},[]),i=Object(n.useCallback)(()=>{var e;null===(e=w.netmdService)||void 0===e||e.next()},[]);return r.a.createElement(De.a,null,r.a.createElement(Be.a,{"aria-label":"prev",onClick:e},r.a.createElement($t.a,null)),r.a.createElement(Be.a,{"aria-label":"play",onClick:t},r.a.createElement(It.a,null)),r.a.createElement(Be.a,{"aria-label":"stop",onClick:a},r.a.createElement(Lt.a,null)),r.a.createElement(Be.a,{"aria-label":"next",onClick:i},r.a.createElement(At.a,null)))},Ut=r.a.forwardRef((function(e,t){return r.a.createElement(Le.a,Object.assign({direction:"up",ref:t},e))})),zt=Object(he.a)(e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between",marginRight:-e.spacing(2)},formControl:{minWidth:120},selectEmpty:{marginTop:e.spacing(2)},head:{textShadow:"0px 0px 12px rgba(150, 150, 150, 1)",fontSize:e.typography.h2.fontSize,textAlign:"center",marginBottom:e.spacing(2)}})),_t=({trackIndexes:e})=>{const t=Object(o.c)(),a=zt(),[i,l]=Object(n.useState)([]),[c,s]=Object(n.useState)("");let{visible:m}=g(e=>e.dumpDialog);const b=Object(n.useCallback)(()=>{var e;s(""),null===(e=w.mediaRecorderService)||void 0===e||e.stopTestInput(),t(Y.setVisible(!1))},[t]),h=Object(n.useCallback)(e=>{var t,a;const n=e.target.value;s(n),null===(t=w.mediaRecorderService)||void 0===t||t.stopTestInput(),null===(a=w.mediaRecorderService)||void 0===a||a.playTestInput(n)},[s]),f=Object(n.useCallback)(()=>{var a,n;t((a=e,n=c,async function(e,t){e(Object(C.batchActions)([X.setVisible(!0),X.setProgress({trackTotal:a.length,trackDone:0,trackCurrent:0,titleCurrent:""})]));let r=t().main.disc,i=Object(d.getTracks)(r).filter(e=>a.indexOf(e.index)>=0);const{netmdService:l,mediaRecorderService:o}=w;for(let[a,s]of i.entries()){var c;e(X.setProgress({trackTotal:i.length,trackDone:a,trackCurrent:-1,titleCurrent:null!==(c=s.title)&&void 0!==c?c:""})),await l.gotoTrack(s.index),await l.play(),console.log("Waiting for track to be ready to play");let t=await l.getPosition(),r=[s.index,0,0,1];for(;null===t||!r.every((e,a)=>r[a]===t[a]);)await u(250),t=await l.getPosition();await l.pause(),await(null===l||void 0===l?void 0:l.gotoTrack(s.index)),console.log("Track is ready to play"),await(null===o||void 0===o?void 0:o.initStream(n)),await(null===o||void 0===o?void 0:o.startRecording()),await l.play();let d=s.duration/512;await p(1e3*d,t=>{var n;e(X.setProgress({trackTotal:i.length,trackDone:a,trackCurrent:t,titleCurrent:null!==(n=s.title)&&void 0!==n?n:""}))}),await(null===o||void 0===o?void 0:o.stopRecording()),null===o||void 0===o||o.downloadRecorded(`${s.title}`),await(null===o||void 0===o?void 0:o.closeStream())}await l.stop(),e(X.setVisible(!1))})),b()},[e,c,t,b]);return Object(n.useEffect)(()=>{m&&async function(){await navigator.mediaDevices.getUserMedia({audio:!0});let e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind).map(e=>({deviceId:e.deviceId,label:e.label}));l(e)}()},[m,l]),r.a.createElement(Pe.a,{open:m,maxWidth:"sm",fullWidth:!0,TransitionComponent:Ut,"aria-labelledby":"dump-dialog-slide-title","aria-describedby":"dump-dialog-slide-description"},r.a.createElement(We.a,{id:"dump-dialog-slide-title"},"Record Selected Tracks"),r.a.createElement(Me.a,null,r.a.createElement(je.a,{component:"p",variant:"h2",className:a.head},"\ud83d\udcbb \u2b05 \ud83d\udcbd"),r.a.createElement(je.a,{component:"p",variant:"body2"},"1. Connect your MD Player line-out to your PC audio line-in."),r.a.createElement(je.a,{component:"p",variant:"body2"},"2. Use the controls at the bottom right to play some tracks."),r.a.createElement(je.a,{component:"p",variant:"body2"},"3. Select the input source. You should hear the tracks playing on your PC."),r.a.createElement(je.a,{component:"p",variant:"body2"},"4. Adjust the input gain and the line-out volume of your device."),r.a.createElement(De.a,{className:a.container},r.a.createElement(Oe.a,{className:a.formControl},r.a.createElement(Tt.a,{value:c,onChange:h,displayEmpty:!0,className:a.selectEmpty},r.a.createElement(Ve.a,{value:"",disabled:!0},"Input Source"),i.map(e=>r.a.createElement(Ve.a,{key:e.deviceId,value:e.deviceId},e.label))),r.a.createElement(Te.a,null,"Input Source")),r.a.createElement(Vt,null))),r.a.createElement(Fe.a,null,r.a.createElement(Se.a,{onClick:b},"Cancel"),r.a.createElement(Se.a,{onClick:f,disabled:""===c},"Start Record")))};var Gt=a(488),Jt=a(155);const Ht=Object(he.a)(e=>({add:{position:"absolute",bottom:e.spacing(3),right:e.spacing(3)},main:{overflowY:"auto",flex:"1 1 auto",marginBottom:e.spacing(3),marginLeft:e.spacing(-2),marginRight:e.spacing(-2),outline:"none"},toolbar:{marginTop:e.spacing(3),marginLeft:e.spacing(-2),marginRight:e.spacing(-2),[e.breakpoints.up(600+2*e.spacing(2))]:{marginLeft:e.spacing(-3),marginRight:e.spacing(-3)}},toolbarLabel:{flex:"1 1 100%"},toolbarHighlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(Qe.d)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},headBox:{display:"flex",justifyContent:"space-between"},spacing:{marginTop:e.spacing(1)},formatBadge:{...Jt.styles(e).badge,...Jt.styles(e).colorPrimary,position:"static",display:"inline-flex",border:`2px solid ${e.palette.background.paper}`,padding:"0 4px"},titleCell:{overflow:"hidden",maxWidth:"40ch",textOverflow:"ellipsis"},indexCell:{whiteSpace:"nowrap",paddingRight:0,width:"2ch"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},remainingTimeTooltip:{textDecoration:"underline",textDecorationStyle:"dotted"}})),Yt={[d.Encoding.sp]:"SP",[d.Encoding.lp2]:"LP2",[d.Encoding.lp4]:"LP4"},qt=e=>{let t=Object(o.c)(),a=g(e=>e.main.disc),i=g(e=>e.main.deviceName);const[l,c]=r.a.useState([]),s=l.length,[m,u]=r.a.useState(null),p=Object(n.useCallback)(e=>{u(e.currentTarget)},[]),b=Object(n.useCallback)(()=>{u(null)},[]),h=Object(n.useCallback)(e=>{t(function(e,t){return async function(a){const{netmdService:n}=w;await n.moveTrack(e,t),ye()(a)}}(l[0],e)),b()},[t,l,b]),f=Object(n.useCallback)(()=>{t(Y.setVisible(!0))},[t]);Object(n.useEffect)(()=>{t(ye())},[t]),Object(n.useEffect)(()=>{c([])},[a]);let[v,E]=r.a.useState([]);const y=Object(n.useCallback)((e,a)=>{E(e),t(z.setVisible(!0))},[t]),{getRootProps:k,getInputProps:x,isDragActive:S,open:j}=Object(Ke.a)({onDrop:y,accept:["audio/*","video/mp4"],noClick:!0}),O=Ht();let T=[];if(null!==a)for(let n of a.groups)for(let e of n.tracks){var D,P;T.push({index:e.index,title:null!==(D=e.title)&&void 0!==D?D:"Unknown Title",group:null!==(P=n.title)&&void 0!==P?P:"",encoding:Yt[e.encoding],duration:Object(d.formatTimeFromFrames)(e.duration,!1)})}T.sort((e,t)=>e.index-t.index);const F=(e,n)=>{var r,i;let l=n,o=null!==(r=null===(i=Object(d.getTracks)(a).find(e=>e.index===l))||void 0===i?void 0:i.title)&&void 0!==r?r:"";t(Object(C.batchActions)([N.setVisible(!0),N.setCurrentName(o),N.setIndex(l)]))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(De.a,{className:O.headBox},r.a.createElement(je.a,{component:"h1",variant:"h4"},i||"Loading..."),r.a.createElement(_e,null)),r.a.createElement(je.a,{component:"h2",variant:"body2"},null!==a?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,`${Object(d.formatTimeFromFrames)(a.left,!1)} left of ${Object(d.formatTimeFromFrames)(a.total,!1)} `),r.a.createElement(mt.a,{title:r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,`${Object(d.formatTimeFromFrames)(2*a.left,!1)} left in LP2 Mode`),r.a.createElement("br",null),r.a.createElement("span",null,`${Object(d.formatTimeFromFrames)(4*a.left,!1)} left in LP4 Mode`)),arrow:!0},r.a.createElement("span",{className:O.remainingTimeTooltip},"SP Mode"))):"Loading..."),r.a.createElement(dt.a,{className:Object(qe.default)(O.toolbar,{[O.toolbarHighlight]:s>0})},s>0?r.a.createElement(Gt.a,{indeterminate:s>0&&s<T.length,checked:s>0,onChange:e=>{l.length<T.length?c(T.map(e=>e.index)):c([])},inputProps:{"aria-label":"select all tracks"}}):null,s>0?r.a.createElement(je.a,{className:O.toolbarLabel,color:"inherit",variant:"subtitle1"},s," selected"):r.a.createElement(je.a,{component:"h3",variant:"h6",className:O.toolbarLabel},(null===a||void 0===a?void 0:a.title)||"Untitled Disc"),1===s?r.a.createElement(r.a.Fragment,null,r.a.createElement(mt.a,{title:"Move to Position"},r.a.createElement(Se.a,{"aria-controls":"move-menu","aria-label":"Move",onClick:p},"Move")),r.a.createElement($e.a,{id:"move-menu",anchorEl:m,open:!!m,onClose:b,PaperProps:{style:{maxHeight:300}}},Array(T.length).fill(null).map((e,t)=>r.a.createElement(Ve.a,{key:`pos-${t}`,onClick:()=>h(t)},t+1)))):null,s>0?r.a.createElement(r.a.Fragment,null,r.a.createElement(mt.a,{title:"Record from MD"},r.a.createElement(Se.a,{"aria-label":"Record",onClick:f},"Record"))):null,s>0?r.a.createElement(mt.a,{title:"Delete"},r.a.createElement(Be.a,{"aria-label":"delete",onClick:e=>{var a;t((a=l,async function(e){if(!window.confirm(`Proceed with Delete Track${1!==a.length?"s":""}? This operation cannot be undone.`))return;const{netmdService:t}=w;e(ne.setLoading(!0)),(a=a.sort()).reverse();for(let n of a)await t.deleteTrack(n);ye()(e)}))}},r.a.createElement(at.a,null))):null,s>0?r.a.createElement(mt.a,{title:"Rename"},r.a.createElement(Be.a,{"aria-label":"rename",disabled:1!==s,onClick:e=>{F(0,l[0])}},r.a.createElement(rt.a,null))):null),r.a.createElement(De.a,Object.assign({className:O.main},k()),r.a.createElement("input",x()),r.a.createElement(it.a,{size:"small"},r.a.createElement(ct.a,null,r.a.createElement(st.a,null,r.a.createElement(ot.a,{className:O.indexCell},"#"),r.a.createElement(ot.a,null,"Title"),r.a.createElement(ot.a,null,"Format"),r.a.createElement(ot.a,{align:"right"},"Duration"))),r.a.createElement(lt.a,null,T.map(e=>r.a.createElement(st.a,{hover:!0,selected:l.includes(e.index),key:e.index,onDoubleClick:t=>F(0,e.index),onClick:t=>{return a=e.index,void(l.includes(a)?c(l.filter(e=>e!==a)):c([...l,a]));var a}},r.a.createElement(ot.a,{className:O.indexCell},e.index+1),r.a.createElement(ot.a,{className:O.titleCell,title:e.title},e.title||"No Title"),r.a.createElement(ot.a,null,r.a.createElement("span",{className:O.formatBadge},e.encoding)),r.a.createElement(ot.a,{align:"right"},e.duration))))),r.a.createElement(ge.a,{className:O.backdrop,open:S},"Drop your Music to Upload")),r.a.createElement(Xe.a,{color:"primary","aria-label":"add",className:O.add,onClick:j},r.a.createElement(et.a,null)),r.a.createElement(vt,null),r.a.createElement(gt,null),r.a.createElement(Ct,null),r.a.createElement(Ft,{files:v}),r.a.createElement(yt,null),r.a.createElement(_t,{trackIndexes:l}),r.a.createElement(Ae,null),r.a.createElement(St,null))};var Kt=a(427),Qt=a(240),Xt=a.n(Qt);const Zt=Object(he.a)(e=>({layout:{width:"auto",height:"100%",[e.breakpoints.up(600+2*e.spacing(2))]:{width:600,marginLeft:"auto",marginRight:"auto"},[e.breakpoints.up(700+2*e.spacing(2))+" and (min-height: 750px)"]:{width:700}},paper:{position:"relative",display:"flex",flexDirection:"column",padding:e.spacing(2),height:"100%",[e.breakpoints.up(600+2*e.spacing(2))]:{marginTop:e.spacing(6),marginBottom:e.spacing(6),padding:e.spacing(3),height:600},[e.breakpoints.up(700+2*e.spacing(2))+" and (min-height: 750px)"]:{height:700}},copyright:{display:"flex",alignItems:"center",[e.breakpoints.down(600+2*e.spacing(2))]:{flexWrap:"wrap"}},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},minidiscLogo:{width:48},controlsContainer:{flex:"1 1 auto",paddingLeft:e.spacing(3),paddingRight:e.spacing(8),[e.breakpoints.down(600+2*e.spacing(2))]:{order:-1,width:"100%",paddingLeft:0}}})),ea=Object(fe.a)({palette:{type:"dark",primary:{light:"#6ec6ff",main:"#2196f3",dark:"#0069c0",contrastText:"#fff"}}}),ta=Object(fe.a)({palette:{type:"light"}});var aa=()=>{const e=Zt(),t=Object(o.c)();let{mainView:a,loading:n,darkMode:i}=g(e=>e.appState);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ve.a,{theme:i?ea:ta},r.a.createElement(pe.a,null),r.a.createElement("main",{className:e.layout},r.a.createElement(Kt.a,{className:e.paper},"WELCOME"===a?r.a.createElement(Ye,null):null,"MAIN"===a?r.a.createElement(qt,null):null,r.a.createElement(De.a,{className:e.copyright},r.a.createElement(Be.a,{onClick:()=>t(ne.setDarkMode(!i))},r.a.createElement(Xt.a,{color:i?"secondary":void 0})),r.a.createElement(je.a,{variant:"body2",color:"textSecondary",style:{marginRight:"8px"}},"\xa9 ",r.a.createElement(Ne.a,{rel:"noopener noreferrer",color:"inherit",target:"_blank",href:"https://stefano.brilli.me/"},"Stefano Brilli")," ",(new Date).getFullYear(),"."),r.a.createElement(De.a,{className:e.controlsContainer},"MAIN"===a?r.a.createElement(Vt,null):null)))),r.a.createElement(ge.a,{className:e.backdrop,open:n},r.a.createElement(be.a,{color:"inherit"}))))},na=(a(410),a(156));class ra{constructor(e){this.worker=e,this.messageCallback=void 0,e.onmessage=this.handleMessage.bind(this)}async init(){await new Promise(e=>{this.messageCallback=e,this.worker.postMessage({action:"init"})})}async encode(e,t){return(await new Promise(a=>{this.messageCallback=a,this.worker.postMessage({action:"encode",bitrate:t,data:e},[e])})).data.result}terminate(){this.worker.terminate()}handleMessage(e){this.messageCallback(e),this.messageCallback=void 0}}if("undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){let e;onmessage=async t=>{const{action:a,...n}=t.data;if("init"===a)self.importScripts(b("atracdenc.js")),self.Module().then(t=>{e=t,self.postMessage({action:"init"}),e.setLogger&&e.setLogger((e,t)=>console.log(`${t}: ${e}`))});else if("encode"===a){const{bitrate:t,data:a}=n,r="inWavFile.wav",i="outAt3File.aea",l=new Uint8Array(a);e.FS.writeFile(`${r}`,l),e.callMain(["-e","atrac3","-i",r,"-o",i,"--bitrate",t]);let o=e.FS.stat(i).size,c=new Uint8Array(o-96),s=e.FS.open(i,"r");e.FS.read(s,c,0,c.length,96),e.FS.close(s);let d=c.buffer;self.postMessage({action:"encode",result:d},[d])}}}const ia=a(425);var la=a(241),oa=a.n(la);w.netmdService=new class{constructor({debug:e=!1}){if(this.netmdInterface=void 0,this.logger=void 0,e){const e=(...e)=>{e&&e[0]&&e[0].method&&console.log(...e)};this.logger={debug:e,info:e,warn:e,error:e,child:()=>this.logger}}}async pair(){let e=await Object(d.openNewDevice)(navigator.usb,this.logger);return null!==e&&(this.netmdInterface=e,!0)}async connect(){let e=await Object(d.openPairedDevice)(navigator.usb,this.logger);return null!==e&&(this.netmdInterface=e,!0)}async listContent(){return await Object(d.listContent)(this.netmdInterface)}async getDeviceName(){return await this.netmdInterface.netMd.getDeviceName()}async finalize(){await this.netmdInterface.netMd.finalize()}async renameTrack(e,t){t=v(t),await this.netmdInterface.cacheTOC(),await this.netmdInterface.setTrackTitle(e,t),await this.netmdInterface.syncTOC()}async renameDisc(e){const t=await this.netmdInterface.getDiscTitle(),a=await this.netmdInterface._getDiscTitle(),n=a.indexOf("//")>=0,r=a.startsWith("0;");if(e===t)return;let i;i=n?r?a.replace(/^0;.*?\/\//,""!==e?`0;${e}//`:""):`0;${e}//${a}`:e,await this.netmdInterface.cacheTOC(),await this.netmdInterface.setDiscTitle(i),await this.netmdInterface.syncTOC()}async deleteTrack(e){await this.netmdInterface.eraseTrack(e),await u(100)}async wipeDisc(){await this.netmdInterface.eraseDisc()}async moveTrack(e,t){await this.netmdInterface.moveTrack(e,t)}async upload(e,t,a,n){let r=t.byteLength,i=0,l=0;function o(){n({written:i,encrypted:l,total:r})}let c=new E,s=Object(m.makeGetAsyncPacketIteratorOnWorkerThread)(c,({encryptedBytes:e})=>{l=e,o()});e=v(e);let u=new d.MDTrack(e,a,t,524288,s);await Object(d.download)(this.netmdInterface,u,({writtenBytes:e})=>{i=e,o()}),c.terminate()}async play(){await this.netmdInterface.play()}async pause(){await this.netmdInterface.pause()}async stop(){await this.netmdInterface.stop()}async next(){await this.netmdInterface.nextTrack()}async prev(){await this.netmdInterface.previousTrack()}async gotoTrack(e){await this.netmdInterface.gotoTrack(e)}async getPosition(){return await this.netmdInterface.getPosition()}}({debug:!0}),w.audioExportService=new class{constructor(){this.ffmpegProcess=void 0,this.atracdencProcess=void 0,this.loglines=[],this.inFileName="",this.outFileNameNoExt=""}async init(){Object(na.setLogging)(!0)}async prepare(e){this.loglines=[],this.ffmpegProcess=Object(na.createWorker)({logger:e=>{this.loglines.push(e),console.log(e.action,e.message)},corePath:b("ffmpeg-core.js"),workerPath:b("worker.min.js")}),await this.ffmpegProcess.load(),this.atracdencProcess=new ra(new ia),await this.atracdencProcess.init();let t=e.name.split(".").slice(-1);if(0===t.length)throw new Error(`Unrecognized file format: ${e.name}`);this.inFileName=`inAudioFile.${t[0]}`,this.outFileNameNoExt="outAudioFile",await this.ffmpegProcess.write(this.inFileName,e)}async info(){await this.ffmpegProcess.transcode(this.inFileName,`${this.outFileNameNoExt}.metadata`,"-f ffmetadata");let e=/Audio:\s(.*?),/,t=/Input #0,\s(.*?),/,a=null,n=null;for(let r of this.loglines){let i=r.message.match(e);if(null===i)if(i=r.message.match(t),null===i){if(null!==a&&null!==n)break}else n=i[1];else a=i[1]}return{format:a,input:n}}async export({format:e}){let t;if("SP"===e){const e=`${this.outFileNameNoExt}.raw`;await this.ffmpegProcess.transcode(this.inFileName,e,"-f s16be -ar 44100");let{data:a}=await this.ffmpegProcess.read(e);t=a.buffer}else{const a=`${this.outFileNameNoExt}.wav`;await this.ffmpegProcess.transcode(this.inFileName,a,"-f wav -ar 44100");let{data:n}=await this.ffmpegProcess.read(a),r="0";switch(e){case"LP2":r="128";break;case"LP105":r="102";break;case"LP4":r="64"}t=await this.atracdencProcess.encode(n.buffer,r)}return this.ffmpegProcess.worker.terminate(),this.atracdencProcess.terminate(),t}},w.mediaRecorderService=new class{constructor(){this.recorder=void 0,this.stream=void 0,this.audioContext=void 0,this.analyserNode=void 0,this.gainNode=void 0}playTestInput(e){this.audioContext=new AudioContext,this.gainNode=this.audioContext.createGain(),this.analyserNode=this.audioContext.createAnalyser(),this.initStream(e).then(()=>{this.audioContext.createMediaStreamSource(this.stream).connect(this.gainNode),this.gainNode.connect(this.analyserNode),this.analyserNode.connect(this.audioContext.destination)})}stopTestInput(){var e;this.audioContext&&(null===(e=this.audioContext)||void 0===e||e.close(),delete this.audioContext,this.closeStream())}async initStream(e){const t={autoGainControl:!1,channelCount:2,deviceId:e,echoCancellation:!1,noiseSuppression:!1,sampleRate:44100,highpassFilter:!1};this.stream=await navigator.mediaDevices.getUserMedia({audio:t});const a=this.stream.getAudioTracks();a.length>0&&console.log("Record Setings:",a[0].getSettings())}async startRecording(){this.audioContext=new AudioContext;const e=this.audioContext.createMediaStreamSource(this.stream);this.recorder=new oa.a(e,{workerPath:b("recorderWorker.js")}),this.recorder.record()}async stopRecording(){this.recorder.stop()}async closeStream(){var e;null===(e=this.stream)||void 0===e||e.getTracks().forEach(e=>e.stop())}downloadRecorded(e){this.recorder.exportWAV(t=>{let a=URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=a,n.download=`${v(e)}.wav`,n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)})}},function(){let e;window.addEventListener("beforeunload",e=>{me.getState().uploadDialog.visible&&(e.preventDefault(),e.returnValue="Warning! Recording will be interrupted")}),navigator&&navigator.usb?navigator.usb.ondisconnect=function(){me.dispatch(ne.setState("WELCOME"))}:me.dispatch(ne.setBrowserSupported(!1)),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t})}(),l.a.render(r.a.createElement(o.a,{store:me},r.a.createElement(aa,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/webminidisc",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="/webminidisc/final-service-worker.js";c?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(a=>{const n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):s(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):s(t,e)})}}()}},[[259,1,2]]]);
//# sourceMappingURL=main.3977707d.chunk.js.map