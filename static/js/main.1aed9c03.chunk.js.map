{"version":3,"sources":["images/chrome-icon.svg","webpack:///./src/services/atracdenc-worker.ts?dc3c","serviceWorker.ts","utils.ts","services/netmd.ts","services/registry.ts","redux/upload-dialog-feature.ts","redux/rename-dialog-feature.ts","redux/error-dialog-feature.ts","redux/panic-dialog-feature.ts","redux/convert-dialog-feature.ts","redux/dump-dialog-feature.ts","redux/record-dialog-feature.ts","redux/app-feature.ts","redux/main-feature.ts","redux/store.ts","redux/actions.ts","components/about-dialog.tsx","components/topmenu.tsx","components/welcome.tsx","components/rename-dialog.tsx","components/upload-dialog.tsx","components/record-dialog.tsx","components/error-dialog.tsx","components/panic-dialog.tsx","components/convert-dialog.tsx","images/md0.svg","images/md1.svg","images/md2.svg","images/md3.svg","components/controls.tsx","components/dump-dialog.tsx","components/main.tsx","components/app.tsx","services/atracdenc-worker.ts","services/audio-export.ts","index.tsx","services/mediarecorder.ts"],"names":["module","exports","Worker","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","console","log","state","controller","onUpdate","onSuccess","update","catch","error","sleep","ms","Promise","resolve","setTimeout","async","sleepWithProgressCallback","cb","elapsedSecs","interval","setInterval","Math","min","clearInterval","useShallowEqualSelector","selector","useSelector","shallowEqual","getPublicPathFor","script","savePreference","key","value","localStorage","setItem","JSON","stringify","loadPreference","defaultValue","res","getItem","parse","e","sanitizeTitle","title","normalize","replace","EncodingName","Encoding","sp","lp2","lp4","getSortedTracks","disc","tracks","group","groups","track","push","index","encoding","duration","formatTimeFromFrames","sort","l","r","asyncMutex","target","propertyKey","descriptor","oldValue","args","mutex","this","release","acquire","apply","forAnyDesktop","theme","breakpoints","up","spacing","belowDesktop","down","forWideDesktop","require","NetMDUSBService","constructor","debug","netmdInterface","logger","Mutex","statusMonitorTimer","_fn","method","info","warn","child","iface","openNewDevice","usb","openPairedDevice","listContent","getDeviceStatus","netMd","getDeviceName","finalize","cacheTOC","setTrackTitle","syncTOC","newName","oldName","getDiscTitle","oldRawName","_getDiscTitle","hasGroups","indexOf","hasGroupsAndTitle","startsWith","newNameWithGroups","setDiscTitle","eraseTrack","eraseDisc","src","dst","moveTrack","data","format","progressCallback","total","byteLength","written","encrypted","updateProgress","w","webWorkerAsyncPacketIterator","makeGetAsyncPacketIteratorOnWorkerThread","encryptedBytes","mdTrack","MDTrack","download","writtenBytes","terminate","play","pause","stop","nextTrack","previousTrack","gotoTrack","getPosition","ServiceRegistry","slice","createSlice","name","initialState","visible","cancelled","writtenProgress","encryptedProgress","totalProgress","trackTotal","trackConverting","trackCurrent","titleCurrent","titleConverting","reducers","setVisible","action","payload","setWriteProgress","setCancelUpload","setTrackProgress","current","converting","reducer","actions","enableBatching","setCurrentName","setIndex","setErrorMessage","dismissed","dismiss","titleFormat","setFormat","setTitleFormat","inputDeviceId","setInputDeviceId","trackDone","setProgress","mainView","loading","pairingFailed","pairingMessage","browserSupported","darkMode","aboutDialogVisible","setState","setLoading","setPairingFailed","setPairingMessage","setBrowserSupported","setDarkMode","showAboutDialog","deviceName","deviceStatus","setDisc","setDeviceName","setDeviceStatus","combineReducers","renameDialog","uploadDialog","errorDialog","panicDialog","convertDialog","dumpDialog","recordDialog","appState","main","resetStateAction","appActions","toString","store","configureStore","type","middleware","next","panicDialogActions","getDefaultMiddleware","Object","freeze","getState","control","params","dispatch","serviceRegistry","netmdService","prev","mainActions","appStateActions","batchActions","WireformatDict","SP","Wireformat","pcm","LP2","LP105","l105kbps","LP4","getTrackNameFromMediaTags","file","fileData","arrayBuffer","blob","Blob","Uint8Array","metadata","mm","common","artist","album","extStartIndex","lastIndexOf","substring","convertAndUpload","files","audioExportService","wireformat","uploadDialogActions","updateProgressCallback","hasUploadBeenCancelled","trackUpdate","length","updateTrack","maxTitleLength","getTracks","map","reduce","acc","floor","errorMessage","i","item","converted","convertNext","f","reject","prepare","export","err","j","conversionIterator","upload","actionToDispatch","concat","errorDialogAction","Transition","React","forwardRef","props","ref","Slide","direction","AboutDialog","useDispatch","Dialog","open","maxWidth","fullWidth","TransitionComponent","aria-labelledby","DialogTitle","id","DialogContent","DialogContentText","Link","rel","href","DialogActions","Button","onClick","useStyles","makeStyles","listItemIcon","minWidth","TopMenu","classes","discTitle","githubLinkRef","useRef","menuAnchorEl","setMenuAnchorEl","useState","menuOpen","handleMenuOpen","useCallback","event","currentTarget","handleDarkMode","handleMenuClose","handleWipeDisc","confirm","wipeDisc","handleRefresh","handleRenameDisc","renameDialogActions","handleExit","handleShowAbout","handleGithubLink","stopPropagation","click","menuItems","MenuItem","ListItemIcon","className","fontSize","ListItemText","Fragment","IconButton","aria-label","aria-controls","aria-haspopup","Menu","anchorEl","keepMounted","onClose","position","flex","display","justifyContent","flexDirection","alignItems","button","marginTop","chromeLogo","width","height","why","alignSelf","headBox","Welcome","toLowerCase","showWhyUnsupported","setWhyUnsupported","Box","Typography","component","variant","align","color","init","connect","pair","message","FormControl","style","visibility","FormHelperText","preventDefault","alt","ChromeIconPath","RenameDialog","renameDialogVisible","renameDialogTitle","renameDialogIndex","what","handleCancelRename","handleDoRename","renameDisc","renameTrack","TextField","autoFocus","label","onKeyDown","onChange","progressPerc","progressBar","uploadLabel","UploadDialog","handleCancelUpload","progressValue","bufferValue","convertedValue","aria-describedby","LinearProgress","valueBuffer","disabled","RecordDialog","round","ErrorDialog","handleClose","errorDialogActions","PanicDialog","handleReloadApp","reload","handleIgnore","scroll","size","container","formControl","toggleButton","dialogContent","formatAndTitle","flexWrap","rightBlock","titleFormControl","spacer","showTracksOrderBtn","marginLeft","tracksOrderAccordion","opacity","tracksOrderAccordionDetail","maxHeight","overflow","toolbarHighlight","palette","secondary","backgroundColor","lighten","light","text","primary","dark","trackList","backdrop","zIndex","drawer","ConvertDialog","setFiles","selectedTrackIndex","setSelectedTrack","moveFile","offset","targetIndex","newFileArray","tmp","moveFileUp","moveFileDown","convertDialogActions","handleChangeFormat","ev","newFormat","handleChangeTitleFormat","handleConvert","tracksOrderVisible","setTracksOrderVisible","handleToggleTracksOrder","useEffect","newFiles","Array","from","selectedTrackRef","scrollIntoView","block","behavior","renderTracks","isSelected","ListItem","disableGutters","Radio","checked","onDrop","acceptedFiles","rejectedFiles","getRootProps","getInputProps","isDragActive","useDropzone","accept","noClick","disableRemove","handleRemoveSelectedTrack","filter","dialogVisible","ToggleButtonGroup","exclusive","ToggleButton","Select","input","Input","Accordion","expanded","square","outline","Toolbar","edge","AccordionDetails","List","dense","disablePadding","Backdrop","_extends","assign","arguments","source","prototype","hasOwnProperty","call","createElement","fill","fillRule","d","SvgMd0","svgRef","viewBox","ForwardRef","SvgMd1","SvgMd2","SvgMd3","frames","MDIcon0","MDIcon1","MDIcon2","MDIcon3","transform","to","lcd","marginRight","paddingLeft","paddingRight","borderRadius","background","default","lcdText","left","fontFamily","lcdDisc","top","lcdDiscIcon","active","scrollingStatusMessage","whiteSpace","animationName","animationTimingFunction","animationIterationCount","statusMessage","Controls","handlePrev","handlePlay","handleStop","handleNext","trackIndex","deviceState","discPresent","lcdScroll","setLcdScroll","lcdScrollDuration","setLcdScrollDuration","lcdIconFrame","setLcdIconFrame","scrollTimerRef","lcdRef","clearTimeout","domEl","textWidth","scrollWidth","lcdWidth","parentElement","offsetWidth","scrollDurationInSec","updateLCDScroll","lcdIconAnimationTimer","DiscFrame","animationDuration","flexFlow","selectEmpty","head","textShadow","typography","h2","textAlign","marginBottom","DumpDialog","trackIndexes","devices","setDevices","mediaRecorderService","stopTestInput","dumpDialogActions","handleChange","deviceId","playTestInput","handleStartTransfer","indexes","recordDialogAction","t","entries","expected","every","_","initStream","startRecording","durationInSec","perc","stopRecording","downloadRecorded","closeStream","mediaDevices","getUserMedia","audio","inputDevices","enumerateDevices","device","kind","updateDeviceList","displayEmpty","add","bottom","right","overflowY","toolbar","toolbarLabel","formatBadge","BadgeImpl","badge","colorPrimary","border","paper","padding","verticalAlign","titleCell","textOverflow","durationCell","durationCellTime","indexCell","remainingTimeTooltip","textDecoration","textDecorationStyle","Main","selected","setSelected","selectedCount","moveMenuAnchorEl","setMoveMenuAnchorEl","handleShowMoveMenu","handleCloseMoveMenu","handleMoveSelectedTrack","destIndex","srcIndex","handleShowDumpDialog","uploadedFiles","setUploadedFiles","handleRenameDoubleClick","selectedIndex","currentName","find","Tooltip","arrow","clsx","Checkbox","indeterminate","inputProps","PaperProps","reverse","deleteTrack","Table","TableHead","TableRow","TableCell","TableBody","hover","includes","onDoubleClick","handleSelectClick","Fab","layout","bottomBar","copyrightTypography","minidiscLogo","controlsContainer","darkTheme","createMuiTheme","contrastText","lightTheme","App","ThemeProvider","CssBaseline","Paper","Date","getFullYear","CircularProgress","AtracdencProcess","worker","messageCallback","onmessage","handleMessage","bind","postMessage","bitrate","result","undefined","WorkerGlobalScope","self","Module","others","importScripts","m","setLogger","msg","stream","inWavFile","outAt3File","dataArray","FS","writeFile","callMain","stat","outAt3FileStream","read","close","buffer","AtracdencWorker","ffmpegProcess","atracdencProcess","loglines","inFileName","outFileNameNoExt","setLogging","createWorker","corePath","workerPath","load","ext","split","Error","write","transcode","audioFormatRegex","inputFormatRegex","line","outFileName","encode","recorder","audioContext","analyserNode","gainNode","AudioContext","createGain","createAnalyser","createMediaStreamSource","destination","recordConstraints","autoGainControl","channelCount","echoCancellation","noiseSuppression","sampleRate","highpassFilter","audioTracks","getAudioTracks","getSettings","Recorder","record","forEach","exportWAV","url","URL","createObjectURL","a","document","body","appendChild","revokeObjectURL","removeChild","deferredPrompt","addEventListener","returnValue","ondisconnect","statusMonitorInterval","exceptionOccurred","shouldMonitorBeRunning","subscribe","ReactDOM","render","getElementById","process","origin","fetch","headers","response","contentType","get","status","ready","unregister","checkValidServiceWorker"],"mappings":"mFAAAA,EAAOC,QAAU,IAA0B,yC,8NCA3CD,EAAOC,QAAU,WACf,OAAO,IAAIC,OAAO,IAA0B,oC,qFCW9C,MAAMC,EAAcC,QACa,cAA7BC,OAAOC,SAASC,UAEiB,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MAAM,2DAyCvC,SAASC,EAAgBC,EAAeC,GACpCC,UAAUC,cACLC,SAASJ,GACTK,KAAKC,IACFA,EAAaC,cAAgB,KACzB,MAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,KAC7BC,QAAQC,IAAI,eAAgBJ,EAAiBK,OACd,cAA3BL,EAAiBK,QACbX,UAAUC,cAAcW,YAIxBH,QAAQC,IACJ,iHAKAX,GAAUA,EAAOc,UACjBd,EAAOc,SAAST,KAMpBK,QAAQC,IAAI,sCAGRX,GAAUA,EAAOe,WACjBf,EAAOe,UAAUV,QAMrCA,EAAaW,WAEhBC,MAAMC,IACHR,QAAQQ,MAAM,4CAA6CA,K,6BC9FhE,SAASC,EAAMC,GAClB,OAAO,IAAIC,QAAQC,IACfC,WAAWD,EAASF,KAIrBI,eAAeC,EAA0BL,EAAYM,GACxD,IAAIC,EAAc,EACdC,EAAWC,YAAY,KACvBF,IACAD,EAAGI,KAAKC,IAAI,IAAqB,IAAdJ,EAAsBP,EAAM,OAChD,WACGD,EAAMC,GACZ1B,OAAOsC,cAAcJ,GAGlB,SAASK,EAAiEC,GAC7E,OAAOC,YAAYD,EAAUE,KAO1B,SAASC,EAAiBC,GAC7B,MAAQ,gBAA4BA,IAGjC,SAASC,EAAeC,EAAaC,GACxCC,aAAaC,QAAQH,EAAKI,KAAKC,UAAUJ,IAGtC,SAASK,EAAkBN,EAAaO,GAC3C,IAAIC,EAAMN,aAAaO,QAAQT,GAC/B,GAAY,OAARQ,EACA,OAAOD,EAEP,IACI,OAAOH,KAAKM,MAAMF,GACpB,MAAOG,GACL,OAAOJ,GAiBZ,SAASK,EAAcC,GAC1B,OAAOA,EAAMC,UAAU,OAAOC,QAAQ,gBAAiB,IAG3D,MAAMC,EAAwC,CAC1C,CAACC,WAASC,IAAK,KACf,CAACD,WAASE,KAAM,MAChB,CAACF,WAASG,KAAM,OAGb,SAASC,EAAgBC,GAC5B,IAAIC,EAAgG,GACpG,GAAa,OAATD,EACA,IAAK,IAAIE,KAASF,EAAKG,OACnB,IAAK,IAAIC,KAASF,EAAMD,OAAQ,CAAC,IAAD,IAC5BA,EAAOI,KAAK,CACRC,MAAOF,EAAME,MACbf,MAAK,UAAEa,EAAMb,aAAR,QAAkB,gBACvBW,MAAK,UAAEA,EAAMX,aAAR,QAAkB,GACvBgB,SAAUb,EAAaU,EAAMG,UAC7BC,SAAUC,+BAAqBL,EAAMI,UAAU,KAM/D,OADAP,EAAOS,KAAK,CAACC,EAAGC,IAAMD,EAAEL,MAAQM,EAAEN,OAC3BL,EAGJ,SAASY,EAAWC,EAAaC,EAAqBC,GAEzD,MAAMC,EAAWD,EAAWrC,MAU5B,OATAqC,EAAWrC,MAAQjB,kBAAkBwD,GACjC,MAAMC,EAASC,KAAaD,MACtBE,QAAgBF,EAAMG,UAC5B,IACI,aAAaL,EAASM,MAAMH,KAAMF,GADtC,QAGIG,MAGDL,EAGJ,SAASQ,EAAcC,GAC1B,OAAOA,EAAMC,YAAYC,GAAG,IAAyB,EAAnBF,EAAMG,QAAQ,IAG7C,SAASC,EAAaJ,GACzB,OAAOA,EAAMC,YAAYI,KAAK,IAAyB,EAAnBL,EAAMG,QAAQ,IAG/C,SAASG,EAAeN,GAC3B,OAAOA,EAAMC,YAAYC,GAAG,IAAyB,EAAnBF,EAAMG,QAAQ,IAAW,2B,eCnG/D,MAAMnG,EAASuG,EAAQ,KA+BhB,IAAMC,GAAb,EAAO,MAMHC,aAAY,MAAEC,GAAQ,IAClB,GADgD,KAL5CC,oBAK2C,OAJ3CC,YAI2C,OAH5ClB,MAAQ,IAAImB,IAGgC,KAF5CC,wBAE4C,EAC3CJ,EAAO,CAEP,MAAMK,EAAM,IAAItB,KACRA,GAAQA,EAAK,IAAMA,EAAK,GAAGuB,QAC3B7F,QAAQC,OAAOqE,IAGvBE,KAAKiB,OAAS,CACVF,MAAOK,EACPE,KAAMF,EACNG,KAAMH,EACNpF,MAAOoF,EACPI,MAAO,IAAMxB,KAAKiB,SAK9B,aACI,IAAIQ,QAAcC,wBAAc3G,UAAU4G,IAAK3B,KAAKiB,QACpD,OAAc,OAAVQ,IAGJzB,KAAKgB,eAAiBS,GACf,GAGX,gBACI,IAAIA,QAAcG,2BAAiB7G,UAAU4G,IAAK3B,KAAKiB,QACvD,OAAc,OAAVQ,IAGJzB,KAAKgB,eAAiBS,GACf,GAGX,oBAEI,aAAaI,sBAAY7B,KAAKgB,gBAGlC,wBAEI,aAAac,0BAAgB9B,KAAKgB,gBAGtC,sBAEI,aAAahB,KAAKgB,eAAgBe,MAAMC,gBAG5C,uBAEUhC,KAAKgB,eAAgBe,MAAME,WAGrC,kBACkB/C,EAAef,GAE7BA,EAAQD,EAAcC,SAChB6B,KAAKgB,eAAgBkB,iBACrBlC,KAAKgB,eAAgBmB,cAAcjD,EAAOf,SAC1C6B,KAAKgB,eAAgBoB,UAG/B,iBACiBC,GAEb,MAAMC,QAAgBtC,KAAKgB,eAAgBuB,eACrCC,QAAmBxC,KAAKgB,eAAgByB,gBACxCC,EAAYF,EAAWG,QAAQ,OAAS,EACxCC,EAAoBJ,EAAWK,WAAW,MAEhD,GAAIR,IAAYC,EACZ,OAGJ,IAAIQ,EAIIA,EAFJJ,EACIE,EACoBJ,EAAWnE,QAAQ,aAA0B,KAAZgE,EAAkB,KAAIA,MAAe,IAErE,KAAIA,MAAYG,IAGrBH,QAGlBrC,KAAKgB,eAAgBkB,iBACrBlC,KAAKgB,eAAgB+B,aAAaD,SAClC9C,KAAKgB,eAAgBoB,UAG/B,kBACkBlD,SACRc,KAAKgB,eAAgBgC,WAAW9D,SAChCjD,EAAM,KAGhB,uBAEU+D,KAAKgB,eAAgBiC,YAG/B,gBACgBC,EAAaC,SACnBnD,KAAKgB,eAAgBoC,UAAUF,EAAKC,GAG9C,aACIhF,EACAkF,EACAC,EACAC,GAEA,IAAIC,EAAQH,EAAKI,WACbC,EAAU,EACVC,EAAY,EAChB,SAASC,IACLL,EAAiB,CAAEG,UAASC,YAAWH,UAG3C,IAAIK,EAAI,IAAIxJ,EAERyJ,EAA+BC,mDAAyCF,EAAG,EAAGG,qBAC9EL,EAAYK,EACZJ,MAIJzF,EAAQD,EAAcC,GACtB,IAAI8F,EAAU,IAAIC,UAAQ/F,EAAOmF,EAAQD,EAAM,OAASS,SAElDK,mBAASnE,KAAKgB,eAAiBiD,EAAS,EAAGG,mBAC7CV,EAAUU,EACVR,MAGJC,EAAEQ,YAGN,mBAEUrE,KAAKgB,eAAgBsD,OAE/B,oBAEUtE,KAAKgB,eAAgBuD,QAE/B,mBAEUvE,KAAKgB,eAAgBwD,OAE/B,mBAEUxE,KAAKgB,eAAgByD,YAE/B,mBAEUzE,KAAKgB,eAAgB0D,gBAG/B,gBACgBxF,SACNc,KAAKgB,eAAgB2D,UAAUzF,GAGzC,oBAEI,aAAac,KAAKgB,eAAgB4D,gBAhL1C,uCA0CKnF,GA1CL,mHA+CKA,GA/CL,qHAoDKA,GApDL,8GAyDKA,GAzDL,4GA8DKA,GA9DL,8GAuEKA,GAvEL,8GAoGKA,GApGL,4GA0GKA,GA1GL,0GA+GKA,GA/GL,sGAoJKA,GApJL,kGAwJKA,GAxJL,kGA4JKA,GA5JL,iGAgKKA,GAhKL,iGAoKKA,GApKL,sGAyKKA,GAzKL,6GA8KKA,GA9KL,2ECpCeoF,MAF0B,G,wBCSzC,MAiBaC,EAAQC,YAAY,CAC7BC,KAAM,eACNC,aAnBqC,CACrCC,SAAS,EACTC,WAAW,EAGXC,gBAAiB,EACjBC,kBAAmB,EACnBC,cAAe,EAGfC,WAAY,EACZC,gBAAiB,EACjBC,aAAc,EACdC,aAAc,GACdC,gBAAiB,IAMjBC,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3BC,iBAAkB,CAACtK,EAAOoK,KACtBpK,EAAM2J,kBAAoBS,EAAOC,QAAQpC,UACzCjI,EAAM0J,gBAAkBU,EAAOC,QAAQrC,QACvChI,EAAM4J,cAAgBQ,EAAOC,QAAQvC,OAEzCyC,gBAAiB,CAACvK,EAAOoK,KACrBpK,EAAMyJ,UAAYW,EAAOC,SAE7BG,iBAAkB,CACdxK,EACAoK,KAEApK,EAAM6J,WAAaO,EAAOC,QAAQvC,MAClC9H,EAAM+J,aAAeK,EAAOC,QAAQI,QACpCzK,EAAM8J,gBAAkBM,EAAOC,QAAQK,WACvC1K,EAAMgK,aAAeI,EAAOC,QAAQL,aACpChK,EAAMiK,gBAAkBG,EAAOC,QAAQJ,qBAKtC,QAAEU,EAAF,QAAWC,GAAYxB,EACrByB,+BAAeF,GCxD9B,MAMavB,EAAQC,YAAY,CAC7BC,KAAM,eACNC,aARoC,CACpCC,SAAS,EACT/G,MAAO,GACPe,OAAQ,GAMR0G,SAAU,CACNC,WAAY,CAACnK,EAA0BoK,KACnCpK,EAAMwJ,QAAUY,EAAOC,SAE3BS,eAAgB,CAAC9K,EAA0BoK,KACvCpK,EAAMyC,MAAQ2H,EAAOC,SAEzBU,SAAU,CAAC/K,EAA0BoK,KACjCpK,EAAMwD,MAAQ4G,EAAOC,aAKlBM,QAAF,EAAWC,QAAX,GAAuBxB,EACrByB,+BAAeF,GCxB9B,MAAMpB,EAAiC,CACnCC,SAAS,EACTlJ,MAAQ,IAGN8I,EAAQC,YAAY,CACtBC,KAAM,cACNC,aAFsB,EAGtBW,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3BW,gBAAiB,CAAChL,EAAOoK,KACrBpK,EAAMM,MAAS,GAAE8J,EAAOC,eAKrBO,QAAF,EAAWD,QAAX,GAAuBvB,EACrByB,+BAAeF,GCxBvB,MAKDvB,EAAQC,YAAY,CACtBC,KAAM,cACNC,aAPwB,CACxBC,SAAS,EACTyB,WAAW,GAMXf,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3Ba,QAAS,CAAClL,EAAOoK,KACbpK,EAAMwJ,SAAU,EAChBxJ,EAAMiL,WAAY,OAKfL,QAAF,EAAWD,QAAX,GAAuBvB,EACrByB,+BAAeF,GCV9B,MAAMpB,EAAqC,CACvCC,SAAS,EACT5B,OAAQ1F,EAAe,eAAgB,OACvCiJ,YAAajJ,EAAe,mBAAoB,aAG9CkH,EAAQC,YAAY,CACtBC,KAAM,gBACNC,aAFsB,EAGtBW,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3Be,UAAW,CAACpL,EAAOoK,KACfpK,EAAM4H,OAASwC,EAAOC,QACtB1I,EAAe,eAAgB3B,EAAM4H,SAEzCyD,eAAgB,CAACrL,EAAOoK,KACpBpK,EAAMmL,YAAcf,EAAOC,QAC3B1I,EAAe,mBAAoB3B,EAAMmL,kBAKtCP,QAAF,EAAWD,QAAX,IAAuBvB,EACrByB,gCAAeF,IC9B9B,MAKavB,GAAQC,YAAY,CAC7BC,KAAM,aACNC,aAPkC,CAClCC,SAAS,EACT8B,cAAe,IAMfpB,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3BkB,iBAAkB,CAACvL,EAAOoK,KACtBpK,EAAMsL,cAAgBlB,EAAOC,aAK1BM,QAAF,GAAWC,QAAX,IAAuBxB,GACrByB,gCAAeF,ICd9B,MAiBavB,GAAQC,YAAY,CAC7BC,KAAM,eACNC,aAnBuC,CACvCC,SAAS,EAETK,WAAY,EACZ2B,UAAW,EACXzB,aAAc,EAEdC,aAAc,IAadE,SAAU,CACNC,WAAY,CAACnK,EAAOoK,KAChBpK,EAAMwJ,QAAUY,EAAOC,SAE3BoB,YAAa,CACTzL,EACAoK,KAEApK,EAAM6J,WAAaO,EAAOC,QAAQR,WAClC7J,EAAMwL,UAAYpB,EAAOC,QAAQmB,UACjCxL,EAAM+J,aAAeK,EAAOC,QAAQN,aACpC/J,EAAMgK,aAAeI,EAAOC,QAAQL,kBAKjCW,QAAF,GAAWC,QAAX,IAAuBxB,GACrByB,gCAAeF,IClC9B,MAAMpB,GAAyB,CAC3BmC,SAAU,UACVC,SAAS,EACTC,eAAe,EACfC,eAAiB,GACjBC,kBAAkB,EAClBC,SAAU7J,EAAe,YAAY,GACrC8J,oBAAoB,GAGX5C,GAAQC,YAAY,CAC7BC,KAAM,MACNC,aAF6B,GAG7BW,SAAU,CACN+B,SAAU,CAACjM,EAAOoK,KACdpK,EAAM0L,SAAWtB,EAAOC,SAE5B6B,WAAY,CAAClM,EAAOoK,KAChBpK,EAAM2L,QAAUvB,EAAOC,SAE3B8B,iBAAkB,CAACnM,EAAOoK,KACtBpK,EAAM4L,cAAgBxB,EAAOC,SAEjC+B,kBAAmB,CAACpM,EAAOoK,KACvBpK,EAAM6L,eAAiBzB,EAAOC,SAElCgC,oBAAqB,CAACrM,EAAOoK,KACzBpK,EAAM8L,iBAAmB1B,EAAOC,SAEpCiC,YAAa,CAACtM,EAAOoK,KACjBpK,EAAM+L,SAAW3B,EAAOC,QACxB1I,EAAe,WAAY3B,EAAM+L,WAErCQ,gBAAiB,CAACvM,EAAOoK,KACrBpK,EAAMgM,mBAAqB5B,EAAOC,aAK/BM,QAAF,GAAWC,QAAX,IAAuBxB,GACrByB,gCAAeF,IC9C9B,MAMavB,GAAQC,YAAY,CAC7BC,KAAM,OACNC,aAR4B,CAC5BrG,KAAM,KACNsJ,WAAY,GACZC,aAAc,MAMdvC,SAAU,CACNwC,QAAS,CAAC1M,EAAOoK,KACbpK,EAAMkD,KAAOkH,EAAOC,SAExBsC,cAAe,CAAC3M,EAAOoK,KACnBpK,EAAMwM,WAAapC,EAAOC,SAE9BuC,gBAAiB,CAAC5M,EAAOoK,KACrBpK,EAAMyM,aAAerC,EAAOC,aAKzBM,QAAF,GAAWC,QAAX,IAAuBxB,GACrByB,gCAAeF,ICb9B,IAAIA,GAAUkC,YAAgB,CAC1BC,eACAC,eACAC,cACAC,cACAC,iBACAC,cACAC,gBACAC,YACAC,UAGJ,MAAMC,GAAmBC,GAAWvB,SAASwB,WAUhCC,GAAQC,YAAe,CAChChD,QATsC,YAAYvG,GAClD,MAAOpE,EAAOoK,GAAUhG,EACxB,OAAIgG,EAAOwD,OAASL,IAHG,YAGiBnD,EAAOC,QACpCd,GAEJoB,MAAWvG,IAKlByJ,WAAY,CAjCiBH,GAASI,GAAQlN,UAC9C,UACUkN,EAAK1D,GACb,MAAO7H,GACLzC,QAAQQ,MAAMiC,GACduL,EAAKC,EAAmB5D,YAAW,SA4BT6D,iBAG5BzE,GAAe0E,OAAOC,OAAOR,GAAMS,Y,0EChClC,SAASC,GAAQhE,EAAoDiE,GACxE,OAAOzN,eAAe0N,EAAuBH,GACzC,OAAQ/D,GACJ,IAAK,aACKmE,EAAgBC,aAAc5F,OACpC,MACJ,IAAK,aACK2F,EAAgBC,aAAc1F,OACpC,MACJ,IAAK,aACKyF,EAAgBC,aAAcV,OACpC,MACJ,IAAK,aACKS,EAAgBC,aAAcC,OACpC,MACJ,IAAK,OACGJ,GAA4B,kBAAXA,GAAuBA,GAAU,SAC5CE,EAAgBC,aAAcvF,UAAUoF,SAMpD9N,EAAM,KACZ,IACI,IAAIkM,QAAqB8B,EAAgBC,aAAcpI,kBACvDkI,EAASI,GAAY9B,gBAAgBH,IACvC,MAAOlK,GACLzC,QAAQC,IAAI,uCAqCjB,SAASoG,KACZ,OAAOvF,eAAe0N,GAElBA,EAASK,GAAgBzC,YAAW,IACpC,IAAIhJ,QAAaqL,EAAgBC,aAAcrI,cAC3CqG,QAAmB+B,EAAgBC,aAAclI,gBACjDmG,EAAe,KACnB,IACIA,QAAqB8B,EAAgBC,aAAcpI,kBACrD,MAAO7D,GACLzC,QAAQC,IAAI,yCAEhBuO,EACIM,uBAAa,CACTF,GAAYhC,QAAQxJ,GACpBwL,GAAY/B,cAAcH,GAC1BkC,GAAY9B,gBAAgBH,GAC5BkC,GAAgBzC,YAAW,OA2IpC,MAAM2C,GAA8C,CACvDC,GAAIC,aAAWC,IACfC,IAAKF,aAAWhM,IAChBmM,MAAOH,aAAWI,SAClBC,IAAKL,aAAW/L,KAGpBpC,eAAeyO,GAA0BC,EAAYnE,GAA+B,IAAD,MAC/E,MAAMoE,QAAiBD,EAAKE,cACtBC,EAAO,IAAIC,KAAK,CAAC,IAAIC,WAAWJ,KACtC,IAAIK,QAAiBC,aAAaJ,GAClC,MAAMhN,EAAK,UAAGmN,EAASE,OAAOrN,aAAnB,QAA4B,gBACjCsN,EAAM,UAAGH,EAASE,OAAOC,cAAnB,QAA6B,iBACnCC,EAAK,UAAGJ,EAASE,OAAOE,aAAnB,QAA4B,gBACvC,OAAQ7E,GACJ,IAAK,QACD,OAAO1I,EAEX,IAAK,eACD,MAAQ,GAAEsN,OAAYtN,IAE1B,IAAK,cACD,MAAQ,GAAEuN,OAAWvN,IAEzB,IAAK,qBACD,MAAQ,GAAEsN,OAAYC,OAAWvN,IAErC,IAAK,WAAY,CACb,IAAIA,EAAQ6M,EAAKhG,KAEjB,MAAM2G,EAAgBxN,EAAMyN,YAAY,KAIxC,OAHID,EAAgB,IAChBxN,EAAQA,EAAM0N,UAAU,EAAGF,IAExBxN,IAKZ,SAAS2N,GAAiBC,EAAezI,EAAsBuD,GAClE,OAAOvK,eAAe0N,EAAuBH,GACzC,MAAM,mBAAEmC,EAAF,aAAsB9B,GAAiBD,EACvCgC,EAAa1B,GAAejH,SAElC,OAAM4G,QAAN,IAAMA,OAAN,EAAMA,EAAc1F,QACpBwF,EAASM,uBAAa,CAAC4B,EAAoBrG,YAAW,GAAOqG,EAAoBjG,iBAAgB,MAEjG,MAAMkG,EAAyB,EAAGzI,UAASC,YAAWH,YAClDwG,EAASkC,EAAoBlG,iBAAiB,CAAEtC,UAASC,YAAWH,YAGlE4I,EAAyB,IACpBvC,IAAWpB,aAAatD,UAGnC,IAAIkH,EAMA,CACAlG,QAAS,EACTC,WAAY,EACZ5C,MAAOuI,EAAMO,OACb5G,aAAc,GACdC,gBAAiB,IAErB,MAAM4G,EAAc,KAChBvC,EAASkC,EAAoBhG,iBAAiBmG,KAGlD,IA4CIzN,EAAOiL,IAAWb,KAAKpK,KACvB4N,EAAiB5N,Eb7SR,Ka6S8C6N,oBAAU7N,GAAM8N,IAAI1N,GAASA,EAAMb,OAAU,Ib5S9EwO,OAAO,CAACC,EAAKzO,IAChCyO,EAAMzO,EAAMmO,OACpB,Ia0SgH,EAG/G,IAAItQ,EAFJwQ,EAAiB5P,KAAKiQ,MAAML,EAAiBT,EAAMO,QAGnD,IAAIQ,EAAgB,GAChBC,EAAI,EACR,UAAW,IAAIC,KAnDU1Q,gBAAgByP,GACrC,IAAIkB,EAA0D,GAE1DF,EAAI,GACR,SAASG,IACL,GAAIH,IAAMhB,EAAMO,QAAUF,IAItB,OAHAC,EAAYjG,WAAa2G,EACzBV,EAAY1G,gBAAmB,QAC/B4G,IAIJ,IAAIY,EAAIpB,EAAMgB,GACdV,EAAYjG,WAAa2G,EACzBV,EAAY1G,gBAAkBwH,EAAEnI,KAChCuH,IACAQ,IAEAE,EAAUhO,KACN,IAAI9C,QAAQG,MAAOF,EAASgR,KACxB,IAAI/J,EACJ,UACU2I,EAAoBqB,QAAQF,GAClC9J,QAAa2I,EAAoBsB,OAAO,CAAEhK,WAC1C4J,IACA9Q,EAAQ,CAAE4O,KAAMmC,EAAG9J,KAAMA,IAC3B,MAAOkK,GACLvR,EAAQuR,EACRT,EAAgB,GAAEK,EAAEnI,2CACpBoI,EAAOG,OAKvBL,GAEA,IAAIM,EAAI,EACR,KAAOA,EAAIP,EAAUX,oBACLW,EAAUO,UACfP,EAAUO,GACjBA,IAWeC,CAAmB1B,GAAQ,CAC9C,GAAIK,IACA,MAGJ,MAAM,KAAEpB,EAAF,KAAQ3H,GAAS2J,EAEvB,IAAI7O,EAAQ6M,EAAKhG,KACjB,IACI7G,QAAc4M,GAA0BC,EAAMnE,GAChD,MAAO0G,GACL/R,QAAQQ,MAAMuR,GAGdf,GAAkB,IAClBrO,EAAQA,EAAM0N,UAAU,EAAGW,IAG/BH,EAAYlG,QAAU4G,IACtBV,EAAY3G,aAAevH,EAC3BoO,IACAJ,EAAuB,CAAEzI,QAAS,EAAGC,UAAW,EAAGH,MAAO,MAC1D,UACI,OAAM0G,QAAN,IAAMA,OAAN,EAAMA,EAAcwD,OAAOvP,EAAOkF,EAAM4I,EAAYE,IACtD,MAAOoB,GACLvR,EAAQuR,EACRT,EAAgB,GAAE9B,EAAKhG,kCACvB,OAIR,IAAI2I,EAAgC,CAACzB,EAAoBrG,YAAW,IAEhE7J,IACAR,QAAQQ,MAAMA,GACd2R,EAAmBA,EAAiBC,OAAO,CACvCC,EAAkBhI,YAAW,GAC7BgI,EAAkBnH,gBAAgBoG,MAI1C9C,EAASM,uBAAaqD,IACtB9L,KAAcmI,I,2HCjYtB,MAAM8D,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCI,GAAeJ,IACxB,MAAMjE,EAAWsE,cAEjB,IAAIpJ,EAAUnI,EAAwBrB,GAASA,EAAMqN,SAASrB,oBAM9D,OACI,kBAAC6G,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,4BAEhB,kBAACC,GAAA,EAAD,CAAaC,GAAG,4BAAhB,sBACA,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,+CACA,4BACI,4BACI,kBAACC,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,0BAA0BzP,OAAO,UAAtE,UAEQ,IAHZ,MAIQ,IACJ,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,qCAAqCzP,OAAO,UAAjF,YALJ,4DAUA,4BACI,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,2CAA2CzP,OAAO,UAAvF,aADJ,0DAMA,4BACI,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,0BAA0BzP,OAAO,UAAtE,cADJ,sDAMA,4BACI,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,wCAAwCzP,OAAO,UAApF,YADJ,yDAMA,4BACI,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,6CAA6CzP,OAAO,UAAzF,kBADJ,4CAMA,4BACI,kBAACuP,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,2BAA2BzP,OAAO,UAAvE,eADJ,mCAOJ,kBAACsP,GAAA,EAAD,oBACA,4BACI,iDACuB,IACnB,kBAACC,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,yCAAyCzP,OAAO,UAArF,2CAIJ,iDACuB,IACnB,kBAACuP,GAAA,EAAD,CACIC,IAAI,sBACJC,KAAK,iFACLzP,OAAO,UAHX,4BAUZ,kBAAC0P,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QA9EA,KAChBtF,EAASd,GAAWjB,iBAAgB,MA6E5B,Y,mPC/EhB,MAAMsH,GAAYC,aAAWnP,IAAK,CAC9BoP,aAAc,CACVC,SAAUrP,EAAMG,QAAQ,OAInBmP,GAAU,WACnB,MAAMC,EAAUL,KACVvF,EAAWsE,cAEjB,IAAI,SAAElH,EAAF,SAAYK,GAAa1K,EAAwBrB,GAASA,EAAMqN,UAChE8G,EAAY9S,EAAwBrB,IAAK,mCAAIA,EAAMsN,KAAKpK,YAAf,aAAI,EAAiBT,aAArB,QAA+B,KAE5E,MAAM2R,EAAgB/B,IAAMgC,OAAiC,OACtDC,EAAcC,GAAmBlC,IAAMmC,SAA6B,MACrEC,EAAW5V,QAAQyV,GAEnBI,EAAiBC,sBAClBC,IACGL,EAAgBK,EAAMC,gBAE1B,CAACN,IAGCO,EAAiBH,sBAAY,KAC/BrG,EAASd,GAAWlB,aAAaP,KAClC,CAACuC,EAAUvC,IAERgJ,EAAkBJ,sBAAY,KAChCJ,EAAgB,OACjB,CAACA,IAEES,EAAiBL,sBAAY,KAC/BrG,GFsFG1N,eAAe0N,GAElB,IADqBxP,OAAOmW,QAAS,4DAEjC,OAEJ,MAAM,aAAEzG,GAAiBD,EACzBD,EAASK,GAAgBzC,YAAW,UAC9BsC,EAAc0G,WACpB/O,KAAcmI,ME7FdyG,KACD,CAACzG,EAAUyG,IAERI,EAAgBR,sBAAY,KAC9BrG,EAASnI,MACT4O,KACD,CAACzG,EAAUyG,IAERK,EAAmBT,sBAAY,KACjCrG,EACIM,uBAAa,CACTyG,EAAoBlL,YAAW,GAC/BkL,EAAoBvK,eAAeqJ,GACnCkB,EAAoBtK,UAAU,MAGtCgK,KACD,CAACzG,EAAUyG,EAAiBZ,IAEzBmB,EAAaX,sBAAY,KAC3BrG,EAASd,GAAWvB,SAAS,YAC7B8I,KACD,CAACzG,EAAUyG,IAERQ,EAAkBZ,sBAAY,KAChCrG,EAASd,GAAWjB,iBAAgB,IACpCwI,KACD,CAACzG,EAAUyG,IAERS,EAAmBb,sBACpBC,IAEgD,IAAD,GAD5CA,EAAMa,kBACFb,EAAM5Q,SAAWoQ,EAAc3J,WAE/B,UAAA2J,EAAc3J,eAAd,SAAuBiL,SAE3BX,KAEJ,CAACA,IAGCY,EAAY,GAuElB,MAtEiB,SAAbjK,IACAiK,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,SAASgS,QAASuB,GAC5B,kBAACU,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAagC,SAAS,WAE1B,kBAACC,GAAA,EAAD,qBAGRL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,QAAQgS,QAASwB,GAC3B,kBAACS,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAUgC,SAAS,WAEvB,kBAACC,GAAA,EAAD,sBAGRL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,OAAOgS,QAASoB,GAC1B,kBAACa,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAmBgC,SAAS,WAEhC,kBAACC,GAAA,EAAD,oBAGRL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,OAAOgS,QAAS0B,GAC1B,kBAACO,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAegC,SAAS,WAE5B,kBAACC,GAAA,EAAD,gBAIZL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,WAAWgS,QAASkB,GAC9B,kBAACe,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAE5BhI,EAAW,kBAAC,KAAD,CAAcgK,SAAS,UAAa,kBAAC,KAAD,CAAeA,SAAS,WAE5E,kBAACC,GAAA,EAAD,oBAGRL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,QAAQgS,QAAS2B,GAC3B,kBAACM,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAUgC,SAAS,WAEvB,kBAACC,GAAA,EAAD,gBAGRL,EAAUpS,KACN,kBAACqS,GAAA,EAAD,CAAUhU,IAAI,SAASgS,QAAS4B,GAC5B,kBAACK,GAAA,EAAD,CAAcC,UAAW5B,EAAQH,cAC7B,kBAAC,KAAD,CAAYgC,SAAS,WAEzB,kBAACC,GAAA,EAAD,KACI,kBAACzC,GAAA,EAAD,CACIC,IAAI,sBACJC,KAAK,2CACLzP,OAAO,SACPwO,IAAK4B,EACLR,QAAS4B,GALb,wBAcR,kBAAC,IAAMS,SAAP,KACI,kBAACC,GAAA,EAAD,CAAYC,aAAW,UAAUC,gBAAc,eAAeC,gBAAc,OAAOzC,QAASc,GACxF,kBAAC,KAAD,OAEJ,kBAAC4B,GAAA,EAAD,CAAMlD,GAAG,eAAemD,SAAUjC,EAAckC,aAAW,EAAC1D,KAAM2B,EAAUgC,QAAS1B,GAChFY,K,yBCjKjB,MAAM9B,GAAYC,aAAWnP,IAAK,CAC9B2I,KAAM,CACFoJ,SAAU,WACVC,KAAM,WACNC,QAAS,OACTC,eAAgB,SAChBC,cAAe,SACfC,WAAY,UAEhBC,OAAQ,CACJC,UAAWtS,EAAMG,QAAQ,GACzBkP,SAAU,KAEdlP,QAAS,CACLmS,UAAWtS,EAAMG,QAAQ,IAE7BoS,WAAY,CACRD,UAAWtS,EAAMG,QAAQ,GACzBqS,MAAO,GACPC,OAAQ,IAEZC,IAAK,CACDC,UAAW,aACXL,UAAWtS,EAAMG,QAAQ,IAE7ByS,QAAS,CACLX,QAAS,OACTC,eAAgB,oBAIXW,GAAWjF,IACpB,MAAM2B,EAAUL,KAEVvF,EAAWsE,eACX,iBAAE9G,EAAF,cAAoBF,EAApB,eAAmCC,GAAmBxK,EAAwBrB,GAASA,EAAMqN,UAC/FxB,EAAe4L,cAAcxY,MAAM,UAKvC,MAAOyY,EAAoBC,GAAqBnD,oBAAS,GAMzD,OACI,kBAAC,IAAMyB,SAAP,KACI,kBAAC2B,GAAA,EAAD,CAAK9B,UAAW5B,EAAQqD,SACpB,kBAACM,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,MAAnC,gBAGA,kBAAC9D,GAAD,OAEJ,kBAAC4D,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,SAAnC,mCAGA,kBAACH,GAAA,EAAD,CAAK9B,UAAW5B,EAAQ5G,MACnBxB,EACG,kBAAC,IAAMmK,SAAP,KACI,kBAAC4B,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,YAAYC,MAAM,SAASlC,UAAW5B,EAAQpP,SAAjF,iDAIA,kBAAC6O,GAAA,EAAD,CAAQoE,QAAQ,YAAYE,MAAM,UAAUrE,QAAS,IAAMtF,GHlCxE1N,eAAe0N,EAAuBH,GACzCG,EAASK,GAAgBxC,kBAAiB,UAEpCoC,EAAgB+B,mBAAoB4H,OAE1C,IAEI,SADsB3J,EAAgBC,aAAc2J,UAGhD,YADA7J,EAASK,GAAgB1C,SAAS,SAGxC,MAAO4F,GACL/R,QAAQQ,MAAMuR,GAIlB,IAEI,SADmBtD,EAAgBC,aAAc4J,OAG7C,YADA9J,EAASK,GAAgB1C,SAAS,SAGtCqC,EAASM,uBAAa,CAACD,GAAgBvC,kBAAmB,qBAAqBuC,GAAgBxC,kBAAiB,MAClH,MAAO0F,GACL/R,QAAQQ,MAAMuR,GACd,IAAIwG,EAAWxG,EAAcwG,QAC7B/J,EAASM,uBAAa,CAACD,GAAgBvC,kBAAkBiM,GAAU1J,GAAgBxC,kBAAiB,UGQX2J,UAAW5B,EAAQ8C,QAAhG,WAIA,kBAACsB,GAAA,EAAD,CAAahY,OAAO,EAAMwV,UAAW5B,EAAQpP,QAASyT,MAAO,CAAEC,WAAY5M,EAAgB,UAAY,WACnG,kBAAC6M,GAAA,EAAD,KAAiB5M,KAIzB,kBAAC,IAAMoK,SAAP,KACI,kBAAC4B,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,YAAYC,MAAM,SAASlC,UAAW5B,EAAQpP,SAAjF,yCAEI,kBAACyO,GAAA,EAAD,CAAMC,IAAI,sBAAsBC,KAAK,IAAIG,QAnCzCgB,IACpBA,EAAM8D,iBACNf,GAAkB,KAiCE,cAKJ,kBAACpE,GAAA,EAAD,CAAMC,IAAI,sBAAsBxP,OAAO,SAASyP,KAAK,kCACjD,yBAAKkF,IAAI,cAAcnR,IAAKoR,KAAgB9C,UAAW5B,EAAQgD,cAGnE,kBAACW,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,YAAYC,MAAM,SAASlC,UAAW5B,EAAQpP,SAAjF,YACc,IACV,kBAACyO,GAAA,EAAD,CAAMC,IAAI,sBAAsBxP,OAAO,SAASyP,KAAK,kCAArD,UAEQ,IAJZ,WAQCiE,EACG,oCACI,kBAACG,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,QAAQjC,UAAW5B,EAAQmD,KAA7D,qDACuD,IACnD,kBAAC9D,GAAA,EAAD,CAAMC,IAAI,sBAAsBxP,OAAO,SAASyP,KAAK,kCAArD,UAEQ,IAJZ,MAKQ,IACJ,kBAACF,GAAA,EAAD,CAAMC,IAAI,sBAAsBxP,OAAO,SAASyP,KAAK,4BAArD,eANJ,KAWA,4BACI,qHACA,0GAGR,OAIhB,kBAACd,GAAD,Q,mKCvHZ,MAAMP,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCsG,GAAgBtG,IACzB,IAAIjE,EAAWsE,cAEXkG,EAAsBzX,EAAwBrB,GAASA,EAAM8M,aAAatD,SAC1EuP,EAAoB1X,EAAwBrB,GAASA,EAAM8M,aAAarK,OACxEuW,EAAoB3X,EAAwBrB,GAASA,EAAM8M,aAAatJ,OAE5E,MAAMyV,EAAOD,EAAoB,EAAK,OAAS,QAEzCE,EAAqB,KACvB5K,EAAS+G,EAAoBlL,YAAW,KAGtCgP,EAAiB,KAEf7K,EADA0K,EAAoB,EJiFzB,UAAoB,QAAErS,IACzB,OAAO/F,eAAe0N,GAClB,MAAM,aAAEE,GAAiBD,QACnBC,EAAc4K,WAAWzS,GAC/B2H,EAAS+G,EAAoBlL,YAAW,IACxChE,KAAcmI,IIrFD8K,CAAW,CAAEzS,QAASoS,IJkEpC,UAAqB,MAAEvV,EAAF,QAASmD,IACjC,OAAO/F,eAAe0N,GAClB,MAAM,aAAEE,GAAiBD,EACzBD,EAAS+G,EAAoBlL,YAAW,IACxC,UACUqE,EAAc6K,YAAY7V,EAAOmD,GACzC,MAAOkL,GACL/R,QAAQQ,MAAMuR,GACdvD,EAASM,uBAAa,CAACuD,EAAkBhI,YAAW,GAAOgI,EAAkBnH,gBAAiB,qBAElG7E,KAAcmI,II1ED+K,CAAY,CAAE7V,MAAOwV,EAAmBrS,QAASoS,MAIlE,OACI,kBAAClG,GAAA,EAAD,CACIC,KAAMgG,EACNrC,QAASyC,EACTnG,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,uBAEhB,kBAACC,GAAA,EAAD,CAAaC,GAAG,uBAAhB,UAA8C6F,GAC9C,kBAAC5F,GAAA,EAAD,KACI,kBAACiG,GAAA,EAAD,CACIC,WAAS,EACTnG,GAAG,OACHoG,MAAQ,GAAEP,SACVrL,KAAK,OACLoF,WAAS,EACTnR,MAAOkX,EACPU,UAAW7E,IACQ,UAAfA,EAAMhT,KAAmBuX,KAE7BO,SAAU9E,IACNtG,EAAS+G,EAAoBvK,eAAe8J,EAAM5Q,OAAOnC,MAAMsO,UAAU,EAAG,WAIxF,kBAACuD,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QAASsF,GAAjB,UACA,kBAACvF,GAAA,EAAD,CAAQsE,MAAO,UAAWrE,QAASuF,GAAnC,a,cCrDhB,MAAMtF,GAAYC,aAAWnP,IAAK,CAC9BgV,aAAc,CACV1C,UAAWtS,EAAMG,QAAQ,IAE7B8U,YAAa,CACT3C,UAAWtS,EAAMG,QAAQ,IAE7B+U,YAAa,CACT5C,UAAWtS,EAAMG,QAAQ,OAI3BsN,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCuH,GAAgBvH,IACzB,MAAM2B,EAAUL,KACVvF,EAAWsE,cAEjB,IAAI,QACApJ,EADA,UAEAC,EAFA,gBAGAC,EAHA,kBAIAC,EAJA,cAKAC,EALA,WAOAC,EAPA,aAQAE,EARA,gBASAD,EATA,aAUAE,EAVA,gBAWAC,GACA5I,EAAwBrB,GAASA,EAAM+M,cAE3C,MAAMgN,EAAqBpF,sBAAY,KACnCrG,EAASkC,EAAoBjG,iBAAgB,KAC9C,CAAC+D,IAEJ,IAAI0L,EAAgB9Y,KAAKiQ,MAAOzH,EAAkBE,EAAiB,KAC/DqQ,EAAc/Y,KAAKiQ,MAAOxH,EAAoBC,EAAiB,KAC/DsQ,EAAiBhZ,KAAKiQ,MAAOrH,EAAkBD,EAAc,KACjE,OACI,kBAACgJ,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,2BAChBiH,mBAAiB,kCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,4BAAhB,gBACA,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAmBF,GAAG,kCACE,MAAnB8G,GAA0BpQ,IAAoBD,EACxC,uBACA,cAAaC,EAAkB,QAAQD,MAAeI,KAEjE,kBAACmQ,GAAA,EAAD,CACItE,UAAW5B,EAAQ0F,YACnB7B,QAA4B,IAAnBmC,EAAuB,gBAAkB,cAClDjC,MAAM,UACNpW,MAAOqY,IAEX,kBAACtC,GAAA,EAAD,CAAK9B,UAAW5B,EAAQyF,cAAeO,EAAvC,KAEA,kBAAC5G,GAAA,EAAD,CAAmBF,GAAG,iCAAiC0C,UAAW5B,EAAQ2F,aAA1E,aACe9P,EADf,OACiCF,EADjC,KAC+CG,GAE/C,kBAACoQ,GAAA,EAAD,CACItE,UAAW5B,EAAQ0F,YACnB7B,QAAQ,SACRE,MAAM,YACNpW,MAAOmY,EACPK,YAAaJ,IAEjB,kBAACrC,GAAA,EAAD,CAAK9B,UAAW5B,EAAQyF,cAAeK,EAAvC,MAEJ,kBAACtG,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQ2G,SAAU7Q,EAAWmK,QAASmG,GACjCtQ,EAAa,kCAAoC,uBCtFhEoK,GAAYC,aAAWnP,IAAK,CAC9BgV,aAAc,CACV1C,UAAWtS,EAAMG,QAAQ,IAE7B8U,YAAa,CACT3C,UAAWtS,EAAMG,QAAQ,OAI3BsN,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCgI,GAAgBhI,IACzB,MAAM2B,EAAUL,KAEhB,IAAI,QAAErK,EAAF,WAAWK,EAAX,UAAuB2B,EAAvB,aAAkCzB,EAAlC,aAAgDC,GAAiB3I,EAAwBrB,GAASA,EAAMoN,cAExG4M,EAAgB9Y,KAAKsZ,MAAMzQ,GAC/B,OACI,kBAAC8I,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,4BAChBiH,mBAAiB,mCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,6BAAhB,gBACA,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAmBF,GAAG,mCAChB,mBAAkB5H,EAAY,QAAQ3B,MAAeG,KAE3D,kBAACoQ,GAAA,EAAD,CACItE,UAAW5B,EAAQ0F,YACnB7B,QAAShO,GAAgB,EAAI,cAAgB,gBAC7CkO,MAAM,UACNpW,MAAOmY,IAEX,kBAACpC,GAAA,EAAD,CAAK9B,UAAW5B,EAAQyF,cAAeK,GAAiB,EAAK,GAAEA,KAAoB,KAEvF,kBAACtG,GAAA,EAAD,QC3CNtB,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCkI,GAAelI,IACxB,MAAMjE,EAAWsE,cAEjB,IAAI,QAAEpJ,EAAF,MAAWlJ,GAAUe,EAAwBrB,GAASA,EAAMgN,aAEhE,MAAM0N,EAAc/F,sBAAY,KAC5BrG,EAASqM,EAAmBxQ,YAAW,KACxC,CAACmE,IAEJ,OACI,kBAACuE,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,2BAChBiH,mBAAiB,kCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,4BAAhB,SACA,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAmBF,GAAG,kCAAkC9S,IAE5D,kBAACoT,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QAAS8G,GAAjB,YC/BVtI,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGlCqI,GAAerI,IACxB,MAAMjE,EAAWsE,cAEjB,IAAI,QAAEpJ,EAAF,UAAWyB,GAAc5J,EAAwBrB,GAASA,EAAMiN,aAEpE,MAAM4N,EAAkBlG,sBAAY,KAChC7V,OAAOC,SAAS+b,UACjB,IAEGC,EAAepG,sBAAY,KAC7BrG,EAASP,EAAmB7C,YAC7B,CAACoD,IAEJ,OACI,kBAACuE,GAAA,EAAD,CACIC,KAAMtJ,IAAYyB,EAClB8H,SAAU,KACVC,WAAW,EACXgI,OAAQ,QACR/H,oBAAqBb,GACrBc,kBAAgB,2BAChBiH,mBAAiB,kCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,4BAAhB,6CACA,kBAACC,GAAA,EAAD,KACI,kBAACwE,GAAA,EAAD,CAAYI,MAAM,gBAAgBF,QAAQ,QAAQD,UAAU,OAA5D,qEAEI,4BACI,mEACA,qDACA,6EALR,wJAWJ,kBAACpE,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QAASmH,EAAcE,KAAK,SAApC,uBAGA,kBAACtH,GAAA,EAAD,CAAQC,QAASiH,EAAiB5C,MAAM,WAAxC,sB,6JCtBhB,MAAM7F,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGzCsB,GAAYC,aAAWnP,IAAK,CAC9BuW,UAAW,CACPtE,QAAS,OACTE,cAAe,OAEnBqE,YAAa,CACTnH,SAAU,IAEdoH,aAAc,CACVpH,SAAU,IAEdqH,cAAe,CACXzE,QAAS,OACTE,cAAe,SACfD,eAAgB,WAEpByE,eAAgB,CACZ1E,QAAS,OACT2E,SAAU,OACV1E,eAAgB,iBAEpB2E,WAAY,CACR5E,QAAS,OACTE,cAAe,UAEnB2E,iBAAkB,CACdzH,SAAU,IACViD,UAAW,EACX,CAAClS,EAAaJ,IAAS,CACnBwS,MAAO,IACPnD,SAAU,IAGlB0H,OAAQ,CACJ9E,QAAS,OACTD,KAAM,YAEVgF,mBAAoB,CAChBC,WAAYjX,EAAMG,QAAQ,IAE9B+W,qBAAsB,CAClB,WAAY,CACRC,QAAS,IAGjBC,2BAA4B,CACxBC,UAAW,OACXC,SAAU,QAEdC,iBAC2B,UAAvBvX,EAAMwX,QAAQvO,KACR,CACIqK,MAAOtT,EAAMwX,QAAQC,UAAU9O,KAC/B+O,gBAAiBC,aAAQ3X,EAAMwX,QAAQC,UAAUG,MAAO,MAE5D,CACItE,MAAOtT,EAAMwX,QAAQK,KAAKC,QAC1BJ,gBAAiB1X,EAAMwX,QAAQC,UAAUM,MAEvDC,UAAW,CACPhG,KAAM,YAEViG,SAAU,CACNC,OAAQlY,EAAMkY,OAAOC,OAAS,EAC9B7E,MAAO,WAIF8E,GAAiBxK,IAC1B,MAAMjE,EAAWsE,cACXsB,EAAUL,KAEhB,IAAI,QAAErK,EAAF,OAAW5B,EAAX,YAAmBuD,GAAgB9J,EAAwBrB,GAASA,EAAMkN,eAG9E,MAAOmD,EAAO2M,GAAYxI,mBAASjC,EAAMlC,QAClC4M,EAAoBC,GAAoB1I,oBAAU,GAEnD2I,EAAWxI,sBACZyI,IACG,MAAMC,EAAcJ,EAAqBG,EACzC,GAAIC,GAAehN,EAAMO,QAAUyM,EAAc,EAC7C,OAGJ,MAAMC,EAAejN,EAAMjH,QAG3B,IAAImU,EAAMD,EAAaL,GACvBK,EAAaL,GAAsBK,EAAaD,GAChDC,EAAaD,GAAeE,EAE5BP,EAASM,GACTJ,EAAiBG,IAErB,CAAChN,EAAO4M,IAGNO,EAAa7I,sBAAY,KAC3BwI,GAAU,IACX,CAACA,IAEEM,EAAe9I,sBAAY,KAC7BwI,EAAS,IACV,CAACA,IAEEzC,EAAc/F,sBAAY,KAC5BrG,EAASoP,EAAqBvT,YAAW,KAC1C,CAACmE,IAEEqP,EAAqBhJ,sBACvB,CAACiJ,EAAIC,KACiB,OAAdA,GAGJvP,EAASoP,EAAqBtS,UAAUyS,KAE5C,CAACvP,IAGCwP,EAA0BnJ,sBAC3BC,IACGtG,EAASoP,EAAqBrS,eAAeuJ,EAAM5Q,OAAOnC,SAE9D,CAACyM,IAGCyP,EAAgBpJ,sBAAY,KAC9B+F,IACApM,EAAS8B,GAAiBC,EAAOzI,EAAQuD,KAC1C,CAACmD,EAAU+B,EAAOzI,EAAQuD,EAAauP,KAEnCsD,EAAoBC,GAAyBzJ,oBAAS,GACvD0J,EAA0BvJ,sBAAY,KACxCsJ,GAAuBD,IACxB,CAACA,EAAoBC,IAGxBE,oBAAU,KACN,MAAMC,EAAWC,MAAMC,KAAK/L,EAAMlC,OAClC2M,EAASoB,GACTlB,GAAkB,GAClBe,GAAsB,IACvB,CAAC1L,EAAMlC,MAAO6M,EAAkBe,IAGnC,MAAMM,EAAmBlK,iBAA8B,MACvD8J,oBAAU,KAAO,IAAD,EACZ,UAAAI,EAAiB9T,eAAjB,SAA0B+T,eAAe,CAAEC,MAAO,UAAWC,SAAU,YACxE,CAACH,EAAkBtB,IAEtB,MAAM0B,EAAehK,sBAAY,IACtBtE,EAAMW,IAAI,CAAC1B,EAAM+B,KACpB,MAAMuN,EAAa3B,IAAuB5L,EACpCmB,EAAMoM,EAAaL,EAAmB,KAC5C,OACI,kBAACM,GAAA,EAAD,CAAUjd,IAAM,GAAEyP,IAAKyN,gBAAgB,EAAMlL,QAAS,IAAMsJ,EAAiB7L,GAAImB,IAAKA,EAAKwE,QAAM,GAC7F,kBAACnB,GAAA,EAAD,KACI,kBAACkJ,GAAA,EAAD,CAAOC,QAASJ,EAAY/c,MAAQ,SAAQwP,IAAK4J,KAAK,WAE1D,kBAACjF,GAAA,EAAD,CAAcyG,QAASnN,EAAKhG,UAIzC,CAAC+G,EAAO4M,EAAoBC,EAAkBqB,IAG3CU,EAAStK,sBACX,CAACuK,EAAuBC,KACpB,MAAM7B,EAAejN,EAAMjH,QAAQ8I,OAAOgN,GAC1ClC,EAASM,IAEb,CAACjN,EAAO2M,KAEN,aAAEoC,EAAF,cAAgBC,EAAhB,aAA+BC,EAA/B,KAA6CxM,GAASyM,aAAY,CACpEN,SACAO,OAAQ,CAAE,UAAW,aACrBC,SAAS,IAEPC,EAAgBzC,EAAqB,GAAKA,GAAsB5M,EAAMO,OACtE+O,EAA4BhL,sBAAY,KAC1C,MAAM2I,EAAejN,EAAMuP,OAAO,CAACnO,EAAGJ,IAAMA,IAAM4L,GAClDD,EAASM,GACLL,GAAsBK,EAAa1M,QACnCsM,EAAiBI,EAAa1M,OAAS,IAE5C,CAACqM,EAAoB5M,EAAO2M,IAEzB6C,EAAgBxe,EAAwBrB,GAASA,EAAMkN,cAAc1D,SAO3E,OANA2U,oBAAU,KACF0B,GAAkC,IAAjBxP,EAAMO,QACvB8J,KAEL,CAACrK,EAAOwP,IAGP,kBAAChN,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,6BAChBiH,mBAAiB,oCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,8BAAhB,mBACA,kBAACC,GAAA,EAAD,CAAeyC,UAAW5B,EAAQmH,eAC9B,yBAAKvF,UAAW5B,EAAQoH,gBACpB,kBAAChD,GAAA,EAAD,KACI,kBAACT,GAAA,EAAD,CAAYC,UAAU,QAAQC,QAAQ,UAAUE,MAAM,iBAAtD,kBAGA,kBAAC6H,GAAA,EAAD,CAAmBje,MAAO+F,EAAQmY,WAAS,EAACrG,SAAUiE,EAAoB1C,KAAK,SAC3E,kBAAC+E,GAAA,EAAD,CAAclK,UAAW5B,EAAQkH,aAAcvZ,MAAM,MAArD,MAGA,kBAACme,GAAA,EAAD,CAAclK,UAAW5B,EAAQkH,aAAcvZ,MAAM,OAArD,OAGA,kBAACme,GAAA,EAAD,CAAclK,UAAW5B,EAAQkH,aAAcvZ,MAAM,OAArD,SAKR,yBAAKiU,UAAW5B,EAAQsH,YACpB,kBAAClD,GAAA,EAAD,CAAaxC,UAAW5B,EAAQiH,aAC5B,kBAACtD,GAAA,EAAD,CAAYC,UAAU,QAAQC,QAAQ,UAAUE,MAAM,iBAAtD,eAGA,kBAACK,GAAA,EAAD,CAAaxC,UAAW5B,EAAQuH,kBAC5B,kBAACwE,GAAA,EAAD,CAAQpe,MAAOsJ,EAAa8M,MAAM,YAAYiI,MAAO,kBAACC,GAAA,EAAD,MAAWzG,SAAUoE,GACtE,kBAAClI,GAAA,EAAD,CAAU/T,MAAQ,YAAlB,YACA,kBAAC+T,GAAA,EAAD,CAAU/T,MAAQ,SAAlB,SACA,kBAAC+T,GAAA,EAAD,CAAU/T,MAAQ,eAAlB,iBACA,kBAAC+T,GAAA,EAAD,CAAU/T,MAAQ,gBAAlB,kBACA,kBAAC+T,GAAA,EAAD,CAAU/T,MAAQ,sBAAlB,+BAMpB,kBAACue,GAAA,EAAD,CAAWC,SAAUrC,EAAoBlI,UAAW5B,EAAQ2H,qBAAsByE,QAAQ,GACtF,8BACA,yCAASlB,IAAT,CAAyB7G,MAAO,CAAEgI,QAAS,UACvC,kBAACC,GAAA,EAAD,CAASzI,QAAQ,QAAQjC,UAAW5B,EAAQgI,kBACxC,kBAAChG,GAAA,EAAD,CAAYuK,KAAK,QAAQtK,aAAW,YAAYvC,QAASd,GACrD,kBAAC,KAAD,OAEJ,kBAACoD,GAAA,EAAD,CAAYuK,KAAK,QAAQtK,aAAW,eAAevC,QAAS+L,EAA2BrF,SAAUoF,GAC7F,kBAAC,KAAD,OAEJ,yBAAK5J,UAAW5B,EAAQwH,SACxB,kBAACxF,GAAA,EAAD,CAAYuK,KAAK,MAAMtK,aAAW,UAAUvC,QAAS6J,GACjD,kBAAC,KAAD,OAEJ,kBAACvH,GAAA,EAAD,CAAYuK,KAAK,MAAMtK,aAAW,YAAYvC,QAAS4J,GACnD,kBAAC,KAAD,QAGR,kBAACkD,GAAA,EAAD,CAAkB5K,UAAW5B,EAAQ6H,4BACjC,kBAAC4E,GAAA,EAAD,CAAMC,OAAO,EAAMC,gBAAgB,EAAO/K,UAAW5B,EAAQyI,WACxDgC,MAGT,kBAACmC,GAAA,EAAD,CAAUhL,UAAW5B,EAAQ0I,SAAU9J,KAAMwM,GAA7C,0CAGA,0BAAWD,QAIvB,kBAAC3L,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QAASsK,EAAyBpI,UAAW5B,EAAQyH,oBACvD,GAAEqC,EAAqB,OAAS,iBAEtC,yBAAKlI,UAAW5B,EAAQwH,SACxB,kBAAC/H,GAAA,EAAD,CAAQC,QAAS8G,GAAjB,UACA,kBAAC/G,GAAA,EAAD,CAAQC,QAASmK,GAAjB,S,wFClUhB,SAASgD,KAA2Q,OAA9PA,GAAW9S,OAAO+S,QAAU,SAAUhd,GAAU,IAAK,IAAIqN,EAAI,EAAGA,EAAI4P,UAAUrQ,OAAQS,IAAK,CAAE,IAAI6P,EAASD,UAAU5P,GAAI,IAAK,IAAIzP,KAAOsf,EAAcjT,OAAOkT,UAAUC,eAAeC,KAAKH,EAAQtf,KAAQoC,EAAOpC,GAAOsf,EAAOtf,IAAY,OAAOoC,IAA2BS,MAAMH,KAAM2c,WAIhT,IAAI,GAEJ,IAAMK,cAAc,IAAK,CACvBC,KAAM,OACNC,SAAU,WACT,IAAMF,cAAc,IAAK,CAC1BE,SAAU,WACT,IAAMF,cAAc,OAAQ,CAC7BG,EAAG,02CACA,IAAMH,cAAc,OAAQ,CAC/BG,EAAG,g6BAGL,MAAMC,GAAS,EACbC,SACAlf,WACG8P,KACC,IAAM+O,cAAc,MAAOP,GAAS,CACxC5J,MAAO,GACPC,OAAQ,GACRwK,QAAS,YACTpP,IAAKmP,GACJpP,GAAQ9P,EAAQ,IAAM6e,cAAc,QAAS,KAAM7e,GAAS,KAAM,IAE/Dof,GAAa,IAAMvP,WAAW,CAACC,EAAOC,IAAQ,IAAM8O,cAAcI,GAAQX,GAAS,CACvFY,OAAQnP,GACPD,KACY,IC/Bf,SAAS,KAA2Q,OAA9P,GAAWtE,OAAO+S,QAAU,SAAUhd,GAAU,IAAK,IAAIqN,EAAI,EAAGA,EAAI4P,UAAUrQ,OAAQS,IAAK,CAAE,IAAI6P,EAASD,UAAU5P,GAAI,IAAK,IAAIzP,KAAOsf,EAAcjT,OAAOkT,UAAUC,eAAeC,KAAKH,EAAQtf,KAAQoC,EAAOpC,GAAOsf,EAAOtf,IAAY,OAAOoC,IAA2BS,MAAMH,KAAM2c,WAIhT,IAAI,GAEJ,IAAMK,cAAc,IAAK,CACvBC,KAAM,OACNC,SAAU,WACT,IAAMF,cAAc,IAAK,CAC1BE,SAAU,WACT,IAAMF,cAAc,OAAQ,CAC7BG,EAAG,02CACA,IAAMH,cAAc,OAAQ,CAC/BG,EAAG,sQAGL,MAAMK,GAAS,EACbH,SACAlf,WACG8P,KACC,IAAM+O,cAAc,MAAO,GAAS,CACxCnK,MAAO,GACPC,OAAQ,GACRwK,QAAS,YACTpP,IAAKmP,GACJpP,GAAQ9P,EAAQ,IAAM6e,cAAc,QAAS,KAAM7e,GAAS,KAAM,IAE/D,GAAa,IAAM6P,WAAW,CAACC,EAAOC,IAAQ,IAAM8O,cAAcQ,GAAQ,GAAS,CACvFH,OAAQnP,GACPD,KACY,IC/Bf,SAAS,KAA2Q,OAA9P,GAAWtE,OAAO+S,QAAU,SAAUhd,GAAU,IAAK,IAAIqN,EAAI,EAAGA,EAAI4P,UAAUrQ,OAAQS,IAAK,CAAE,IAAI6P,EAASD,UAAU5P,GAAI,IAAK,IAAIzP,KAAOsf,EAAcjT,OAAOkT,UAAUC,eAAeC,KAAKH,EAAQtf,KAAQoC,EAAOpC,GAAOsf,EAAOtf,IAAY,OAAOoC,IAA2BS,MAAMH,KAAM2c,WAIhT,IAAI,GAEJ,IAAMK,cAAc,IAAK,CACvBC,KAAM,OACNC,SAAU,WACT,IAAMF,cAAc,IAAK,CAC1BE,SAAU,WACT,IAAMF,cAAc,OAAQ,CAC7BG,EAAG,02CACA,IAAMH,cAAc,OAAQ,CAC/BG,EAAG,6WAGL,MAAMM,GAAS,EACbJ,SACAlf,WACG8P,KACC,IAAM+O,cAAc,MAAO,GAAS,CACxCnK,MAAO,GACPC,OAAQ,GACRwK,QAAS,YACTpP,IAAKmP,GACJpP,GAAQ9P,EAAQ,IAAM6e,cAAc,QAAS,KAAM7e,GAAS,KAAM,IAE/D,GAAa,IAAM6P,WAAW,CAACC,EAAOC,IAAQ,IAAM8O,cAAcS,GAAQ,GAAS,CACvFJ,OAAQnP,GACPD,KACY,IC/Bf,SAAS,KAA2Q,OAA9P,GAAWtE,OAAO+S,QAAU,SAAUhd,GAAU,IAAK,IAAIqN,EAAI,EAAGA,EAAI4P,UAAUrQ,OAAQS,IAAK,CAAE,IAAI6P,EAASD,UAAU5P,GAAI,IAAK,IAAIzP,KAAOsf,EAAcjT,OAAOkT,UAAUC,eAAeC,KAAKH,EAAQtf,KAAQoC,EAAOpC,GAAOsf,EAAOtf,IAAY,OAAOoC,IAA2BS,MAAMH,KAAM2c,WAIhT,IAAI,GAEJ,IAAMK,cAAc,IAAK,CACvBC,KAAM,OACNC,SAAU,WACT,IAAMF,cAAc,IAAK,CAC1BE,SAAU,WACT,IAAMF,cAAc,OAAQ,CAC7BG,EAAG,02CACA,IAAMH,cAAc,OAAQ,CAC/BG,EAAG,yTAGL,MAAMO,GAAS,EACbL,SACAlf,WACG8P,KACC,IAAM+O,cAAc,MAAO,GAAS,CACxCnK,MAAO,GACPC,OAAQ,GACRwK,QAAS,YACTpP,IAAKmP,GACJpP,GAAQ9P,EAAQ,IAAM6e,cAAc,QAAS,KAAM7e,GAAS,KAAM,IAE/D,GAAa,IAAM6P,WAAW,CAACC,EAAOC,IAAQ,IAAM8O,cAAcU,GAAQ,GAAS,CACvFL,OAAQnP,GACPD,KACY,ICXf,MAAM0P,GAAS,CAACC,GAASC,GAASC,GAASC,IAErCxO,GAAYC,aAAWnP,IAAK,CAC9B,wBAAyB,CACrB2Z,KAAM,CACFgE,UAAY,kBAEhBC,GAAI,IAERrH,UAAW,CACPtE,QAAS,OACTD,KAAM,WACN,CAAC5R,EAAaJ,IAAS,CACnB4W,SAAU,SAGlBiH,IAAK,CACD7L,KAAM,WACND,SAAU,WACVkF,WAAYjX,EAAMG,QAAQ,KAC1B2d,YAAa9d,EAAMG,QAAQ,KAC3B4d,YAAa/d,EAAMG,QAAQ,GAC3B6d,aAAche,EAAMG,QAAQ,GAC5B8d,aAAcje,EAAMG,QAAQ,GAC5BuX,gBAAiB1X,EAAMwX,QAAQ0G,WAAWC,QAC1C9O,SAAU,IACVoD,OAAQ,GACR,CAACrS,EAAaJ,IAAS,CACnBiX,WAAY,EACZ6G,YAAa9d,EAAMG,QAAQ,KAGnCie,QAAS,CACL9G,SAAU,SACVvF,SAAU,WACVS,MAAO,oBACP6L,KAAM,GACN5L,OAAQ,OACR6L,WAAY,UAEhBC,QAAS,CACLxM,SAAU,WACVyM,IAAK,EACLH,KAAM,IAEVI,YAAa,CACTjM,MAAO,GACPC,OAAQ,GACR,MAAO,CACHmK,KAAM5c,EAAMwX,QAAQ/R,OAAOiZ,SAGnCC,uBAAwB,CACpB5M,SAAU,WACVS,MAAO,OACPoM,WAAY,SACZC,cAAe,cACfC,wBAAyB,SACzBC,wBAAyB,IACzBP,IAAK,GACLH,KAAM,GAEVW,cAAe,CACXjN,SAAU,WACVS,MAAO,OACPoM,WAAY,SACZJ,IAAK,GACLH,KAAM,GAEVhM,OAAQ,MAKC4M,GAAW,KAAO,IAAD,MAC1B,MAAMtV,EAAWsE,cAEXnG,EAAepL,EAAwBrB,GAASA,EAAMsN,KAAKb,cAC3DvJ,EAAO7B,EAAwBrB,GAASA,EAAMsN,KAAKpK,MAEnDgR,EAAUL,KACVgQ,EAAalP,sBAAY,KAC3BrG,EAASF,GAAQ,UAClB,CAACE,IACEwV,EAAanP,sBAAY,KAC3BrG,EAASF,GAAQ,UAClB,CAACE,IACEyV,EAAapP,sBAAY,KAC3BrG,EAASF,GAAQ,UAClB,CAACE,IACE0V,EAAarP,sBAAY,KAC3BrG,EAASF,GAAQ,UAClB,CAACE,IAEJ,IAAI+J,EAAW,GACX4L,EAAU,iBAAGxX,QAAH,IAAGA,OAAH,EAAGA,EAAcnJ,aAAjB,QAA0B,KACpC4gB,EAAW,iBAAGzX,QAAH,IAAGA,OAAH,EAAGA,EAAczM,aAAjB,QAA0B,KACrCmkB,EAAW,iBAAG1X,QAAH,IAAGA,OAAH,EAAGA,EAAc0X,mBAAjB,SACf,MAAMhhB,EAASF,EAAgBC,GAC1BihB,EAEsB,eAAhBD,EACP7L,EAAU,cACe,IAAlBlV,EAAOyN,OACdyH,EAAW,YACJ5L,GAAuC,OAAvBA,EAAanJ,QACpC+U,EAAW,GAAE5L,EAAanJ,MAAQ,OAASH,EAAOsJ,EAAanJ,OAAOb,OANtE4V,EAAW,GASf,MAAO+L,EAAWC,GAAgB7P,mBAAS,IACpC8P,EAAmBC,GAAwB/P,mBAAS,IACpDgQ,EAAcC,GAAmBjQ,mBAAS,GAI3CkQ,EAAiBrQ,iBAAY,MAC7BsQ,EAAStQ,iBAA6B,MAC5C8J,oBAAU,KAgBNyG,aAAaF,EAAeja,SAC5B4Z,EAAa,GACbK,EAAeja,QAAU9J,WAAW,KAjBZ,MAAO,IAAD,MAC1B,MAAMkkB,EAAQF,EAAOla,QACfqa,EAAS,iBAAGD,QAAH,IAAGA,OAAH,EAAGA,EAAOE,mBAAV,QAAyB,EAClCC,EAAQ,iBAAGH,QAAH,IAAGA,OAAH,YAAGA,EAAOI,qBAAV,aAAG,EAAsBC,mBAAzB,QAAwC,EAEhDC,EAAsBL,EAAYE,EAAWF,EAAY,GAAK,EACpET,EAFmBS,EAAYE,EAAwB,IAAZF,EAAmBE,EAAW,GAGzET,EAAqBY,GACjBA,EAAsB,IACtBT,EAAeja,QAAU9J,WAAW,KAChC0jB,EAAa,IACQ,IAAtBc,EAA6B,OAOpCC,IAtBmB,KAyBhB,KACHR,aAAaF,EAAeja,WAEjC,CAACwZ,EAAYC,EAAa7L,IAG7B,MAAMgN,EAAwBhR,iBAAY,MAC1C8J,oBAAU,KACN/c,cAAcikB,EAAsB5a,SAChB,YAAhByZ,GAA6C,eAAhBA,EAC7BmB,EAAsB5a,QAAUxJ,YAAY,KACxCwjB,EAAgB,EAAKD,GAAgBvC,GAAOrR,OAAS,KACtD,KAEH6T,EAAgB,GAEb,KACHrjB,cAAcikB,EAAsB5a,WAEzC,CAACyZ,EAAaM,IAEjB,MAAMc,EAAYrD,GAAOuC,GACzB,OACI,kBAAC5M,GAAA,EAAD,CAAK9B,UAAW5B,EAAQgH,WACpB,kBAAChF,GAAA,EAAD,CAAYC,aAAW,OAAOvC,QAASiQ,EAAY/N,UAAW5B,EAAQ8C,QAClE,kBAAC,KAAD,OAEJ,kBAACd,GAAA,EAAD,CAAYC,aAAW,OAAOvC,QAASkQ,EAAYhO,UAAW5B,EAAQ8C,QAClE,kBAAC,KAAD,OAEJ,kBAACd,GAAA,EAAD,CAAYC,aAAW,OAAOvC,QAASmQ,EAAYjO,UAAW5B,EAAQ8C,QAClE,kBAAC,KAAD,OAEJ,kBAACd,GAAA,EAAD,CAAYC,aAAW,OAAOvC,QAASoQ,EAAYlO,UAAW5B,EAAQ8C,QAClE,kBAAC,KAAD,OAEJ,yBAAKlB,UAAW5B,EAAQsO,KACpB,yBAAK1M,UAAW5B,EAAQ6O,SACpB,0BACIjN,UAAWsO,EAAYlQ,EAAQoP,uBAAyBpP,EAAQyP,cAChEnR,IAAKmS,EACLpM,MACIF,GAAW+L,EAAY,EACjB,CAAEmB,kBAAoB,GAAEjB,KAAsBhC,UAAY,cAAa8B,OACvE,IAGT/L,IAGT,yBAAKvC,UAAW5B,EAAQgP,SAAUiB,GAAe,kBAACmB,EAAD,CAAWxP,UAAW5B,EAAQkP,kBCzLzFhR,GAAaC,IAAMC,YAAW,SAChCC,EACAC,GAEA,OAAO,kBAACC,GAAA,EAAD,eAAOC,UAAU,KAAKF,IAAKA,GAASD,OAGzCsB,GAAYC,aAAWnP,IAAK,CAC9BuW,UAAW,CACPtE,QAAS,OACTE,cAAe,MACfC,WAAY,WACZF,eAAgB,gBAChB4L,aAAc9d,EAAMG,QAAQ,GAC5B0gB,SAAU,QAEdrK,YAAa,CACTnH,SAAU,KAEdyR,YAAa,CACTxO,UAAWtS,EAAMG,QAAQ,IAE7B4gB,KAAM,CACFC,WAAY,sCACZ5P,SAAUpR,EAAMihB,WAAWC,GAAG9P,SAC9B+P,UAAW,SACXC,aAAcphB,EAAMG,QAAQ,OAIvBkhB,GAAa,EAAGC,mBACzB,MAAM3X,EAAWsE,cACXsB,EAAUL,MAETqS,EAASC,GAAc3R,mBAAgD,KACvElJ,EAAeC,GAAoBiJ,mBAAiB,IAE3D,IAAI,QAAEhL,GAAYnI,EAAwBrB,GAASA,EAAMmN,YAEzD,MAAMuN,EAAc/F,sBAAY,KAAO,IAAD,EAClCpJ,EAAiB,IACjB,UAAAgD,EAAgB6X,4BAAhB,SAAsCC,gBACtC/X,EAASgY,GAAkBnc,YAAW,KACvC,CAACmE,IAEEiY,EAAe5R,sBAChBiJ,IAA+C,IAAD,IAC3C,MAAM4I,EAAW5I,EAAG5Z,OAAOnC,MAC3B0J,EAAiBib,GACjB,UAAAjY,EAAgB6X,4BAAhB,SAAsCC,gBACtC,UAAA9X,EAAgB6X,4BAAhB,SAAsCK,cAAcD,IAExD,CAACjb,IAGCmb,EAAsB/R,sBAAY,KfuFrC,IAAsBgS,EAAmBH,EetFxClY,GfsFqBqY,EetFCV,EfsFkBO,EetFJlb,EfuFjC1K,eAAe0N,EAAuBH,GACzCG,EACIM,uBAAa,CACTgY,GAAmBzc,YAAW,GAC9Byc,GAAmBnb,YAAY,CAAE5B,WAAY8c,EAAQ/V,OAAQpF,UAAW,EAAGzB,aAAc,EAAGC,aAAc,QAIlH,IAAI9G,EAAOiL,IAAWb,KAAKpK,KACvBC,EAAS4N,oBAAU7N,GAAO0c,OAAOiH,GAAKF,EAAQ1f,QAAQ4f,EAAErjB,QAAU,GAEtE,MAAM,aAAEgL,EAAF,qBAAgB4X,GAAyB7X,QACzCA,EAAgBC,aAAc1F,OAEpC,IAAK,IAAKuI,EAAG/N,KAAUH,EAAO2jB,UAAW,CAAC,IAAD,EACrCxY,EACIsY,GAAmBnb,YAAY,CAC3B5B,WAAY1G,EAAOyN,OACnBpF,UAAW6F,EACXtH,cAAe,EACfC,aAAY,UAAE1G,EAAMb,aAAR,QAAiB,YAK/B+L,EAAcvF,UAAU3F,EAAME,aAC9BgL,EAAc5F,OACpB9I,QAAQC,IAAI,yCACZ,IAAI2W,QAAiBlI,EAActF,cAC/B6d,EAAW,CAACzjB,EAAME,MAAO,EAAG,EAAG,GACnC,KAAoB,OAAbkT,IAAsBqQ,EAASC,MAAM,CAACC,EAAG5V,IAAM0V,EAAS1V,KAAOqF,EAAUrF,WACtE9Q,EAAM,KACZmW,QAAiBlI,EAActF,oBAE7BsF,EAAc3F,cACpB,OAAM2F,QAAN,IAAMA,OAAN,EAAMA,EAAcvF,UAAU3F,EAAME,QACpC1D,QAAQC,IAAI,gCAGZ,OAAMqmB,QAAN,IAAMA,OAAN,EAAMA,EAAsBc,WAAWV,UACvC,OAAMJ,QAAN,IAAMA,OAAN,EAAMA,EAAsBe,wBACtB3Y,EAAc5F,OAGpB,IAAIwe,EAA4B9jB,EAAMI,SbvJ9B,UayJF7C,EAA0C,IAAhBumB,EAAuBC,IAAkB,IAAD,EACpE/Y,EACIsY,GAAmBnb,YAAY,CAC3B5B,WAAY1G,EAAOyN,OACnBpF,UAAW6F,EACXtH,aAAcsd,EACdrd,aAAY,UAAE1G,EAAMb,aAAR,QAAiB,cAMzC,OAAM2jB,QAAN,IAAMA,OAAN,EAAMA,EAAsBkB,iBACR,OAApBlB,QAAoB,IAApBA,KAAsBmB,iBAAkB,GAAEjkB,EAAMb,eAEhD,OAAM2jB,QAAN,IAAMA,OAAN,EAAMA,EAAsBoB,qBAG1BhZ,EAAc1F,OACpBwF,EAASsY,GAAmBzc,YAAW,OevJvCuQ,KACD,CAACuL,EAAc3a,EAAegD,EAAUoM,IAgB3C,OAdAyD,oBAAU,KASF3U,GARJ5I,uBACUvB,UAAUooB,aAAaC,aAAa,CAAEC,OAAO,IACnD,IACIC,SADgBvoB,UAAUooB,aAAaI,oBAEtCjI,OAAOkI,GAA0B,eAAhBA,EAAOC,MACxB/W,IAAI8W,IAAM,CAAOtB,SAAUsB,EAAOtB,SAAUhN,MAAOsO,EAAOtO,SAC/D2M,EAAWyB,GAGXI,IAEL,CAACxe,EAAS2c,IAGT,kBAACtT,GAAA,EAAD,CACIC,KAAMtJ,EACNuJ,SAAU,KACVC,WAAW,EACXC,oBAAqBb,GACrBc,kBAAgB,0BAChBiH,mBAAiB,iCAEjB,kBAAChH,GAAA,EAAD,CAAaC,GAAG,2BAAhB,0BACA,kBAACC,GAAA,EAAD,KACI,kBAACwE,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,KAAKjC,UAAW5B,EAAQwR,MACpD,oCAEN,kBAAC7N,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,SAAlC,gEAGA,kBAACF,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,SAAlC,gEAGA,kBAACF,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,SAAlC,8EAGA,kBAACF,GAAA,EAAD,CAAYC,UAAU,IAAIC,QAAQ,SAAlC,oEAGA,kBAACH,GAAA,EAAD,CAAK9B,UAAW5B,EAAQgH,WACpB,kBAAC5C,GAAA,EAAD,CAAaxC,UAAW5B,EAAQiH,aAC5B,kBAAC8E,GAAA,EAAD,CAAQpe,MAAOyJ,EAAeoO,SAAU6M,EAAc0B,cAAY,EAACnS,UAAW5B,EAAQuR,aAClF,kBAAC7P,GAAA,EAAD,CAAU/T,MAAM,GAAGyY,UAAQ,GAA3B,gBAGC4L,EAAQlV,IAAI8W,GACT,kBAAClS,GAAA,EAAD,CAAUhU,IAAKkmB,EAAOtB,SAAU3kB,MAAOimB,EAAOtB,UACzCsB,EAAOtO,SAIpB,kBAACf,GAAA,EAAD,sBAEJ,kBAACmL,GAAD,QAGR,kBAAClQ,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,QAAS8G,GAAjB,UACA,kBAAC/G,GAAA,EAAD,CAAQC,QAAS8S,EAAqBpM,SAA4B,KAAlBhP,GAAhD,mB,wBC/FhB,MAAMuI,GAAYC,aAAWnP,IAAK,CAC9BujB,IAAK,CACDxR,SAAU,WACVyR,OAAQxjB,EAAMG,QAAQ,GACtBsjB,MAAOzjB,EAAMG,QAAQ,GACrB,CAACC,EAAaJ,IAAS,CACnBwjB,OAAQxjB,EAAMG,QAAQ,KAG9BwI,KAAM,CACF+a,UAAW,OACX1R,KAAM,WACNoP,aAAcphB,EAAMG,QAAQ,GAC5Byb,QAAS,OACT3E,WAAYjX,EAAMG,SAAS,GAC3B2d,YAAa9d,EAAMG,SAAS,GAC5B,CAACJ,EAAcC,IAAS,CACpBiX,WAAYjX,EAAMG,SAAS,GAC3B2d,YAAa9d,EAAMG,SAAS,KAGpCwjB,QAAS,CACLrR,UAAWtS,EAAMG,QAAQ,GACzB8W,WAAYjX,EAAMG,SAAS,GAC3B2d,YAAa9d,EAAMG,SAAS,GAC5B,CAACH,EAAMC,YAAYC,GAAG,IAAyB,EAAnBF,EAAMG,QAAQ,KAAU,CAChD8W,WAAYjX,EAAMG,SAAS,GAC3B2d,YAAa9d,EAAMG,SAAS,KAGpCyjB,aAAc,CACV5R,KAAM,YAEVuF,iBAC2B,UAAvBvX,EAAMwX,QAAQvO,KACR,CACIqK,MAAOtT,EAAMwX,QAAQC,UAAU9O,KAC/B+O,gBAAiBC,aAAQ3X,EAAMwX,QAAQC,UAAUG,MAAO,MAE5D,CACItE,MAAOtT,EAAMwX,QAAQK,KAAKC,QAC1BJ,gBAAiB1X,EAAMwX,QAAQC,UAAUM,MAEvDnF,QAAS,CACLX,QAAS,OACTC,eAAgB,iBAEpB/R,QAAS,CACLmS,UAAWtS,EAAMG,QAAQ,IAE7B0jB,YAAa,IACLC,UAAyB9jB,GAAO+jB,SAChCD,UAAyB9jB,GAAOgkB,aACpCjS,SAAU,SACVE,QAAS,cACTgS,OAAS,aAAYjkB,EAAMwX,QAAQ0G,WAAWgG,QAC9CC,QAAS,QACTC,cAAe,SACf5R,MAAOxS,EAAMG,QAAQ,KACrB2d,YAAa9d,EAAMG,QAAQ,KAE/BkkB,UAAW,CACP/M,SAAU,SACVlJ,SAAU,OACVkW,aAAc,YAGlBC,aAAc,CACV3F,WAAY,UAEhB4F,iBAAkB,CACdJ,cAAe,UAEnBK,UAAW,CACP7F,WAAY,SACZZ,aAAc,EACdxL,MAAQ,OAEZyF,SAAU,CACNC,OAAQlY,EAAMkY,OAAOC,OAAS,EAC9B7E,MAAO,QAEXoR,qBAAsB,CAClBC,eAAgB,YAChBC,oBAAqB,aAIhBC,GAAQjX,IACjB,IAAIjE,EAAWsE,cACX1P,EAAO7B,EAAwBrB,GAASA,EAAMsN,KAAKpK,MACnDsJ,EAAanL,EAAwBrB,GAASA,EAAMsN,KAAKd,YAE7D,MAAOid,EAAUC,GAAerX,IAAMmC,SAAmB,IACnDmV,EAAgBF,EAAS7Y,QAExBgZ,EAAkBC,GAAuBxX,IAAMmC,SAA6B,MAC7EsV,EAAqBnV,sBAAaC,IACpCiV,EAAoBjV,EAAMC,gBAC3B,IACGkV,EAAsBpV,sBAAY,KACpCkV,EAAoB,OACrB,IACGG,EAA0BrV,sBAC3BsV,IACG3b,EhBKL,SAAmB4b,EAAkBD,GACxC,OAAOrpB,eAAe0N,GAClB,MAAM,aAAEE,GAAiBD,QACnBC,EAAc9G,UAAUwiB,EAAUD,GACxC9jB,KAAcmI,IgBTD5G,CAAU+hB,EAAS,GAAIQ,IAChCF,KAEJ,CAACzb,EAAUmb,EAAUM,IAGnBI,EAAuBxV,sBAAY,KACrCrG,EAASgY,GAAkBnc,YAAW,KACvC,CAACmE,IAEJ6P,oBAAU,KACN7P,EAASnI,OACV,CAACmI,IAEJ6P,oBAAU,KACNuL,EAAY,KACb,CAACxmB,IAEJ,IAAKknB,EAAeC,GAAoBhY,IAAMmC,SAAiB,IAC/D,MAAMyK,EAAStK,sBACX,CAACuK,EAAuBC,KACpBkL,EAAiBnL,GACjB5Q,EAASoP,EAAqBvT,YAAW,KAE7C,CAACmE,KAEC,aAAE8Q,EAAF,cAAgBC,EAAhB,aAA+BC,EAA/B,KAA6CxM,GAASyM,aAAY,CACpEN,SACAO,OAAQ,CAAE,UAAW,aACrBC,SAAS,IAGPvL,EAAUL,KACV1Q,EAASF,EAAgBC,GAmBzBonB,EAA0B,CAAC1V,EAAyBtD,KAAkB,IAAD,IACvE,IAAIiZ,EAAgBjZ,EAChBkZ,EAAW,oBAAGzZ,oBAAU7N,GAAOunB,KAAKnnB,GAASA,EAAME,QAAU+mB,UAAlD,aAAG,EAA+D9nB,aAAlE,QAA2E,GAE1F6L,EACIM,uBAAa,CACTyG,EAAoBlL,YAAW,GAC/BkL,EAAoBvK,eAAe0f,GACnCnV,EAAoBtK,SAASwf,OAazC,OACI,kBAAC,IAAMtU,SAAP,KACI,kBAAC2B,GAAA,EAAD,CAAK9B,UAAW5B,EAAQqD,SACpB,kBAACM,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,MAC9BvL,GAAe,cAEpB,kBAACyH,GAAD,OAEJ,kBAAC4D,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,SACrB,OAAT7U,EACG,kBAAC,IAAM+S,SAAP,KACI,8BAAQ,GAAEtS,+BAAqBT,EAAK8f,MAAM,cAAkBrf,+BAAqBT,EAAK4E,OAAO,OAC7F,kBAAC4iB,GAAA,EAAD,CACIjoB,MACI,kBAAC,IAAMwT,SAAP,KACI,8BAAQ,GAAEtS,+BAAiC,EAAZT,EAAK8f,MAAU,uBAC9C,6BACA,8BAAQ,GAAErf,+BAAiC,EAAZT,EAAK8f,MAAU,wBAGtD2H,OAAK,GAEL,0BAAM7U,UAAW5B,EAAQmV,sBAAzB,aAIP,cAGT,kBAAC7I,GAAA,EAAD,CACI1K,UAAW8U,mBAAK1W,EAAQoU,QAAS,CAC7B,CAACpU,EAAQgI,kBAAmByN,EAAgB,KAG/CA,EAAgB,EACb,kBAACkB,GAAA,EAAD,CACIC,cAAenB,EAAgB,GAAKA,EAAgBxmB,EAAOyN,OAC3DoO,QAAS2K,EAAgB,EACzBjQ,SAnEU9E,IACtB6U,EAAS7Y,OAASzN,EAAOyN,OACzB8Y,EAAYvmB,EAAO6N,IAAI6V,GAAKA,EAAErjB,QAE9BkmB,EAAY,KAgEAqB,WAAY,CAAE,aAAc,uBAEhC,KACHpB,EAAgB,EACb,kBAAC9R,GAAA,EAAD,CAAY/B,UAAW5B,EAAQqU,aAActQ,MAAM,UAAUF,QAAQ,aAChE4R,EADL,aAIA,kBAAC9R,GAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,KAAKjC,UAAW5B,EAAQqU,eAClD,OAAJrlB,QAAI,IAAJA,OAAA,EAAAA,EAAMT,QAAU,iBAGN,IAAlBknB,EACG,kBAAC,IAAM1T,SAAP,KACI,kBAACyU,GAAA,EAAD,CAASjoB,MAAM,oBACX,kBAACkR,GAAA,EAAD,CAAQyC,gBAAc,YAAYD,aAAW,OAAOvC,QAASkW,GAA7D,SAIJ,kBAACxT,GAAA,EAAD,CACIlD,GAAG,YACHmD,SAAUqT,EACV9W,OAAQ8W,EACRnT,QAASsT,EACTiB,WAAY,CACRzS,MAAO,CACHyD,UAAW,OAIlBqC,MAAMlb,EAAOyN,QACT2Q,KAAK,MACLvQ,IAAI,CAACiW,EAAG5V,IAED,kBAACuE,GAAA,EAAD,CAAUhU,IAAM,OAAMyP,IAAKuC,QAAS,IAAMoW,EAAwB3Y,IAC7DA,EAAI,MAM7B,KAEHsY,EAAgB,EACb,kBAAC,IAAM1T,SAAP,KACI,kBAACyU,GAAA,EAAD,CAASjoB,MAAM,kBACX,kBAACkR,GAAA,EAAD,CAAQwC,aAAW,SAASvC,QAASuW,GAArC,YAKR,KAEHR,EAAgB,EACb,kBAACe,GAAA,EAAD,CAASjoB,MAAM,UACX,kBAACyT,GAAA,EAAD,CAAYC,aAAW,SAASvC,QAlGtBgB,IhBhG3B,IAAsB+R,EgBiGrBrY,GhBjGqBqY,EgBiGC8C,EhBhGnB7oB,eAAe0N,GAIlB,IAHqBxP,OAAOmW,QACvB,4BAA8C,IAAnB0R,EAAQ/V,OAAe,IAAM,wCAGzD,OAEJ,MAAM,aAAEpC,GAAiBD,EACzBD,EAASK,GAAgBzC,YAAW,KACpCya,EAAUA,EAAQ/iB,QACVqnB,UACR,IAAK,IAAIznB,KAASmjB,QACRnY,EAAc0c,YAAY1nB,GAEpC2C,KAAcmI,QgBoLM,kBAAC,KAAD,QAGR,KAEHqb,EAAgB,EACb,kBAACe,GAAA,EAAD,CAASjoB,MAAM,UACX,kBAACyT,GAAA,EAAD,CAAYC,aAAW,SAASmE,SAA4B,IAAlBqP,EAAqB/V,QA9GlDgB,IAC7B0V,EAAwB1V,EAAO6U,EAAS,MA8GpB,kBAAC,KAAD,QAGR,MAER,kBAAC7R,GAAA,EAAD,eAAK9B,UAAW5B,EAAQ5G,MAAU8R,KAC9B,0BAAWC,KACX,kBAAC8L,GAAA,EAAD,CAAOlQ,KAAK,SACR,kBAACmQ,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAWxV,UAAW5B,EAAQkV,WAA9B,KACA,kBAACkC,GAAA,EAAD,cACA,kBAACA,GAAA,EAAD,CAAWtT,MAAM,SAAjB,cAGR,kBAACuT,GAAA,EAAD,KACKpoB,EAAO6N,IAAI1N,GACR,kBAAC+nB,GAAA,EAAD,CACIG,OAAK,EACL/B,SAAUA,EAASgC,SAASnoB,EAAME,OAClC5B,IAAK0B,EAAME,MACXkoB,cAAe9W,GAAS0V,EAAwB1V,EAAOtR,EAAME,OAC7DoQ,QAASgB,IAAS+W,OAlKMra,EAkKmBhO,EAAME,WAjKrEimB,EAASgC,SAASna,GAClBoY,EAAYD,EAAS7J,OAAOvO,GAAKA,IAAMC,IAEvCoY,EAAY,IAAID,EAAUnY,KAJR,IAA0BA,IAoKxB,kBAACga,GAAA,EAAD,CAAWxV,UAAW5B,EAAQkV,WAAY9lB,EAAME,MAAQ,GACxD,kBAAC8nB,GAAA,EAAD,CAAWxV,UAAW5B,EAAQ8U,UAAWvmB,MAAOa,EAAMb,OACjDa,EAAMb,OAAU,YAErB,kBAAC6oB,GAAA,EAAD,CAAWtT,MAAM,QAAQlC,UAAW5B,EAAQgV,cACxC,0BAAMpT,UAAW5B,EAAQsU,aAAcllB,EAAMG,UAC7C,0BAAMqS,UAAW5B,EAAQiV,kBAAmB7lB,EAAMI,eAMtE,kBAACod,GAAA,EAAD,CAAUhL,UAAW5B,EAAQ0I,SAAU9J,KAAMwM,GAA7C,8BAIJ,kBAACsM,GAAA,EAAD,CAAK3T,MAAM,UAAU9B,aAAW,MAAML,UAAW5B,EAAQgU,IAAKtU,QAASd,GACnE,kBAAC,KAAD,OAGJ,kBAACgH,GAAD,MACA,kBAACjB,GAAD,MACA,kBAAC4B,GAAD,MACA,kBAACsC,GAAD,CAAe1M,MAAO+Z,IACtB,kBAAC7P,GAAD,MACA,kBAACyL,GAAD,CAAYC,aAAcwD,IAC1B,kBAAC9W,GAAD,MACA,kBAACiI,GAAD,Q,cC3WZ,MAAM/G,GAAYC,aAAWnP,IAAK,CAC9BknB,OAAQ,CACJ1U,MAAO,OACPC,OAAQ,OACR,CAAC1S,EAAcC,IAAS,CACpBwS,MAAO,IACPyE,WAAY,OACZ6G,YAAa,QAEjB,CAACxd,EAAeN,IAAS,CACrBwS,MAAO,MAIf0R,MAAO,CACHnS,SAAU,WACVE,QAAS,OACTE,cAAe,SACfgS,QAASnkB,EAAMG,QAAQ,GACvBsS,OAAQ,oBACR,CAAC1S,EAAcC,IAAS,CACpBsS,UAAWtS,EAAMG,QAAQ,GACzBihB,aAAcphB,EAAMG,QAAQ,GAC5BgkB,QAASnkB,EAAMG,QAAQ,GACvBsS,OAAQ,KAEZ,CAACnS,EAAeN,IAAS,CACrByS,OAAQ,MAGhB0U,UAAW,CACPlV,QAAS,OACTG,WAAY,SACZ,CAAChS,EAAaJ,IAAS,CACnB4W,SAAU,QAEdK,YAAajX,EAAMG,QAAQ,IAE/BinB,oBAAqB,CACjBtJ,YAAa9d,EAAMG,QAAQ,GAC3BghB,UAAW,UAEflJ,SAAU,CACNC,OAAQlY,EAAMkY,OAAOC,OAAS,EAC9B7E,MAAO,QAEX+T,aAAc,CACV7U,MAAO,IAEX8U,kBAAmB,CACftV,KAAM,WACNQ,MAAO,OACPwL,aAAche,EAAMG,QAAQ,GAC5B,CAACC,EAAaJ,IAAS,CACnB+d,YAAa,OAKnBwJ,GAAYC,aAAe,CAC7BhQ,QAAS,CACLvO,KAAM,OACN6O,QAAS,CACLF,MAAO,UACPjP,KAAM,UACNoP,KAAM,UACN0P,aAAc,WAKpBC,GAAaF,aAAe,CAC9BhQ,QAAS,CACLvO,KAAM,WAwCC0e,OApCH,KACR,MAAMpY,EAAUL,KAECjB,cACjB,IAAI,SAAElH,EAAF,QAAYC,EAAZ,SAAqBI,GAAa1K,EAAwBrB,GAASA,EAAMqN,UAE7E,OACI,kBAAC,IAAM4I,SAAP,KACI,kBAACsW,GAAA,EAAD,CAAe5nB,MAAOoH,EAAWmgB,GAAYG,IACzC,kBAACG,GAAA,EAAD,MAEA,0BAAM1W,UAAW5B,EAAQ2X,QACrB,kBAACY,GAAA,EAAD,CAAO3W,UAAW5B,EAAQ2U,OACR,YAAbnd,EAAyB,kBAAC8L,GAAD,MAAc,KAC1B,SAAb9L,EAAsB,kBAAC8d,GAAD,MAAW,KAElC,kBAAC5R,GAAA,EAAD,CAAK9B,UAAW5B,EAAQ+X,mBAAiC,SAAbvgB,EAAsB,kBAACkY,GAAD,MAAe,OAErF,kBAAC/L,GAAA,EAAD,CAAYE,QAAQ,QAAQE,MAAM,gBAAgBnC,UAAW5B,EAAQ6X,qBAChE,QACD,kBAACxY,GAAA,EAAD,CAAMC,IAAI,sBAAsByE,MAAM,UAAUjU,OAAO,SAASyP,KAAK,8BAArE,kBAEQ,KACP,IAAIiZ,MAAOC,cACX,MAIT,kBAAC7L,GAAA,EAAD,CAAUhL,UAAW5B,EAAQ0I,SAAU9J,KAAMnH,GACzC,kBAACihB,GAAA,EAAD,CAAkB3U,MAAM,gB,0BCzHrC,MAAM4U,GAGTznB,YAAmB0nB,GAAiB,KAAjBA,SAAgB,KAF3BC,qBAE2B,EAC/BD,EAAOE,UAAY1oB,KAAK2oB,cAAcC,KAAK5oB,MAG/C,mBACU,IAAI7D,QAAsBC,IAC5B4D,KAAKyoB,gBAAkBrsB,EACvB4D,KAAKwoB,OAAOK,YAAY,CAAE/iB,OAAQ,WAI1C,aAAazC,EAAmBylB,GAK5B,aAJsB,IAAI3sB,QAAsBC,IAC5C4D,KAAKyoB,gBAAkBrsB,EACvB4D,KAAKwoB,OAAOK,YAAY,CAAE/iB,OAAQ,SAAUgjB,UAASzlB,QAAQ,CAACA,OAEjDA,KAAK0lB,OAG1B1kB,YACIrE,KAAKwoB,OAAOnkB,YAGhBskB,cAAcrP,GACVtZ,KAAKyoB,gBAAiBnP,GACtBtZ,KAAKyoB,qBAAkBO,GAI/B,GAAiC,qBAAtBC,mBAAqCC,gBAAgBD,kBAAmB,CAE/E,IAAIE,EACJT,UAAYpsB,UACR,MAAM,OAAEwJ,KAAWsjB,GAAW9P,EAAGjW,KACjC,GAAe,SAAXyC,EACAojB,KAAKG,cAAclsB,EAAkB,iBACpC+rB,KAAaC,SAASjuB,KAAMouB,IACzBH,EAASG,EACTJ,KAAKL,YAAY,CAAE/iB,OAAQ,SAC3BqjB,EAAOI,WAAaJ,EAAOI,UAAU,CAACC,EAAaC,IAAmBjuB,QAAQC,IAAK,GAAEguB,MAAWD,aAEjG,GAAe,WAAX1jB,EAAqB,CAC5B,MAAM,QAAEgjB,EAAF,KAAWzlB,GAAS+lB,EACpBM,EAAa,gBACbC,EAAc,iBACdC,EAAY,IAAIve,WAAWhI,GACjC8lB,EAAOU,GAAGC,UAAW,GAAEJ,IAAaE,GACpCT,EAAOY,SAAS,CAAE,KAAM,SAAU,KAAKL,EAAY,KAAKC,EAAa,YAAYb,IAGjF,IACInS,EADWwS,EAAOU,GAAGG,KAAKL,GACVhT,KAChBsC,EAAM,IAAI5N,WAAWsL,EAAO,IAC5BsT,EAAmBd,EAAOU,GAAGrb,KAAKmb,EAAY,KAClDR,EAAOU,GAAGK,KAAKD,EAAkBhR,EAAK,EAAGA,EAAI3M,OAAQ,IACrD6c,EAAOU,GAAGM,MAAMF,GAEhB,IAAIlB,EAAS9P,EAAImR,OAEjBlB,KAAKL,YACD,CACI/iB,OAAQ,SACRijB,UAEJ,CAACA,MClEjB,MAAMsB,GAAkBzpB,EAAQ,K,yBCkBhCqJ,EAAgBC,aAAe,IAAIrJ,EAAgB,CAAEE,OAAO,IAE5DkJ,EAAgB+B,mBAAqB,IDN9B,MAA8D,cAAD,KACzDse,mBADyD,OAEzDC,sBAFyD,OAGzDC,SAAkD,GAHO,KAIzDC,WAAsB,GAJmC,KAKzDC,iBAA4B,GAEnC,aACIC,uBAAW,GAGf,cAAc3f,GACVhL,KAAKwqB,SAAW,GAChBxqB,KAAKsqB,cAAgBM,wBAAa,CAC9B3pB,OAAS8E,IACL/F,KAAKwqB,SAASvrB,KAAK8G,GACnBvK,QAAQC,IAAIsK,EAAQD,OAAQC,EAAQgO,UAExC8W,SAAU1tB,EAAiB,kBAC3B2tB,WAAY3tB,EAAiB,yBAE3B6C,KAAKsqB,cAAcS,OAEzB/qB,KAAKuqB,iBAAmB,IAAIhC,GAAiB,IAAI8B,UAC3CrqB,KAAKuqB,iBAAiB3W,OAE5B,IAAIoX,EAAMhgB,EAAKhG,KAAKimB,MAAM,KAAKnmB,OAAO,GACtC,GAAmB,IAAfkmB,EAAI1e,OACJ,MAAM,IAAI4e,MAAO,6BAA4BlgB,EAAKhG,QAGtDhF,KAAKyqB,WAAc,eAAcO,EAAI,KACrChrB,KAAK0qB,iBAAoB,qBAEnB1qB,KAAKsqB,cAAca,MAAMnrB,KAAKyqB,WAAYzf,GAGpD,mBACUhL,KAAKsqB,cAAcc,UAAUprB,KAAKyqB,WAAa,GAAEzqB,KAAK0qB,4BAA8B,iBAE1F,IAAIW,EAAmB,iBACnBC,EAAmB,oBACnBhoB,EAAwB,KACxBsY,EAAuB,KAE3B,IAAK,IAAI2P,KAAQvrB,KAAKwqB,SAAU,CAC5B,IAAI7vB,EAAQ4wB,EAAKxX,QAAQpZ,MAAM0wB,GAC/B,GAAc,OAAV1wB,EAKJ,GADAA,EAAQ4wB,EAAKxX,QAAQpZ,MAAM2wB,GACb,OAAV3wB,GAIJ,GAAe,OAAX2I,GAA6B,OAAVsY,EACnB,WAJAA,EAAQjhB,EAAM,QALd2I,EAAS3I,EAAM,GAavB,MAAO,CAAE2I,SAAQsY,SAGrB,cAAa,OAAEtY,IACX,IAAIylB,EACJ,GAAgB,OAAZzlB,EAAiB,CACjB,MAAMkoB,EAAe,GAAExrB,KAAK0qB,6BACtB1qB,KAAKsqB,cAAcc,UAAUprB,KAAKyqB,WAAYe,EAAa,sBACjE,IAAI,KAAEnoB,SAAerD,KAAKsqB,cAAcJ,KAAKsB,GAC7CzC,EAAS1lB,EAAK+mB,WACX,CACH,MAAMoB,EAAe,GAAExrB,KAAK0qB,6BACtB1qB,KAAKsqB,cAAcc,UAAUprB,KAAKyqB,WAAYe,EAAa,oBACjE,IAAI,KAAEnoB,SAAerD,KAAKsqB,cAAcJ,KAAKsB,GACzC1C,EAAmB,IACvB,OAAQxlB,GACJ,IAAM,MACFwlB,EAAW,MACX,MACJ,IAAM,QACFA,EAAW,MACX,MACJ,IAAM,MACFA,EAAW,KAGnBC,QAAe/oB,KAAKuqB,iBAAkBkB,OAAOpoB,EAAK+mB,OAAQtB,GAI9D,OAFA9oB,KAAKsqB,cAAc9B,OAAOnkB,YAC1BrE,KAAKuqB,iBAAkBlmB,YAChB0kB,ICpFf9e,EAAgB6X,qBAAuB,ICrBhC,MAA4B,cAAD,KACvB4J,cADuB,OAEvBjC,YAFuB,OAGvBkC,kBAHuB,OAIvBC,kBAJuB,OAKvBC,cALuB,EAO9B1J,cAAcD,GACVliB,KAAK2rB,aAAe,IAAIG,aACxB9rB,KAAK6rB,SAAW7rB,KAAK2rB,aAAaI,aAClC/rB,KAAK4rB,aAAe5rB,KAAK2rB,aAAaK,iBAEtChsB,KAAK4iB,WAAWV,GAAUhnB,KAAK,KACZ8E,KAAK2rB,aAAcM,wBAAwBjsB,KAAKypB,QACxD5V,QAAQ7T,KAAK6rB,UACpB7rB,KAAK6rB,SAAUhY,QAAQ7T,KAAK4rB,cAC5B5rB,KAAK4rB,aAAc/X,QAAQ7T,KAAK2rB,aAAcO,eAItDnK,gBAAiB,IAAD,EACP/hB,KAAK2rB,eAGV,UAAA3rB,KAAK2rB,oBAAL,SAAmBxB,eACZnqB,KAAK2rB,aACZ3rB,KAAKkjB,eAGT,iBAAiBhB,GACb,MAAMiK,EAAoB,CAEtBC,iBAAiB,EACjBC,aAAc,EACdnK,SAAUA,EACVoK,kBAAkB,EAClBC,kBAAkB,EAClBC,WAAY,MACZC,gBAAgB,GAEpBzsB,KAAKypB,aAAe1uB,UAAUooB,aAAaC,aAAa,CAAEC,MAAO8I,IAGjE,MAAMO,EAAc1sB,KAAKypB,OAAOkD,iBAC5BD,EAAYpgB,OAAS,GACrB9Q,QAAQC,IAAI,kBAAmBixB,EAAY,GAAGE,eAItD,uBACI5sB,KAAK2rB,aAAe,IAAIG,aACxB,MAAMlQ,EAAQ5b,KAAK2rB,aAAaM,wBAAwBjsB,KAAKypB,QAC7DzpB,KAAK0rB,SAAW,IAAImB,KAASjR,EAAO,CAAEkP,WAAY3tB,EAAkB,uBACpE6C,KAAK0rB,SAASoB,SAGlB,sBACI9sB,KAAK0rB,SAASlnB,OAGlB,oBAAqB,IAAD,EAChB,UAAAxE,KAAKypB,cAAL,SAAahd,YAAYsgB,QAAQ/tB,GAASA,EAAMwF,QAGpDye,iBAAiB9kB,GACb6B,KAAK0rB,SAASsB,UAAW5C,IACrB,IAAI6C,EAAMC,IAAIC,gBAAgB/C,GAC1BgD,EAAIC,SAASrQ,cAAc,KAC/BqQ,SAASC,KAAKC,YAAYH,GAC1BA,EAAEnZ,MAAM3B,QAAU,OAClB8a,EAAEje,KAAO8d,EACTG,EAAEjpB,SAAY,GAAEjG,EAAcC,SAC9BivB,EAAEhc,QACF5W,OAAO0yB,IAAIM,gBAAgBP,GAC3BI,SAASC,KAAKG,YAAYL,ODnDtC,WAmBI,IAAIM,EAlBJlzB,OAAOmzB,iBAAiB,eAAgBrU,IAClBlQ,GAAMS,WAAWpB,aAAavD,UAIhDoU,EAAGlF,iBACHkF,EAAGsU,YAAe,4CAGlB7yB,WAAaA,UAAU4G,IACvB5G,UAAU4G,IAAIksB,aAAe,WACzBzkB,GAAMY,SAASd,GAAWvB,SAAS,aAGvCyB,GAAMY,SAASd,GAAWnB,qBAAoB,IAKlDvN,OAAOmzB,iBAAiB,sBAAwB1vB,IAC5CA,EAAEmW,iBACFsZ,EAAiBzvB,IAtBzB,GA0BA,WAEI,IAAI6vB,EAA+D,KAC/DC,GAA6B,EAEjC,SAASC,EAAuBtyB,GAAoD,IAAD,EAC/E,OACKqyB,GAE2B,SAA5BryB,EAAMqN,SAAS3B,WACY,IAA3B1L,EAAMqN,SAAS1B,SAEoB,aAAnC,UAAA3L,EAAMsN,KAAKb,oBAAX,eAAyBzM,SAEO,IAAhCA,EAAMkN,cAAc1D,UACW,IAA/BxJ,EAAM+M,aAAavD,UACY,IAA/BxJ,EAAMoN,aAAa5D,UACW,IAA9BxJ,EAAMiN,YAAYzD,UACY,IAA9BxJ,EAAMgN,YAAYxD,UACW,IAA7BxJ,EAAMmN,WAAW3D,QAIzBkE,GAAM6kB,WAAU,WACZ,MAAMvyB,EAAQ0N,GAAMS,YACkB,IAAlCmkB,EAAuBtyB,IAA6C,OAA1BoyB,EAE1CA,EAAwBnxB,YAAYL,UAChC,IACI,MAAM6L,QAAqB8B,EAAgBC,aAAcpI,kBACzDsH,GAAMY,SAASI,GAAY9B,gBAAgBH,IAC7C,MAAOlK,GACLzC,QAAQQ,MAAMiC,GACd8vB,GAAoB,IAEzB,MACsC,IAAlCC,EAAuBtyB,IAA8C,OAA1BoyB,IAElDhxB,cAAcgxB,GACdA,EAAwB,SAvCpC,GA4CAI,IAASC,OACL,kBAAC,IAAD,CAAU/kB,MAAOA,IACb,kBAAC,GAAD,OAEJikB,SAASe,eAAe,SlC3ErB,SAAkBtzB,GACrB,GAA6C,kBAAmBC,UAAW,CAGvE,GADkB,IAAImyB,IAAImB,eAAwB7zB,OAAOC,SAAS0U,MACpDmf,SAAW9zB,OAAOC,SAAS6zB,OAIrC,OAGJ9zB,OAAOmzB,iBAAiB,OAAQ,KAC5B,MAAM9yB,EAAS,uCAEXP,IAiEhB,SAAiCO,EAAeC,GAE5CyzB,MAAM1zB,EAAO,CACT2zB,QAAS,CAAE,iBAAkB,YAE5BtzB,KAAKuzB,IAEF,MAAMC,EAAcD,EAASD,QAAQG,IAAI,gBACjB,MAApBF,EAASG,QAAkC,MAAfF,IAA8D,IAAvCA,EAAY/rB,QAAQ,cAEvE5H,UAAUC,cAAc6zB,MAAM3zB,KAAKC,IAC/BA,EAAa2zB,aAAa5zB,KAAK,KAC3BV,OAAOC,SAAS+b,aAKxB5b,EAAgBC,EAAOC,KAG9BiB,MAAM,KACHP,QAAQC,IAAI,mEApFRszB,CAAwBl0B,EAAOC,GAI/BC,UAAUC,cAAc6zB,MAAM3zB,KAAK,KAC/BM,QAAQC,IACJ,gHAKRb,EAAgBC,EAAOC,MkCoDvCE,K","file":"static/js/main.1aed9c03.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/chrome-icon.f3b6c54c.svg\";","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"ffb88193b05ec63929fd.worker.js\");\n};","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n    window.location.hostname === 'localhost' ||\n        // [::1] is the IPv6 localhost address.\n        window.location.hostname === '[::1]' ||\n        // 127.0.0.0/8 are considered localhost for IPv4.\n        window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n    onSuccess?: (registration: ServiceWorkerRegistration) => void;\n    onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n    if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n        // The URL constructor is available in all browsers that support SW.\n        const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n        if (publicUrl.origin !== window.location.origin) {\n            // Our service worker won't work if PUBLIC_URL is on a different origin\n            // from what our page is served on. This might happen if a CDN is used to\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n            return;\n        }\n\n        window.addEventListener('load', () => {\n            const swUrl = `${process.env.PUBLIC_URL}/final-service-worker.js`;\n\n            if (isLocalhost) {\n                // This is running on localhost. Let's check if a service worker still exists or not.\n                checkValidServiceWorker(swUrl, config);\n\n                // Add some additional logging to localhost, pointing developers to the\n                // service worker/PWA documentation.\n                navigator.serviceWorker.ready.then(() => {\n                    console.log(\n                        'This web app is being served cache-first by a service ' + 'worker. To learn more, visit https://bit.ly/CRA-PWA'\n                    );\n                });\n            } else {\n                // Is not localhost. Just register service worker\n                registerValidSW(swUrl, config);\n            }\n        });\n    }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n    navigator.serviceWorker\n        .register(swUrl)\n        .then(registration => {\n            registration.onupdatefound = () => {\n                const installingWorker = registration.installing;\n                if (installingWorker == null) {\n                    return;\n                }\n                installingWorker.onstatechange = () => {\n                    console.log('state change', installingWorker.state);\n                    if (installingWorker.state === 'installed') {\n                        if (navigator.serviceWorker.controller) {\n                            // At this point, the updated precached content has been fetched,\n                            // but the previous service worker will still serve the older\n                            // content until all client tabs are closed.\n                            console.log(\n                                'New content is available and will be used when all ' +\n                                    'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n                            );\n\n                            // Execute callback\n                            if (config && config.onUpdate) {\n                                config.onUpdate(registration);\n                            }\n                        } else {\n                            // At this point, everything has been precached.\n                            // It's the perfect time to display a\n                            // \"Content is cached for offline use.\" message.\n                            console.log('Content is cached for offline use.');\n\n                            // Execute callback\n                            if (config && config.onSuccess) {\n                                config.onSuccess(registration);\n                            }\n                        }\n                    }\n                };\n            };\n            registration.update(); // Check for new version everytime we load the page\n        })\n        .catch(error => {\n            console.error('Error during service worker registration:', error);\n        });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n    // Check if the service worker can be found. If it can't reload the page.\n    fetch(swUrl, {\n        headers: { 'Service-Worker': 'script' },\n    })\n        .then(response => {\n            // Ensure service worker exists, and that we really are getting a JS file.\n            const contentType = response.headers.get('content-type');\n            if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n                // No service worker found. Probably a different app. Reload the page.\n                navigator.serviceWorker.ready.then(registration => {\n                    registration.unregister().then(() => {\n                        window.location.reload();\n                    });\n                });\n            } else {\n                // Service worker found. Proceed as normal.\n                registerValidSW(swUrl, config);\n            }\n        })\n        .catch(() => {\n            console.log('No internet connection found. App is running in offline mode.');\n        });\n}\n\nexport function unregister() {\n    if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.ready.then(registration => {\n            registration.unregister();\n        });\n    }\n}\n","import { Disc, formatTimeFromFrames, Encoding } from 'netmd-js';\nimport { useSelector, shallowEqual } from 'react-redux';\nimport { RootState } from './redux/store';\nimport { Mutex } from 'async-mutex';\nimport { Theme } from '@material-ui/core';\n\nexport function sleep(ms: number) {\n    return new Promise(resolve => {\n        setTimeout(resolve, ms);\n    });\n}\n\nexport async function sleepWithProgressCallback(ms: number, cb: (perc: number) => void) {\n    let elapsedSecs = 1;\n    let interval = setInterval(() => {\n        elapsedSecs++;\n        cb(Math.min(100, ((elapsedSecs * 1000) / ms) * 100));\n    }, 1000);\n    await sleep(ms);\n    window.clearInterval(interval);\n}\n\nexport function useShallowEqualSelector<TState = RootState, TSelected = unknown>(selector: (state: TState) => TSelected): TSelected {\n    return useSelector(selector, shallowEqual);\n}\n\nexport function debugEnabled() {\n    return process.env.NODE_ENV === 'development';\n}\n\nexport function getPublicPathFor(script: string) {\n    return `${process.env.PUBLIC_URL}/${script}`;\n}\n\nexport function savePreference(key: string, value: unknown) {\n    localStorage.setItem(key, JSON.stringify(value));\n}\n\nexport function loadPreference<T>(key: string, defaultValue: T): T {\n    let res = localStorage.getItem(key);\n    if (res === null) {\n        return defaultValue;\n    } else {\n        try {\n            return JSON.parse(res) as T;\n        } catch (e) {\n            return defaultValue;\n        }\n    }\n}\n\nexport function getAvailableCharsForTrackTitle(trackTitles: string[]) {\n    const maxChars = 1700; // see https://www.minidisc.org/md_toc.html\n    const usedChars = trackTitles.reduce((acc, title) => {\n        return acc + title.length;\n    }, 0);\n    return maxChars - usedChars;\n}\n\nexport function framesToSec(frames: number) {\n    return frames / 512;\n}\n\nexport function sanitizeTitle(title: string) {\n    return title.normalize('NFD').replace(/[^\\x00-\\x7F]/g, '');\n}\n\nconst EncodingName: { [k: number]: string } = {\n    [Encoding.sp]: 'SP',\n    [Encoding.lp2]: 'LP2',\n    [Encoding.lp4]: 'LP4',\n};\n\nexport function getSortedTracks(disc: Disc | null) {\n    let tracks: { index: number; title: string; group: string; duration: string; encoding: string }[] = [];\n    if (disc !== null) {\n        for (let group of disc.groups) {\n            for (let track of group.tracks) {\n                tracks.push({\n                    index: track.index,\n                    title: track.title ?? `Unknown Title`,\n                    group: group.title ?? ``,\n                    encoding: EncodingName[track.encoding],\n                    duration: formatTimeFromFrames(track.duration, false),\n                });\n            }\n        }\n    }\n    tracks.sort((l, r) => l.index - r.index);\n    return tracks;\n}\n\nexport function asyncMutex(target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    // This is meant to be used only with classes having a \"mutex\" instance property\n    const oldValue = descriptor.value;\n    descriptor.value = async function(...args: any) {\n        const mutex = (this as any).mutex as Mutex;\n        const release = await mutex.acquire();\n        try {\n            return await oldValue.apply(this, args);\n        } finally {\n            release();\n        }\n    };\n    return descriptor;\n}\n\nexport function forAnyDesktop(theme: Theme) {\n    return theme.breakpoints.up(600 + theme.spacing(2) * 2);\n}\n\nexport function belowDesktop(theme: Theme) {\n    return theme.breakpoints.down(600 + theme.spacing(2) * 2);\n}\n\nexport function forWideDesktop(theme: Theme) {\n    return theme.breakpoints.up(700 + theme.spacing(2) * 2) + ` and (min-height: 750px)`;\n}\n\ndeclare let process: any;\n","import {\n    openNewDevice,\n    NetMDInterface,\n    Disc,\n    listContent,\n    openPairedDevice,\n    Wireformat,\n    MDTrack,\n    download,\n    getDeviceStatus,\n    DeviceStatus,\n} from 'netmd-js';\nimport { makeGetAsyncPacketIteratorOnWorkerThread } from 'netmd-js/dist/web-encrypt-worker';\nimport { Logger } from 'netmd-js/dist/logger';\nimport { asyncMutex, sanitizeTitle, sleep } from '../utils';\nimport { Mutex } from 'async-mutex';\n\nconst Worker = require('worker-loader!netmd-js/dist/web-encrypt-worker.js'); // eslint-disable-line import/no-webpack-loader-syntax\n\nexport interface NetMDService {\n    mutex: Mutex;\n    getDeviceStatus(): Promise<DeviceStatus>;\n    pair(): Promise<boolean>;\n    connect(): Promise<boolean>;\n    listContent(): Promise<Disc>;\n    getDeviceName(): Promise<string>;\n    finalize(): Promise<void>;\n    renameTrack(index: number, newTitle: string): Promise<void>;\n    renameDisc(newName: string): Promise<void>;\n    deleteTrack(index: number): Promise<void>;\n    moveTrack(src: number, dst: number): Promise<void>;\n    wipeDisc(): Promise<void>;\n    upload(\n        title: string,\n        data: ArrayBuffer,\n        format: Wireformat,\n        progressCallback: (progress: { written: number; encrypted: number; total: number }) => void\n    ): Promise<void>;\n\n    play(): Promise<void>;\n    pause(): Promise<void>;\n    stop(): Promise<void>;\n    next(): Promise<void>;\n    prev(): Promise<void>;\n    gotoTrack(index: number): Promise<void>;\n    getPosition(): Promise<number[] | null>;\n}\n\nexport class NetMDUSBService implements NetMDService {\n    private netmdInterface?: NetMDInterface;\n    private logger?: Logger;\n    public mutex = new Mutex();\n    public statusMonitorTimer: any;\n\n    constructor({ debug = false }: { debug: boolean }) {\n        if (debug) {\n            // Logging a few methods that have been causing issues with some units\n            const _fn = (...args: any) => {\n                if (args && args[0] && args[0].method) {\n                    console.log(...args);\n                }\n            };\n            this.logger = {\n                debug: _fn,\n                info: _fn,\n                warn: _fn,\n                error: _fn,\n                child: () => this.logger!,\n            };\n        }\n    }\n\n    async pair() {\n        let iface = await openNewDevice(navigator.usb, this.logger);\n        if (iface === null) {\n            return false;\n        }\n        this.netmdInterface = iface;\n        return true;\n    }\n\n    async connect() {\n        let iface = await openPairedDevice(navigator.usb, this.logger);\n        if (iface === null) {\n            return false;\n        }\n        this.netmdInterface = iface;\n        return true;\n    }\n\n    @asyncMutex\n    async listContent() {\n        return await listContent(this.netmdInterface!);\n    }\n\n    @asyncMutex\n    async getDeviceStatus() {\n        return await getDeviceStatus(this.netmdInterface!);\n    }\n\n    @asyncMutex\n    async getDeviceName() {\n        return await this.netmdInterface!.netMd.getDeviceName();\n    }\n\n    @asyncMutex\n    async finalize() {\n        await this.netmdInterface!.netMd.finalize();\n    }\n\n    @asyncMutex\n    async renameTrack(index: number, title: string) {\n        // Removing non ascii chars... Sorry, I didn't implement char encoding.\n        title = sanitizeTitle(title);\n        await this.netmdInterface!.cacheTOC();\n        await this.netmdInterface!.setTrackTitle(index, title);\n        await this.netmdInterface!.syncTOC();\n    }\n\n    @asyncMutex\n    async renameDisc(newName: string) {\n        // TODO: This whole function should be moved in netmd-js\n        const oldName = await this.netmdInterface!.getDiscTitle();\n        const oldRawName = await this.netmdInterface!._getDiscTitle();\n        const hasGroups = oldRawName.indexOf('//') >= 0;\n        const hasGroupsAndTitle = oldRawName.startsWith('0;');\n\n        if (newName === oldName) {\n            return;\n        }\n\n        let newNameWithGroups;\n\n        if (hasGroups) {\n            if (hasGroupsAndTitle) {\n                newNameWithGroups = oldRawName.replace(/^0;.*?\\/\\//, newName !== '' ? `0;${newName}//` : ``); // Replace or delete the old title\n            } else {\n                newNameWithGroups = `0;${newName}//${oldRawName}`; // Add the new title\n            }\n        } else {\n            newNameWithGroups = newName;\n        }\n\n        await this.netmdInterface!.cacheTOC();\n        await this.netmdInterface!.setDiscTitle(newNameWithGroups);\n        await this.netmdInterface!.syncTOC();\n    }\n\n    @asyncMutex\n    async deleteTrack(index: number) {\n        await this.netmdInterface!.eraseTrack(index);\n        await sleep(100);\n    }\n\n    @asyncMutex\n    async wipeDisc() {\n        await this.netmdInterface!.eraseDisc();\n    }\n\n    @asyncMutex\n    async moveTrack(src: number, dst: number) {\n        await this.netmdInterface!.moveTrack(src, dst);\n    }\n\n    async upload(\n        title: string,\n        data: ArrayBuffer,\n        format: Wireformat,\n        progressCallback: (progress: { written: number; encrypted: number; total: number }) => void\n    ) {\n        let total = data.byteLength;\n        let written = 0;\n        let encrypted = 0;\n        function updateProgress() {\n            progressCallback({ written, encrypted, total });\n        }\n\n        let w = new Worker();\n\n        let webWorkerAsyncPacketIterator = makeGetAsyncPacketIteratorOnWorkerThread(w, ({ encryptedBytes }) => {\n            encrypted = encryptedBytes;\n            updateProgress();\n        });\n\n        // Removing non ascii chars... Sorry, I didn't implement char encoding.\n        title = sanitizeTitle(title);\n        let mdTrack = new MDTrack(title, format, data, 0x80000, webWorkerAsyncPacketIterator);\n\n        await download(this.netmdInterface!, mdTrack, ({ writtenBytes }) => {\n            written = writtenBytes;\n            updateProgress();\n        });\n\n        w.terminate();\n    }\n\n    @asyncMutex\n    async play() {\n        await this.netmdInterface!.play();\n    }\n    @asyncMutex\n    async pause() {\n        await this.netmdInterface!.pause();\n    }\n    @asyncMutex\n    async stop() {\n        await this.netmdInterface!.stop();\n    }\n    @asyncMutex\n    async next() {\n        await this.netmdInterface!.nextTrack();\n    }\n    @asyncMutex\n    async prev() {\n        await this.netmdInterface!.previousTrack();\n    }\n\n    @asyncMutex\n    async gotoTrack(index: number) {\n        await this.netmdInterface!.gotoTrack(index);\n    }\n\n    @asyncMutex\n    async getPosition() {\n        return await this.netmdInterface!.getPosition();\n    }\n}\n","import { NetMDService } from './netmd';\nimport { AudioExportService } from './audio-export';\nimport { MediaRecorderService } from './mediarecorder';\n\ninterface ServiceRegistry {\n    netmdService?: NetMDService;\n    audioExportService?: AudioExportService;\n    mediaRecorderService?: MediaRecorderService;\n}\n\nconst ServiceRegistry: ServiceRegistry = {};\n\nexport default ServiceRegistry;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface LoadingDialogState {\n    visible: boolean;\n    cancelled: boolean;\n\n    writtenProgress: number;\n    encryptedProgress: number;\n    totalProgress: number;\n\n    trackTotal: number;\n    trackConverting: number;\n    trackCurrent: number;\n\n    titleCurrent: string;\n    titleConverting: string;\n}\n\nconst initialState: LoadingDialogState = {\n    visible: false,\n    cancelled: false,\n\n    // Current Track Upload\n    writtenProgress: 0,\n    encryptedProgress: 0,\n    totalProgress: 1,\n\n    // Tracks done\n    trackTotal: 1,\n    trackConverting: 0,\n    trackCurrent: 0,\n    titleCurrent: '',\n    titleConverting: '',\n};\n\nexport const slice = createSlice({\n    name: 'uploadDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setWriteProgress: (state, action: PayloadAction<{ written: number; encrypted: number; total: number }>) => {\n            state.encryptedProgress = action.payload.encrypted;\n            state.writtenProgress = action.payload.written;\n            state.totalProgress = action.payload.total;\n        },\n        setCancelUpload: (state, action: PayloadAction<boolean>) => {\n            state.cancelled = action.payload;\n        },\n        setTrackProgress: (\n            state,\n            action: PayloadAction<{ total: number; current: number; converting: number; titleCurrent: string; titleConverting: string }>\n        ) => {\n            state.trackTotal = action.payload.total;\n            state.trackCurrent = action.payload.current;\n            state.trackConverting = action.payload.converting;\n            state.titleCurrent = action.payload.titleCurrent;\n            state.titleConverting = action.payload.titleConverting;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface RenameDialogState {\n    visible: boolean;\n    title: string;\n    index: number;\n}\n\nconst initialState: RenameDialogState = {\n    visible: false,\n    title: '',\n    index: -1,\n};\n\nexport const slice = createSlice({\n    name: 'renameDialog',\n    initialState,\n    reducers: {\n        setVisible: (state: RenameDialogState, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setCurrentName: (state: RenameDialogState, action: PayloadAction<string>) => {\n            state.title = action.payload;\n        },\n        setIndex: (state: RenameDialogState, action: PayloadAction<number>) => {\n            state.index = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface ErrorDialogState {\n    visible: boolean;\n    error: string;\n}\n\nconst initialState: ErrorDialogState = {\n    visible: false,\n    error: ``,\n};\n\nconst slice = createSlice({\n    name: 'errorDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setErrorMessage: (state, action: PayloadAction<string>) => {\n            state.error = `${action.payload}`;\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport const initialState = {\n    visible: false,\n    dismissed: false, // This will prevent showing the dialog during the same session\n};\n\nconst slice = createSlice({\n    name: 'panicDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        dismiss: (state, action: PayloadAction<void>) => {\n            state.visible = false;\n            state.dismissed = true;\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\nimport { savePreference, loadPreference } from '../utils';\n\nexport type TitleFormatType = 'filename' | 'title' | 'album-title' | 'artist-title' | 'artist-album-title';\nexport type UploadFormat = 'SP' | 'LP2' | 'LP4';\n\nexport interface ConvertDialogFeature {\n    visible: boolean;\n    format: UploadFormat;\n    titleFormat: TitleFormatType;\n}\n\nconst initialState: ConvertDialogFeature = {\n    visible: false,\n    format: loadPreference('uploadFormat', 'LP2') as UploadFormat,\n    titleFormat: loadPreference('trackTitleFormat', 'filename') as TitleFormatType,\n};\n\nconst slice = createSlice({\n    name: 'convertDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setFormat: (state, action: PayloadAction<UploadFormat>) => {\n            state.format = action.payload;\n            savePreference('uploadFormat', state.format);\n        },\n        setTitleFormat: (state, action: PayloadAction<TitleFormatType>) => {\n            state.titleFormat = action.payload;\n            savePreference('trackTitleFormat', state.titleFormat);\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface DumpDialogState {\n    visible: boolean;\n    inputDeviceId: string;\n}\n\nconst initialState: DumpDialogState = {\n    visible: false,\n    inputDeviceId: '',\n};\n\nexport const slice = createSlice({\n    name: 'dumpDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setInputDeviceId: (state, action: PayloadAction<string>) => {\n            state.inputDeviceId = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface RecordingDialogState {\n    visible: boolean;\n\n    trackTotal: number;\n    trackDone: number;\n    trackCurrent: number;\n\n    titleCurrent: string;\n}\n\nconst initialState: RecordingDialogState = {\n    visible: false,\n\n    trackTotal: 1,\n    trackDone: 0,\n    trackCurrent: 0,\n\n    titleCurrent: '',\n\n    // visible: true,\n    // trackTotal: 4,\n    // trackDone: 1,\n    // trackCurrent: 25,\n\n    // titleCurrent: 'Seconda traccia',\n};\n\nexport const slice = createSlice({\n    name: 'recordDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setProgress: (\n            state,\n            action: PayloadAction<{ trackTotal: number; trackDone: number; trackCurrent: number; titleCurrent: string }>\n        ) => {\n            state.trackTotal = action.payload.trackTotal;\n            state.trackDone = action.payload.trackDone;\n            state.trackCurrent = action.payload.trackCurrent;\n            state.titleCurrent = action.payload.titleCurrent;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\nimport { savePreference, loadPreference } from '../utils';\n\ntype Views = 'WELCOME' | 'MAIN';\n\nexport interface AppState {\n    mainView: Views;\n    loading: boolean;\n    pairingFailed: boolean;\n    pairingMessage: string;\n    browserSupported: boolean;\n    darkMode: boolean;\n    aboutDialogVisible: boolean;\n}\n\nconst initialState: AppState = {\n    mainView: 'WELCOME',\n    loading: false,\n    pairingFailed: false,\n    pairingMessage: ``,\n    browserSupported: true,\n    darkMode: loadPreference('darkMode', false),\n    aboutDialogVisible: false,\n};\n\nexport const slice = createSlice({\n    name: 'app',\n    initialState,\n    reducers: {\n        setState: (state, action: PayloadAction<Views>) => {\n            state.mainView = action.payload;\n        },\n        setLoading: (state, action: PayloadAction<boolean>) => {\n            state.loading = action.payload;\n        },\n        setPairingFailed: (state, action: PayloadAction<boolean>) => {\n            state.pairingFailed = action.payload;\n        },\n        setPairingMessage: (state, action: PayloadAction<string>) => {\n            state.pairingMessage = action.payload;\n        },\n        setBrowserSupported: (state, action: PayloadAction<boolean>) => {\n            state.browserSupported = action.payload;\n        },\n        setDarkMode: (state, action: PayloadAction<boolean>) => {\n            state.darkMode = action.payload;\n            savePreference('darkMode', state.darkMode);\n        },\n        showAboutDialog: (state, action: PayloadAction<boolean>) => {\n            state.aboutDialogVisible = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { Disc, DeviceStatus } from 'netmd-js';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface MainState {\n    disc: Disc | null;\n    deviceName: string;\n    deviceStatus: DeviceStatus | null;\n}\n\nconst initialState: MainState = {\n    disc: null,\n    deviceName: '',\n    deviceStatus: null,\n};\n\nexport const slice = createSlice({\n    name: 'main',\n    initialState,\n    reducers: {\n        setDisc: (state, action: PayloadAction<Disc>) => {\n            state.disc = action.payload;\n        },\n        setDeviceName: (state, action: PayloadAction<string>) => {\n            state.deviceName = action.payload;\n        },\n        setDeviceStatus: (state, action: PayloadAction<DeviceStatus | null>) => {\n            state.deviceStatus = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { configureStore, getDefaultMiddleware, Middleware, combineReducers } from '@reduxjs/toolkit';\nimport uploadDialog from './upload-dialog-feature';\nimport renameDialog from './rename-dialog-feature';\nimport errorDialog from './error-dialog-feature';\nimport panicDialog, { actions as panicDialogActions } from './panic-dialog-feature';\nimport convertDialog from './convert-dialog-feature';\nimport dumpDialog from './dump-dialog-feature';\nimport recordDialog from './record-dialog-feature';\nimport appState, { actions as appActions } from './app-feature';\nimport main from './main-feature';\n\nconst errorCatcher: Middleware = store => next => async action => {\n    try {\n        await next(action);\n    } catch (e) {\n        console.error(e);\n        next(panicDialogActions.setVisible(true));\n    }\n};\n\nlet reducer = combineReducers({\n    renameDialog,\n    uploadDialog,\n    errorDialog,\n    panicDialog,\n    convertDialog,\n    dumpDialog,\n    recordDialog,\n    appState,\n    main,\n});\n\nconst resetStateAction = appActions.setState.toString();\nconst resetStatePayoload = 'WELCOME';\nconst resetStateReducer: typeof reducer = function(...args) {\n    const [state, action] = args;\n    if (action.type === resetStateAction && action.payload === resetStatePayoload) {\n        return initialState;\n    }\n    return reducer(...args);\n};\n\nexport const store = configureStore({\n    reducer: resetStateReducer,\n    middleware: [errorCatcher, ...getDefaultMiddleware()],\n});\n\nconst initialState = Object.freeze(store.getState());\n\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppDispatch = typeof store.dispatch;\n","import { batchActions } from 'redux-batched-actions';\nimport { AppDispatch, RootState } from './store';\nimport { actions as uploadDialogActions } from './upload-dialog-feature';\nimport { actions as renameDialogActions } from './rename-dialog-feature';\nimport { actions as errorDialogAction } from './error-dialog-feature';\nimport { actions as recordDialogAction } from './record-dialog-feature';\nimport { actions as appStateActions } from './app-feature';\nimport { actions as mainActions } from './main-feature';\nimport serviceRegistry from '../services/registry';\nimport { Wireformat, getTracks } from 'netmd-js';\nimport { AnyAction } from '@reduxjs/toolkit';\nimport { getAvailableCharsForTrackTitle, framesToSec, sleepWithProgressCallback, sleep } from '../utils';\nimport * as mm from 'music-metadata-browser';\nimport { TitleFormatType, UploadFormat } from './convert-dialog-feature';\n\nexport function control(action: 'play' | 'stop' | 'next' | 'prev' | 'goto', params?: unknown) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        switch (action) {\n            case 'play':\n                await serviceRegistry.netmdService!.play();\n                break;\n            case 'stop':\n                await serviceRegistry.netmdService!.stop();\n                break;\n            case 'next':\n                await serviceRegistry.netmdService!.next();\n                break;\n            case 'prev':\n                await serviceRegistry.netmdService!.prev();\n                break;\n            case 'goto':\n                if (params && typeof params === 'number' && params >= 0) {\n                    await serviceRegistry.netmdService!.gotoTrack(params);\n                }\n                break;\n        }\n        // CAVEAT: change-track might take a up to a few seconds to complete.\n        // We wait 500ms and let the monitor do further updates\n        await sleep(500);\n        try {\n            let deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n            dispatch(mainActions.setDeviceStatus(deviceStatus));\n        } catch (e) {\n            console.log('control: Cannot get device status');\n        }\n    };\n}\n\nexport function pair() {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        dispatch(appStateActions.setPairingFailed(false));\n\n        await serviceRegistry.audioExportService!.init();\n\n        try {\n            let connected = await serviceRegistry.netmdService!.connect();\n            if (connected) {\n                dispatch(appStateActions.setState('MAIN'));\n                return;\n            }\n        } catch (err) {\n            console.error(err);\n            // In case of error, just log and try to pair\n        }\n\n        try {\n            let paired = await serviceRegistry.netmdService!.pair();\n            if (paired) {\n                dispatch(appStateActions.setState('MAIN'));\n                return;\n            }\n            dispatch(batchActions([appStateActions.setPairingMessage(`Connection Failed`), appStateActions.setPairingFailed(true)]));\n        } catch (err) {\n            console.error(err);\n            let message = (err as Error).message;\n            dispatch(batchActions([appStateActions.setPairingMessage(message), appStateActions.setPairingFailed(true)]));\n        }\n    };\n}\n\nexport function listContent() {\n    return async function(dispatch: AppDispatch) {\n        // Issue loading\n        dispatch(appStateActions.setLoading(true));\n        let disc = await serviceRegistry.netmdService!.listContent();\n        let deviceName = await serviceRegistry.netmdService!.getDeviceName();\n        let deviceStatus = null;\n        try {\n            deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n        } catch (e) {\n            console.log('listContent: Cannot get device status');\n        }\n        dispatch(\n            batchActions([\n                mainActions.setDisc(disc),\n                mainActions.setDeviceName(deviceName),\n                mainActions.setDeviceStatus(deviceStatus),\n                appStateActions.setLoading(false),\n            ])\n        );\n    };\n}\n\nexport function renameTrack({ index, newName }: { index: number; newName: string }) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        dispatch(renameDialogActions.setVisible(false));\n        try {\n            await netmdService!.renameTrack(index, newName);\n        } catch (err) {\n            console.error(err);\n            dispatch(batchActions([errorDialogAction.setVisible(true), errorDialogAction.setErrorMessage(`Rename failed.`)]));\n        }\n        listContent()(dispatch);\n    };\n}\n\nexport function renameDisc({ newName }: { newName: string }) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        await netmdService!.renameDisc(newName);\n        dispatch(renameDialogActions.setVisible(false));\n        listContent()(dispatch);\n    };\n}\n\nexport function deleteTracks(indexes: number[]) {\n    return async function(dispatch: AppDispatch) {\n        const confirmation = window.confirm(\n            `Proceed with Delete Track${indexes.length !== 1 ? 's' : ''}? This operation cannot be undone.`\n        );\n        if (!confirmation) {\n            return;\n        }\n        const { netmdService } = serviceRegistry;\n        dispatch(appStateActions.setLoading(true));\n        indexes = indexes.sort();\n        indexes.reverse();\n        for (let index of indexes) {\n            await netmdService!.deleteTrack(index);\n        }\n        listContent()(dispatch);\n    };\n}\n\nexport function wipeDisc() {\n    return async function(dispatch: AppDispatch) {\n        const confirmation = window.confirm(`Proceed with Wipe Disc? This operation cannot be undone.`);\n        if (!confirmation) {\n            return;\n        }\n        const { netmdService } = serviceRegistry;\n        dispatch(appStateActions.setLoading(true));\n        await netmdService!.wipeDisc();\n        listContent()(dispatch);\n    };\n}\n\nexport function moveTrack(srcIndex: number, destIndex: number) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        await netmdService!.moveTrack(srcIndex, destIndex);\n        listContent()(dispatch);\n    };\n}\n\nexport function recordTracks(indexes: number[], deviceId: string) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        dispatch(\n            batchActions([\n                recordDialogAction.setVisible(true),\n                recordDialogAction.setProgress({ trackTotal: indexes.length, trackDone: 0, trackCurrent: 0, titleCurrent: '' }),\n            ])\n        );\n\n        let disc = getState().main.disc;\n        let tracks = getTracks(disc!).filter(t => indexes.indexOf(t.index) >= 0);\n\n        const { netmdService, mediaRecorderService } = serviceRegistry;\n        await serviceRegistry.netmdService!.stop();\n\n        for (let [i, track] of tracks.entries()) {\n            dispatch(\n                recordDialogAction.setProgress({\n                    trackTotal: tracks.length,\n                    trackDone: i,\n                    trackCurrent: -1,\n                    titleCurrent: track.title ?? '',\n                })\n            );\n\n            // Wait for the track to be ready to play from 0:00\n            await netmdService!.gotoTrack(track.index);\n            await netmdService!.play();\n            console.log('Waiting for track to be ready to play');\n            let position = await netmdService!.getPosition();\n            let expected = [track.index, 0, 0, 1];\n            while (position === null || !expected.every((_, i) => expected[i] === position![i])) {\n                await sleep(250);\n                position = await netmdService!.getPosition();\n            }\n            await netmdService!.pause();\n            await netmdService?.gotoTrack(track.index);\n            console.log('Track is ready to play');\n\n            // Start recording and play track\n            await mediaRecorderService?.initStream(deviceId);\n            await mediaRecorderService?.startRecording();\n            await netmdService!.play();\n\n            // Wait until track is finished\n            let durationInSec = framesToSec(track.duration);\n            // await sleep(durationInSec * 1000);\n            await sleepWithProgressCallback(durationInSec * 1000, (perc: number) => {\n                dispatch(\n                    recordDialogAction.setProgress({\n                        trackTotal: tracks.length,\n                        trackDone: i,\n                        trackCurrent: perc,\n                        titleCurrent: track.title ?? '',\n                    })\n                );\n            });\n\n            // Stop recording and download the wav\n            await mediaRecorderService?.stopRecording();\n            mediaRecorderService?.downloadRecorded(`${track.title}`);\n\n            await mediaRecorderService?.closeStream();\n        }\n\n        await netmdService!.stop();\n        dispatch(recordDialogAction.setVisible(false));\n    };\n}\n\nexport const WireformatDict: { [k: string]: Wireformat } = {\n    SP: Wireformat.pcm,\n    LP2: Wireformat.lp2,\n    LP105: Wireformat.l105kbps,\n    LP4: Wireformat.lp4,\n};\n\nasync function getTrackNameFromMediaTags(file: File, titleFormat: TitleFormatType) {\n    const fileData = await file.arrayBuffer();\n    const blob = new Blob([new Uint8Array(fileData)]);\n    let metadata = await mm.parseBlob(blob);\n    const title = metadata.common.title ?? 'Unknown Title';\n    const artist = metadata.common.artist ?? 'Unknown Artist';\n    const album = metadata.common.album ?? 'Unknown Album';\n    switch (titleFormat) {\n        case 'title': {\n            return title;\n        }\n        case 'artist-title': {\n            return `${artist} - ${title}`;\n        }\n        case 'album-title': {\n            return `${album} - ${title}`;\n        }\n        case 'artist-album-title': {\n            return `${artist} - ${album} - ${title}`;\n        }\n        case 'filename': {\n            let title = file.name;\n            // Remove file extension\n            const extStartIndex = title.lastIndexOf('.');\n            if (extStartIndex > 0) {\n                title = title.substring(0, extStartIndex);\n            }\n            return title;\n        }\n    }\n}\n\nexport function convertAndUpload(files: File[], format: UploadFormat, titleFormat: TitleFormatType) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        const { audioExportService, netmdService } = serviceRegistry;\n        const wireformat = WireformatDict[format];\n\n        await netmdService?.stop();\n        dispatch(batchActions([uploadDialogActions.setVisible(true), uploadDialogActions.setCancelUpload(false)]));\n\n        const updateProgressCallback = ({ written, encrypted, total }: { written: number; encrypted: number; total: number }) => {\n            dispatch(uploadDialogActions.setWriteProgress({ written, encrypted, total }));\n        };\n\n        const hasUploadBeenCancelled = () => {\n            return getState().uploadDialog.cancelled;\n        };\n\n        let trackUpdate: {\n            current: number;\n            converting: number;\n            total: number;\n            titleCurrent: string;\n            titleConverting: string;\n        } = {\n            current: 0,\n            converting: 0,\n            total: files.length,\n            titleCurrent: '',\n            titleConverting: '',\n        };\n        const updateTrack = () => {\n            dispatch(uploadDialogActions.setTrackProgress(trackUpdate));\n        };\n\n        let conversionIterator = async function*(files: File[]) {\n            let converted: Promise<{ file: File; data: ArrayBuffer }>[] = [];\n\n            let i = 0;\n            function convertNext() {\n                if (i === files.length || hasUploadBeenCancelled()) {\n                    trackUpdate.converting = i;\n                    trackUpdate.titleConverting = ``;\n                    updateTrack();\n                    return;\n                }\n\n                let f = files[i];\n                trackUpdate.converting = i;\n                trackUpdate.titleConverting = f.name;\n                updateTrack();\n                i++;\n\n                converted.push(\n                    new Promise(async (resolve, reject) => {\n                        let data: ArrayBuffer;\n                        try {\n                            await audioExportService!.prepare(f);\n                            data = await audioExportService!.export({ format });\n                            convertNext();\n                            resolve({ file: f, data: data });\n                        } catch (err) {\n                            error = err;\n                            errorMessage = `${f.name}: Unsupported or unrecognized format`;\n                            reject(err);\n                        }\n                    })\n                );\n            }\n            convertNext();\n\n            let j = 0;\n            while (j < converted.length) {\n                yield await converted[j];\n                delete converted[j];\n                j++;\n            }\n        };\n\n        let disc = getState().main.disc;\n        let maxTitleLength = disc ? getAvailableCharsForTrackTitle(getTracks(disc).map(track => track.title || ``)) : -1;\n        maxTitleLength = Math.floor(maxTitleLength / files.length);\n\n        let error: any;\n        let errorMessage = ``;\n        let i = 1;\n        for await (let item of conversionIterator(files)) {\n            if (hasUploadBeenCancelled()) {\n                break;\n            }\n\n            const { file, data } = item;\n\n            let title = file.name;\n            try {\n                title = await getTrackNameFromMediaTags(file, titleFormat);\n            } catch (err) {\n                console.error(err);\n            }\n\n            if (maxTitleLength > -1) {\n                title = title.substring(0, maxTitleLength);\n            }\n\n            trackUpdate.current = i++;\n            trackUpdate.titleCurrent = title;\n            updateTrack();\n            updateProgressCallback({ written: 0, encrypted: 0, total: 100 });\n            try {\n                await netmdService?.upload(title, data, wireformat, updateProgressCallback);\n            } catch (err) {\n                error = err;\n                errorMessage = `${file.name}: Error uploading to device`;\n                break;\n            }\n        }\n\n        let actionToDispatch: AnyAction[] = [uploadDialogActions.setVisible(false)];\n\n        if (error) {\n            console.error(error);\n            actionToDispatch = actionToDispatch.concat([\n                errorDialogAction.setVisible(true),\n                errorDialogAction.setErrorMessage(errorMessage),\n            ]);\n        }\n\n        dispatch(batchActions(actionToDispatch));\n        listContent()(dispatch);\n    };\n}\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as appActions } from '../redux/app-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport Link from '@material-ui/core/Link';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const AboutDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let visible = useShallowEqualSelector(state => state.appState.aboutDialogVisible);\n\n    const handleClose = () => {\n        dispatch(appActions.showAboutDialog(false));\n    };\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"about-dialog-slide-title\"\n        >\n            <DialogTitle id=\"about-dialog-slide-title\">About Web MiniDisc</DialogTitle>\n            <DialogContent>\n                <DialogContentText>Web MiniDisc has been made possible by</DialogContentText>\n                <ul>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://www.ffmpeg.org/\" target=\"_blank\">\n                            FFmpeg\n                        </Link>{' '}\n                        and{' '}\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/ffmpegjs/FFmpeg\" target=\"_blank\">\n                            ffmpegjs\n                        </Link>\n                        , to read your audio files (wav, mp3, ogg, mp4, etc...).\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/dcherednik/atracdenc/\" target=\"_blank\">\n                            Atracdenc\n                        </Link>\n                        , to support atrac3 encoding (lp2, lp4 audio formats).\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://emscripten.org/\" target=\"_blank\">\n                            Emscripten\n                        </Link>\n                        , to run both FFmpeg and Atracdenc in the browser.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/cybercase/netmd-js\" target=\"_blank\">\n                            netmd-js\n                        </Link>\n                        , to send commands to NetMD devices using Javascript.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/glaubitz/linux-minidisc\" target=\"_blank\">\n                            linux-minidisc\n                        </Link>\n                        , to make the netmd-js project possible.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://material-ui.com/\" target=\"_blank\">\n                            material-ui\n                        </Link>\n                        , to build the user interface.\n                    </li>\n                </ul>\n                <DialogContentText>Attribution</DialogContentText>\n                <ul>\n                    <li>\n                        MiniDisc logo from{' '}\n                        <Link rel=\"noopener noreferrer\" href=\"https://en.wikipedia.org/wiki/MiniDisc\" target=\"_blank\">\n                            https://en.wikipedia.org/wiki/MiniDisc\n                        </Link>\n                    </li>\n                    <li>\n                        MiniDisc icon from{' '}\n                        <Link\n                            rel=\"noopener noreferrer\"\n                            href=\"https://www.deviantart.com/blinkybill/art/Sony-MiniDisc-Plastic-Icon-473812540\"\n                            target=\"_blank\"\n                        >\n                            http://fav.me/d7u3g3g\n                        </Link>\n                    </li>\n                </ul>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Close</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { batchActions } from 'redux-batched-actions';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\n\nimport { wipeDisc, listContent } from '../redux/actions';\nimport { actions as appActions } from '../redux/app-feature';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { useShallowEqualSelector } from '../utils';\nimport Link from '@material-ui/core/Link';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport RefreshIcon from '@material-ui/icons/Refresh';\nimport EditIcon from '@material-ui/icons/Edit';\nimport GitHubIcon from '@material-ui/icons/GitHub';\nimport DeleteForeverIcon from '@material-ui/icons/DeleteForever';\nimport ExitToAppIcon from '@material-ui/icons/ExitToApp';\nimport InfoIcon from '@material-ui/icons/Info';\nimport ToggleOffIcon from '@material-ui/icons/ToggleOff';\nimport ToggleOnIcon from '@material-ui/icons/ToggleOn';\n\nconst useStyles = makeStyles(theme => ({\n    listItemIcon: {\n        minWidth: theme.spacing(5),\n    },\n}));\n\nexport const TopMenu = function() {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n\n    let { mainView, darkMode } = useShallowEqualSelector(state => state.appState);\n    let discTitle = useShallowEqualSelector(state => state.main.disc?.title ?? ``);\n\n    const githubLinkRef = React.useRef<null | HTMLAnchorElement>(null);\n    const [menuAnchorEl, setMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const menuOpen = Boolean(menuAnchorEl);\n\n    const handleMenuOpen = useCallback(\n        (event: React.MouseEvent<HTMLElement>) => {\n            setMenuAnchorEl(event.currentTarget);\n        },\n        [setMenuAnchorEl]\n    );\n\n    const handleDarkMode = useCallback(() => {\n        dispatch(appActions.setDarkMode(!darkMode));\n    }, [dispatch, darkMode]);\n\n    const handleMenuClose = useCallback(() => {\n        setMenuAnchorEl(null);\n    }, [setMenuAnchorEl]);\n\n    const handleWipeDisc = useCallback(() => {\n        dispatch(wipeDisc());\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleRefresh = useCallback(() => {\n        dispatch(listContent());\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleRenameDisc = useCallback(() => {\n        dispatch(\n            batchActions([\n                renameDialogActions.setVisible(true),\n                renameDialogActions.setCurrentName(discTitle),\n                renameDialogActions.setIndex(-1),\n            ])\n        );\n        handleMenuClose();\n    }, [dispatch, handleMenuClose, discTitle]);\n\n    const handleExit = useCallback(() => {\n        dispatch(appActions.setState('WELCOME'));\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleShowAbout = useCallback(() => {\n        dispatch(appActions.showAboutDialog(true));\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleGithubLink = useCallback(\n        (event: React.MouseEvent<HTMLElement>) => {\n            event.stopPropagation();\n            if (event.target !== githubLinkRef.current) {\n                // Prevent opening the link twice\n                githubLinkRef.current?.click();\n            }\n            handleMenuClose();\n        },\n        [handleMenuClose]\n    );\n\n    const menuItems = [];\n    if (mainView === 'MAIN') {\n        menuItems.push(\n            <MenuItem key=\"update\" onClick={handleRefresh}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <RefreshIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Reload TOC</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"title\" onClick={handleRenameDisc}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <EditIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Rename Disc</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"wipe\" onClick={handleWipeDisc}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <DeleteForeverIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Wipe Disc</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"exit\" onClick={handleExit}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <ExitToAppIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Exit</ListItemText>\n            </MenuItem>\n        );\n    }\n    menuItems.push(\n        <MenuItem key=\"darkMode\" onClick={handleDarkMode}>\n            <ListItemIcon className={classes.listItemIcon}>\n                {/* <Switch name=\"darkModeSwitch\" inputProps={{ 'aria-label': 'Dark Mode switch' }} size=\"small\" /> */}\n                {darkMode ? <ToggleOnIcon fontSize=\"small\" /> : <ToggleOffIcon fontSize=\"small\" />}\n            </ListItemIcon>\n            <ListItemText>Dark Mode</ListItemText>\n        </MenuItem>\n    );\n    menuItems.push(\n        <MenuItem key=\"about\" onClick={handleShowAbout}>\n            <ListItemIcon className={classes.listItemIcon}>\n                <InfoIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText>About</ListItemText>\n        </MenuItem>\n    );\n    menuItems.push(\n        <MenuItem key=\"github\" onClick={handleGithubLink}>\n            <ListItemIcon className={classes.listItemIcon}>\n                <GitHubIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText>\n                <Link\n                    rel=\"noopener noreferrer\"\n                    href=\"https://github.com/cybercase/webminidisc\"\n                    target=\"_blank\"\n                    ref={githubLinkRef}\n                    onClick={handleGithubLink}\n                >\n                    Fork me on GitHub\n                </Link>\n            </ListItemText>\n        </MenuItem>\n    );\n\n    return (\n        <React.Fragment>\n            <IconButton aria-label=\"actions\" aria-controls=\"actions-menu\" aria-haspopup=\"true\" onClick={handleMenuOpen}>\n                <MoreVertIcon />\n            </IconButton>\n            <Menu id=\"actions-menu\" anchorEl={menuAnchorEl} keepMounted open={menuOpen} onClose={handleMenuClose}>\n                {menuItems}\n            </Menu>\n        </React.Fragment>\n    );\n};\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { pair } from '../redux/actions';\n\nimport { useShallowEqualSelector } from '../utils';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport Box from '@material-ui/core/Box';\nimport Link from '@material-ui/core/Link';\n\nimport { AboutDialog } from './about-dialog';\nimport { TopMenu } from './topmenu';\nimport ChromeIconPath from '../images/chrome-icon.svg';\n\nconst useStyles = makeStyles(theme => ({\n    main: {\n        position: 'relative',\n        flex: '1 1 auto',\n        display: 'flex',\n        justifyContent: 'center',\n        flexDirection: 'column',\n        alignItems: 'center',\n    },\n    button: {\n        marginTop: theme.spacing(3),\n        minWidth: 150,\n    },\n    spacing: {\n        marginTop: theme.spacing(1),\n    },\n    chromeLogo: {\n        marginTop: theme.spacing(1),\n        width: 96,\n        height: 96,\n    },\n    why: {\n        alignSelf: 'flex-start',\n        marginTop: theme.spacing(3),\n    },\n    headBox: {\n        display: 'flex',\n        justifyContent: 'space-between',\n    },\n}));\n\nexport const Welcome = (props: {}) => {\n    const classes = useStyles();\n\n    const dispatch = useDispatch();\n    const { browserSupported, pairingFailed, pairingMessage } = useShallowEqualSelector(state => state.appState);\n    if (pairingMessage.toLowerCase().match(/denied/)) {\n        // show linux instructions\n    }\n    // Access denied.\n\n    const [showWhyUnsupported, setWhyUnsupported] = useState(false);\n    const handleLearnWhy = (event: React.SyntheticEvent) => {\n        event.preventDefault();\n        setWhyUnsupported(true);\n    };\n\n    return (\n        <React.Fragment>\n            <Box className={classes.headBox}>\n                <Typography component=\"h1\" variant=\"h4\">\n                    Web MiniDisc\n                </Typography>\n                <TopMenu />\n            </Box>\n            <Typography component=\"h2\" variant=\"body2\">\n                Brings NetMD Devices to the Web\n            </Typography>\n            <Box className={classes.main}>\n                {browserSupported ? (\n                    <React.Fragment>\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            Press the button to connect to a NetMD device\n                        </Typography>\n\n                        <Button variant=\"contained\" color=\"primary\" onClick={() => dispatch(pair())} className={classes.button}>\n                            Connect\n                        </Button>\n\n                        <FormControl error={true} className={classes.spacing} style={{ visibility: pairingFailed ? 'visible' : 'hidden' }}>\n                            <FormHelperText>{pairingMessage}</FormHelperText>\n                        </FormControl>\n                    </React.Fragment>\n                ) : (\n                    <React.Fragment>\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            This Web browser is not supported.&nbsp;\n                            <Link rel=\"noopener noreferrer\" href=\"#\" onClick={handleLearnWhy}>\n                                Learn Why\n                            </Link>\n                        </Typography>\n\n                        <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://www.google.com/chrome/\">\n                            <img alt=\"Chrome Logo\" src={ChromeIconPath} className={classes.chromeLogo} />\n                        </Link>\n\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            Try using{' '}\n                            <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://www.google.com/chrome/\">\n                                Chrome\n                            </Link>{' '}\n                            instead\n                        </Typography>\n\n                        {showWhyUnsupported ? (\n                            <>\n                                <Typography component=\"p\" variant=\"body2\" className={classes.why}>\n                                    Web MiniDisc requires a browser that supports both{' '}\n                                    <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://wicg.github.io/webusb/\">\n                                        WebUSB\n                                    </Link>{' '}\n                                    and{' '}\n                                    <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://webassembly.org/\">\n                                        WebAssembly\n                                    </Link>\n                                    .\n                                </Typography>\n                                <ul>\n                                    <li>WebUSB is needed to control the NetMD device via the USB connection to your computer.</li>\n                                    <li>WebAssembly is used to convert the music to a MiniDisc compatible format</li>\n                                </ul>\n                            </>\n                        ) : null}\n                    </React.Fragment>\n                )}\n            </Box>\n            <AboutDialog />\n        </React.Fragment>\n    );\n};\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { renameTrack, renameDisc } from '../redux/actions';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport TextField from '@material-ui/core/TextField';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const RenameDialog = (props: {}) => {\n    let dispatch = useDispatch();\n\n    let renameDialogVisible = useShallowEqualSelector(state => state.renameDialog.visible);\n    let renameDialogTitle = useShallowEqualSelector(state => state.renameDialog.title);\n    let renameDialogIndex = useShallowEqualSelector(state => state.renameDialog.index);\n\n    const what = renameDialogIndex < 0 ? `Disc` : `Track`;\n\n    const handleCancelRename = () => {\n        dispatch(renameDialogActions.setVisible(false));\n    };\n\n    const handleDoRename = () => {\n        if (renameDialogIndex < 0) {\n            dispatch(renameDisc({ newName: renameDialogTitle }));\n        } else {\n            dispatch(renameTrack({ index: renameDialogIndex, newName: renameDialogTitle }));\n        }\n    };\n\n    return (\n        <Dialog\n            open={renameDialogVisible}\n            onClose={handleCancelRename}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"rename-dialog-title\"\n        >\n            <DialogTitle id=\"rename-dialog-title\">Rename {what}</DialogTitle>\n            <DialogContent>\n                <TextField\n                    autoFocus\n                    id=\"name\"\n                    label={`${what} Name`}\n                    type=\"text\"\n                    fullWidth\n                    value={renameDialogTitle}\n                    onKeyDown={event => {\n                        event.key === `Enter` && handleDoRename();\n                    }}\n                    onChange={event => {\n                        dispatch(renameDialogActions.setCurrentName(event.target.value.substring(0, 120))); // MAX title length\n                    }}\n                />\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleCancelRename}>Cancel</Button>\n                <Button color={'primary'} onClick={handleDoRename}>\n                    Rename\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as uploadDialogActions } from '../redux/upload-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport Box from '@material-ui/core/Box';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { TransitionProps } from '@material-ui/core/transitions';\nimport { Button } from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n    progressPerc: {\n        marginTop: theme.spacing(1),\n    },\n    progressBar: {\n        marginTop: theme.spacing(3),\n    },\n    uploadLabel: {\n        marginTop: theme.spacing(3),\n    },\n}));\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const UploadDialog = (props: {}) => {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n\n    let {\n        visible,\n        cancelled,\n        writtenProgress,\n        encryptedProgress,\n        totalProgress,\n\n        trackTotal,\n        trackCurrent,\n        trackConverting,\n        titleCurrent,\n        titleConverting,\n    } = useShallowEqualSelector(state => state.uploadDialog);\n\n    const handleCancelUpload = useCallback(() => {\n        dispatch(uploadDialogActions.setCancelUpload(true));\n    }, [dispatch]);\n\n    let progressValue = Math.floor((writtenProgress / totalProgress) * 100);\n    let bufferValue = Math.floor((encryptedProgress / totalProgress) * 100);\n    let convertedValue = Math.floor((trackConverting / trackTotal) * 100);\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"alert-dialog-slide-title\"\n            aria-describedby=\"alert-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Recording...</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"alert-dialog-slide-description\">\n                    {convertedValue === 100 && trackConverting === trackTotal\n                        ? `Conversion completed`\n                        : `Converting ${trackConverting + 1} of ${trackTotal}: ${titleConverting}`}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant={convertedValue === 0 ? 'indeterminate' : 'determinate'}\n                    color=\"primary\"\n                    value={convertedValue}\n                />\n                <Box className={classes.progressPerc}>{convertedValue}%</Box>\n\n                <DialogContentText id=\"alert-dialog-slide-description\" className={classes.uploadLabel}>\n                    Uploading {trackCurrent} of {trackTotal}: {titleCurrent}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant=\"buffer\"\n                    color=\"secondary\"\n                    value={progressValue}\n                    valueBuffer={bufferValue}\n                />\n                <Box className={classes.progressPerc}>{progressValue}%</Box>\n            </DialogContent>\n            <DialogActions>\n                <Button disabled={cancelled} onClick={handleCancelUpload}>\n                    {cancelled ? `Stopping after current track...` : `Cancel Recording`}\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React from 'react';\nimport { useShallowEqualSelector } from '../utils';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport Box from '@material-ui/core/Box';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst useStyles = makeStyles(theme => ({\n    progressPerc: {\n        marginTop: theme.spacing(1),\n    },\n    progressBar: {\n        marginTop: theme.spacing(3),\n    },\n}));\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const RecordDialog = (props: {}) => {\n    const classes = useStyles();\n\n    let { visible, trackTotal, trackDone, trackCurrent, titleCurrent } = useShallowEqualSelector(state => state.recordDialog);\n\n    let progressValue = Math.round(trackCurrent);\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"record-dialog-slide-title\"\n            aria-describedby=\"record-dialog-slide-description\"\n        >\n            <DialogTitle id=\"record-dialog-slide-title\">Recording...</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"record-dialog-slide-description\">\n                    {`Recording track ${trackDone + 1} of ${trackTotal}: ${titleCurrent}`}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant={trackCurrent >= 0 ? 'determinate' : 'indeterminate'}\n                    color=\"primary\"\n                    value={progressValue}\n                />\n                <Box className={classes.progressPerc}>{progressValue >= 0 ? `${progressValue}%` : ``}</Box>\n            </DialogContent>\n            <DialogActions></DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as errorDialogActions } from '../redux/error-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const ErrorDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let { visible, error } = useShallowEqualSelector(state => state.errorDialog);\n\n    const handleClose = useCallback(() => {\n        dispatch(errorDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"error-dialog-slide-title\"\n            aria-describedby=\"error-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Error</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"alert-dialog-slide-description\">{error}</DialogContentText>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Close</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\nimport { actions as panicDialogActions } from '../redux/panic-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\nimport { Typography } from '@material-ui/core';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const PanicDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let { visible, dismissed } = useShallowEqualSelector(state => state.panicDialog);\n\n    const handleReloadApp = useCallback(() => {\n        window.location.reload();\n    }, []);\n\n    const handleIgnore = useCallback(() => {\n        dispatch(panicDialogActions.dismiss());\n    }, [dispatch]);\n\n    return (\n        <Dialog\n            open={visible && !dismissed}\n            maxWidth={'sm'}\n            fullWidth={true}\n            scroll={'paper'}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"error-dialog-slide-title\"\n            aria-describedby=\"error-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Oops… Something unexpected happened.</DialogTitle>\n            <DialogContent>\n                <Typography color=\"textSecondary\" variant=\"body1\" component=\"div\">\n                    Try to restart the app. If the error persists, try the followings:\n                    <ol>\n                        <li>Use your browser in incognito mode.</li>\n                        <li>Use a blank MiniDisc.</li>\n                        <li>Try to use Web MiniDisc on another computer.</li>\n                    </ol>\n                    If this does not solve the error, your unit might not be supported yet or you have encountered a bug. The full error is\n                    reported in the JS console.\n                </Typography>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleIgnore} size=\"small\">\n                    Ignore and Continue\n                </Button>\n                <Button onClick={handleReloadApp} color=\"primary\">\n                    Restart the App\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { belowDesktop, useShallowEqualSelector } from '../utils';\n\nimport { actions as convertDialogActions } from '../redux/convert-dialog-feature';\nimport { convertAndUpload } from '../redux/actions';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport FormControl from '@material-ui/core/FormControl';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport { TransitionProps } from '@material-ui/core/transitions';\nimport { Typography } from '@material-ui/core';\nimport Select from '@material-ui/core/Select';\nimport Input from '@material-ui/core/Input';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Accordion from '@material-ui/core/Accordion';\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport AddIcon from '@material-ui/icons/Add';\nimport RemoveIcon from '@material-ui/icons/Remove';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport IconButton from '@material-ui/core/IconButton';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport { lighten } from '@material-ui/core/styles';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport Radio from '@material-ui/core/Radio';\nimport { useDropzone } from 'react-dropzone';\nimport Backdrop from '@material-ui/core/Backdrop';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nconst useStyles = makeStyles(theme => ({\n    container: {\n        display: 'flex',\n        flexDirection: 'row',\n    },\n    formControl: {\n        minWidth: 60,\n    },\n    toggleButton: {\n        minWidth: 40,\n    },\n    dialogContent: {\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'stretch',\n    },\n    formatAndTitle: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        justifyContent: 'space-between',\n    },\n    rightBlock: {\n        display: 'flex',\n        flexDirection: 'column',\n    },\n    titleFormControl: {\n        minWidth: 170,\n        marginTop: 4,\n        [belowDesktop(theme)]: {\n            width: 114,\n            minWidth: 0,\n        },\n    },\n    spacer: {\n        display: 'flex',\n        flex: '1 1 auto',\n    },\n    showTracksOrderBtn: {\n        marginLeft: theme.spacing(1),\n    },\n    tracksOrderAccordion: {\n        '&:before': {\n            opacity: 0,\n        },\n    },\n    tracksOrderAccordionDetail: {\n        maxHeight: '40vh',\n        overflow: 'auto',\n    },\n    toolbarHighlight:\n        theme.palette.type === 'light'\n            ? {\n                  color: theme.palette.secondary.main,\n                  backgroundColor: lighten(theme.palette.secondary.light, 0.85),\n              }\n            : {\n                  color: theme.palette.text.primary,\n                  backgroundColor: theme.palette.secondary.dark,\n              },\n    trackList: {\n        flex: '1 1 auto',\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n}));\n\nexport const ConvertDialog = (props: { files: File[] }) => {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n\n    let { visible, format, titleFormat } = useShallowEqualSelector(state => state.convertDialog);\n\n    // Track reodering\n    const [files, setFiles] = useState(props.files);\n    const [selectedTrackIndex, setSelectedTrack] = useState(-1);\n\n    const moveFile = useCallback(\n        (offset: number) => {\n            const targetIndex = selectedTrackIndex + offset;\n            if (targetIndex >= files.length || targetIndex < 0) {\n                return; // This should not be allowed by the UI\n            }\n\n            const newFileArray = files.slice();\n\n            // Swap trakcs\n            let tmp = newFileArray[selectedTrackIndex];\n            newFileArray[selectedTrackIndex] = newFileArray[targetIndex];\n            newFileArray[targetIndex] = tmp;\n\n            setFiles(newFileArray);\n            setSelectedTrack(targetIndex);\n        },\n        [files, selectedTrackIndex]\n    );\n\n    const moveFileUp = useCallback(() => {\n        moveFile(-1);\n    }, [moveFile]);\n\n    const moveFileDown = useCallback(() => {\n        moveFile(1);\n    }, [moveFile]);\n\n    const handleClose = useCallback(() => {\n        dispatch(convertDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    const handleChangeFormat = useCallback(\n        (ev, newFormat) => {\n            if (newFormat === null) {\n                return;\n            }\n            dispatch(convertDialogActions.setFormat(newFormat));\n        },\n        [dispatch]\n    );\n\n    const handleChangeTitleFormat = useCallback(\n        (event: React.ChangeEvent<{ value: any }>) => {\n            dispatch(convertDialogActions.setTitleFormat(event.target.value));\n        },\n        [dispatch]\n    );\n\n    const handleConvert = useCallback(() => {\n        handleClose();\n        dispatch(convertAndUpload(files, format, titleFormat));\n    }, [dispatch, files, format, titleFormat, handleClose]);\n\n    const [tracksOrderVisible, setTracksOrderVisible] = useState(false);\n    const handleToggleTracksOrder = useCallback(() => {\n        setTracksOrderVisible(!tracksOrderVisible);\n    }, [tracksOrderVisible, setTracksOrderVisible]);\n\n    // Dialog init on new files\n    useEffect(() => {\n        const newFiles = Array.from(props.files);\n        setFiles(newFiles);\n        setSelectedTrack(-1);\n        setTracksOrderVisible(false);\n    }, [props.files, setSelectedTrack, setTracksOrderVisible]);\n\n    // scroll selected track into view\n    const selectedTrackRef = useRef<HTMLDivElement | null>(null);\n    useEffect(() => {\n        selectedTrackRef.current?.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\n    }, [selectedTrackRef, selectedTrackIndex]);\n\n    const renderTracks = useCallback(() => {\n        return files.map((file, i) => {\n            const isSelected = selectedTrackIndex === i;\n            const ref = isSelected ? selectedTrackRef : null;\n            return (\n                <ListItem key={`${i}`} disableGutters={true} onClick={() => setSelectedTrack(i)} ref={ref} button>\n                    <ListItemIcon>\n                        <Radio checked={isSelected} value={`track-${i}`} size=\"small\" />\n                    </ListItemIcon>\n                    <ListItemText primary={file.name} />\n                </ListItem>\n            );\n        });\n    }, [files, selectedTrackIndex, setSelectedTrack, selectedTrackRef]);\n\n    // Add/Remove tracks\n    const onDrop = useCallback(\n        (acceptedFiles: File[], rejectedFiles: File[]) => {\n            const newFileArray = files.slice().concat(acceptedFiles);\n            setFiles(newFileArray);\n        },\n        [files, setFiles]\n    );\n    const { getRootProps, getInputProps, isDragActive, open } = useDropzone({\n        onDrop,\n        accept: [`audio/*`, `video/mp4`],\n        noClick: true,\n    });\n    const disableRemove = selectedTrackIndex < 0 || selectedTrackIndex >= files.length;\n    const handleRemoveSelectedTrack = useCallback(() => {\n        const newFileArray = files.filter((f, i) => i !== selectedTrackIndex);\n        setFiles(newFileArray);\n        if (selectedTrackIndex >= newFileArray.length) {\n            setSelectedTrack(newFileArray.length - 1);\n        }\n    }, [selectedTrackIndex, files, setFiles]);\n\n    const dialogVisible = useShallowEqualSelector(state => state.convertDialog.visible);\n    useEffect(() => {\n        if (dialogVisible && files.length === 0) {\n            handleClose();\n        }\n    }, [files, dialogVisible]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'xs'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"convert-dialog-slide-title\"\n            aria-describedby=\"convert-dialog-slide-description\"\n        >\n            <DialogTitle id=\"convert-dialog-slide-title\">Upload Settings</DialogTitle>\n            <DialogContent className={classes.dialogContent}>\n                <div className={classes.formatAndTitle}>\n                    <FormControl>\n                        <Typography component=\"label\" variant=\"caption\" color=\"textSecondary\">\n                            Recording Mode\n                        </Typography>\n                        <ToggleButtonGroup value={format} exclusive onChange={handleChangeFormat} size=\"small\">\n                            <ToggleButton className={classes.toggleButton} value=\"SP\">\n                                SP\n                            </ToggleButton>\n                            <ToggleButton className={classes.toggleButton} value=\"LP2\">\n                                LP2\n                            </ToggleButton>\n                            <ToggleButton className={classes.toggleButton} value=\"LP4\">\n                                LP4\n                            </ToggleButton>\n                        </ToggleButtonGroup>\n                    </FormControl>\n                    <div className={classes.rightBlock}>\n                        <FormControl className={classes.formControl}>\n                            <Typography component=\"label\" variant=\"caption\" color=\"textSecondary\">\n                                Track title\n                            </Typography>\n                            <FormControl className={classes.titleFormControl}>\n                                <Select value={titleFormat} color=\"secondary\" input={<Input />} onChange={handleChangeTitleFormat}>\n                                    <MenuItem value={`filename`}>Filename</MenuItem>\n                                    <MenuItem value={`title`}>Title</MenuItem>\n                                    <MenuItem value={`album-title`}>Album - Title</MenuItem>\n                                    <MenuItem value={`artist-title`}>Artist - Title</MenuItem>\n                                    <MenuItem value={`artist-album-title`}>Artist - Album - Title</MenuItem>\n                                </Select>\n                            </FormControl>\n                        </FormControl>\n                    </div>\n                </div>\n                <Accordion expanded={tracksOrderVisible} className={classes.tracksOrderAccordion} square={true}>\n                    <div></div>\n                    <div {...getRootProps()} style={{ outline: 'none' }}>\n                        <Toolbar variant=\"dense\" className={classes.toolbarHighlight}>\n                            <IconButton edge=\"start\" aria-label=\"add track\" onClick={open}>\n                                <AddIcon />\n                            </IconButton>\n                            <IconButton edge=\"start\" aria-label=\"remove track\" onClick={handleRemoveSelectedTrack} disabled={disableRemove}>\n                                <RemoveIcon />\n                            </IconButton>\n                            <div className={classes.spacer}></div>\n                            <IconButton edge=\"end\" aria-label=\"move up\" onClick={moveFileDown}>\n                                <ExpandMoreIcon />\n                            </IconButton>\n                            <IconButton edge=\"end\" aria-label=\"move down\" onClick={moveFileUp}>\n                                <ExpandLessIcon />\n                            </IconButton>\n                        </Toolbar>\n                        <AccordionDetails className={classes.tracksOrderAccordionDetail}>\n                            <List dense={true} disablePadding={false} className={classes.trackList}>\n                                {renderTracks()}\n                            </List>\n                        </AccordionDetails>\n                        <Backdrop className={classes.backdrop} open={isDragActive}>\n                            Drop your Music to add it to the queue\n                        </Backdrop>\n                        <input {...getInputProps()} />\n                    </div>\n                </Accordion>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleToggleTracksOrder} className={classes.showTracksOrderBtn}>\n                    {`${tracksOrderVisible ? 'Hide' : 'Show'} Tracks`}\n                </Button>\n                <div className={classes.spacer}></div>\n                <Button onClick={handleClose}>Cancel</Button>\n                <Button onClick={handleConvert}>Ok</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z\"\n}));\n\nconst SvgMd0 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd0, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md0.a7574f83.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z\"\n}));\n\nconst SvgMd1 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd1, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md1.1ffb5f6c.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45z\"\n}));\n\nconst SvgMd2 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd2, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md2.33dd03b3.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362z\"\n}));\n\nconst SvgMd3 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd3, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md3.80f42826.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\nimport StopIcon from '@material-ui/icons/Stop';\nimport SkipNextIcon from '@material-ui/icons/SkipNext';\nimport SkipPreviousIcon from '@material-ui/icons/SkipPrevious';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Box from '@material-ui/core/Box';\n\nimport { makeStyles } from '@material-ui/core';\nimport { belowDesktop, getSortedTracks, useShallowEqualSelector } from '../utils';\nimport { control } from '../redux/actions';\nimport { useDispatch } from 'react-redux';\n\nimport { ReactComponent as MDIcon0 } from '../images/md0.svg';\nimport { ReactComponent as MDIcon1 } from '../images/md1.svg';\nimport { ReactComponent as MDIcon2 } from '../images/md2.svg';\nimport { ReactComponent as MDIcon3 } from '../images/md3.svg';\n\nconst frames = [MDIcon0, MDIcon1, MDIcon2, MDIcon3];\n\nconst useStyles = makeStyles(theme => ({\n    '@keyframes scrollLeft': {\n        from: {\n            transform: `translateX(0%)`,\n        },\n        to: {},\n    },\n    container: {\n        display: 'flex',\n        flex: '1 1 auto',\n        [belowDesktop(theme)]: {\n            flexWrap: 'wrap',\n        },\n    },\n    lcd: {\n        flex: '1 1 auto',\n        position: 'relative',\n        marginLeft: theme.spacing(1.5),\n        marginRight: theme.spacing(1.5),\n        paddingLeft: theme.spacing(3),\n        paddingRight: theme.spacing(3),\n        borderRadius: theme.spacing(3),\n        backgroundColor: theme.palette.background.default,\n        minWidth: 150,\n        height: 48,\n        [belowDesktop(theme)]: {\n            marginLeft: 0,\n            marginRight: theme.spacing(2),\n        },\n    },\n    lcdText: {\n        overflow: 'hidden',\n        position: 'relative',\n        width: 'calc(100% - 40px)',\n        left: 40,\n        height: '100%',\n        fontFamily: 'LCDDot',\n    },\n    lcdDisc: {\n        position: 'absolute',\n        top: 0,\n        left: 20,\n    },\n    lcdDiscIcon: {\n        width: 28,\n        height: 48,\n        '& g': {\n            fill: theme.palette.action.active,\n        },\n    },\n    scrollingStatusMessage: {\n        position: 'absolute',\n        width: '100%',\n        whiteSpace: 'nowrap',\n        animationName: '$scrollLeft',\n        animationTimingFunction: 'linear',\n        animationIterationCount: '1',\n        top: 15,\n        left: 1,\n    },\n    statusMessage: {\n        position: 'absolute',\n        width: '100%',\n        whiteSpace: 'nowrap',\n        top: 15,\n        left: 1,\n    },\n    button: {\n        // padding: 8,\n    },\n}));\n\nexport const Controls = () => {\n    const dispatch = useDispatch();\n    // TODO: The shallow equality won't work for these 2 states\n    const deviceStatus = useShallowEqualSelector(state => state.main.deviceStatus);\n    const disc = useShallowEqualSelector(state => state.main.disc);\n\n    const classes = useStyles();\n    const handlePrev = useCallback(() => {\n        dispatch(control('prev'));\n    }, [dispatch]);\n    const handlePlay = useCallback(() => {\n        dispatch(control('play'));\n    }, [dispatch]);\n    const handleStop = useCallback(() => {\n        dispatch(control('stop'));\n    }, [dispatch]);\n    const handleNext = useCallback(() => {\n        dispatch(control('next'));\n    }, [dispatch]);\n\n    let message = ``;\n    let trackIndex = deviceStatus?.track ?? null;\n    let deviceState = deviceStatus?.state ?? null;\n    let discPresent = deviceStatus?.discPresent ?? false;\n    const tracks = getSortedTracks(disc);\n    if (!discPresent) {\n        message = ``;\n    } else if (deviceState === 'readingTOC') {\n        message = 'READING TOC';\n    } else if (tracks.length === 0) {\n        message = `BLANKDISC`;\n    } else if (deviceStatus && deviceStatus.track !== null) {\n        message = `${deviceStatus.track + 1} - ` + tracks[deviceStatus.track].title;\n    }\n\n    const [lcdScroll, setLcdScroll] = useState(0);\n    const [lcdScrollDuration, setLcdScrollDuration] = useState(0);\n    const [lcdIconFrame, setLcdIconFrame] = useState(0);\n\n    // LCD Text scrolling\n    const animationDelayInMS = 2000;\n    const scrollTimerRef = useRef<any>(null);\n    const lcdRef = useRef<HTMLParagraphElement>(null);\n    useEffect(() => {\n        const updateLCDScroll = () => {\n            const domEl = lcdRef.current;\n            const textWidth = domEl?.scrollWidth ?? 0;\n            const lcdWidth = domEl?.parentElement?.offsetWidth ?? 0;\n            const scrollPerc = textWidth > lcdWidth ? (textWidth * 100) / lcdWidth : 0;\n            const scrollDurationInSec = textWidth > lcdWidth ? textWidth / 20 : 0; // Compute duration to achieve constant speed\n            setLcdScroll(scrollPerc);\n            setLcdScrollDuration(scrollDurationInSec);\n            if (scrollDurationInSec > 0) {\n                scrollTimerRef.current = setTimeout(() => {\n                    setLcdScroll(0);\n                }, scrollDurationInSec * 1000 + 500); // stop animation timer\n            }\n        };\n\n        clearTimeout(scrollTimerRef.current);\n        setLcdScroll(0);\n        scrollTimerRef.current = setTimeout(() => {\n            updateLCDScroll();\n        }, animationDelayInMS); // start animation timer\n\n        return () => {\n            clearTimeout(scrollTimerRef.current); // clear all the timers on unmount\n        };\n    }, [trackIndex, deviceState, message]);\n\n    // Disc animation\n    const lcdIconAnimationTimer = useRef<any>(null);\n    useEffect(() => {\n        clearInterval(lcdIconAnimationTimer.current);\n        if (deviceState === 'playing' || deviceState === 'readingTOC') {\n            lcdIconAnimationTimer.current = setInterval(() => {\n                setLcdIconFrame(1 + (lcdIconFrame % (frames.length - 1)));\n            }, 600);\n        } else {\n            setLcdIconFrame(0);\n        }\n        return () => {\n            clearInterval(lcdIconAnimationTimer.current);\n        };\n    }, [deviceState, lcdIconFrame]);\n\n    const DiscFrame = frames[lcdIconFrame];\n    return (\n        <Box className={classes.container}>\n            <IconButton aria-label=\"prev\" onClick={handlePrev} className={classes.button}>\n                <SkipPreviousIcon />\n            </IconButton>\n            <IconButton aria-label=\"play\" onClick={handlePlay} className={classes.button}>\n                <PlayArrowIcon />\n            </IconButton>\n            <IconButton aria-label=\"stop\" onClick={handleStop} className={classes.button}>\n                <StopIcon />\n            </IconButton>\n            <IconButton aria-label=\"next\" onClick={handleNext} className={classes.button}>\n                <SkipNextIcon />\n            </IconButton>\n            <div className={classes.lcd}>\n                <div className={classes.lcdText}>\n                    <span\n                        className={lcdScroll ? classes.scrollingStatusMessage : classes.statusMessage}\n                        ref={lcdRef}\n                        style={\n                            message && lcdScroll > 0\n                                ? { animationDuration: `${lcdScrollDuration}s`, transform: `translate(-${lcdScroll}%)` }\n                                : {}\n                        }\n                    >\n                        {message}\n                    </span>\n                </div>\n                <div className={classes.lcdDisc}>{discPresent && <DiscFrame className={classes.lcdDiscIcon} />}</div>\n            </div>\n        </Box>\n    );\n};\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { recordTracks } from '../redux/actions';\nimport { actions as dumpDialogActions } from '../redux/dump-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport { Controls } from './controls';\nimport Box from '@material-ui/core/Box';\nimport serviceRegistry from '../services/registry';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nconst useStyles = makeStyles(theme => ({\n    container: {\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'flex-end',\n        justifyContent: 'space-between',\n        marginRight: -theme.spacing(2),\n        flexFlow: 'wrap',\n    },\n    formControl: {\n        minWidth: 120,\n    },\n    selectEmpty: {\n        marginTop: theme.spacing(2),\n    },\n    head: {\n        textShadow: '0px 0px 12px rgba(150, 150, 150, 1)',\n        fontSize: theme.typography.h2.fontSize,\n        textAlign: 'center',\n        marginBottom: theme.spacing(2),\n    },\n}));\n\nexport const DumpDialog = ({ trackIndexes }: { trackIndexes: number[] }) => {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n\n    const [devices, setDevices] = useState<{ deviceId: string; label: string }[]>([]);\n    const [inputDeviceId, setInputDeviceId] = useState<string>('');\n\n    let { visible } = useShallowEqualSelector(state => state.dumpDialog);\n\n    const handleClose = useCallback(() => {\n        setInputDeviceId('');\n        serviceRegistry.mediaRecorderService?.stopTestInput();\n        dispatch(dumpDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    const handleChange = useCallback(\n        (ev: React.ChangeEvent<{ value: unknown }>) => {\n            const deviceId = ev.target.value as string;\n            setInputDeviceId(deviceId);\n            serviceRegistry.mediaRecorderService?.stopTestInput();\n            serviceRegistry.mediaRecorderService?.playTestInput(deviceId);\n        },\n        [setInputDeviceId]\n    );\n\n    const handleStartTransfer = useCallback(() => {\n        dispatch(recordTracks(trackIndexes, inputDeviceId));\n        handleClose();\n    }, [trackIndexes, inputDeviceId, dispatch, handleClose]);\n\n    useEffect(() => {\n        async function updateDeviceList() {\n            await navigator.mediaDevices.getUserMedia({ audio: true });\n            let devices = await navigator.mediaDevices.enumerateDevices();\n            let inputDevices = devices\n                .filter(device => device.kind === 'audioinput')\n                .map(device => ({ deviceId: device.deviceId, label: device.label }));\n            setDevices(inputDevices);\n        }\n        if (visible) {\n            updateDeviceList();\n        }\n    }, [visible, setDevices]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"dump-dialog-slide-title\"\n            aria-describedby=\"dump-dialog-slide-description\"\n        >\n            <DialogTitle id=\"dump-dialog-slide-title\">Record Selected Tracks</DialogTitle>\n            <DialogContent>\n                <Typography component=\"p\" variant=\"h2\" className={classes.head}>\n                    {`💻 ⬅ 💽`}\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    1. Connect your MD Player line-out to your PC audio line-in.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    2. Use the controls at the bottom right to play some tracks.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    3. Select the input source. You should hear the tracks playing on your PC.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    4. Adjust the input gain and the line-out volume of your device.\n                </Typography>\n                <Box className={classes.container}>\n                    <FormControl className={classes.formControl}>\n                        <Select value={inputDeviceId} onChange={handleChange} displayEmpty className={classes.selectEmpty}>\n                            <MenuItem value=\"\" disabled>\n                                Input Source\n                            </MenuItem>\n                            {devices.map(device => (\n                                <MenuItem key={device.deviceId} value={device.deviceId}>\n                                    {device.label}\n                                </MenuItem>\n                            ))}\n                        </Select>\n                        <FormHelperText>Input Source</FormHelperText>\n                    </FormControl>\n                    <Controls />\n                </Box>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Cancel</Button>\n                <Button onClick={handleStartTransfer} disabled={inputDeviceId === ''}>\n                    Start Record\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useEffect, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport clsx from 'clsx';\nimport { useDropzone } from 'react-dropzone';\nimport { listContent, deleteTracks, moveTrack } from '../redux/actions';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { actions as convertDialogActions } from '../redux/convert-dialog-feature';\nimport { actions as dumpDialogActions } from '../redux/dump-dialog-feature';\n\nimport { formatTimeFromFrames, getTracks } from 'netmd-js';\n\nimport { belowDesktop, forAnyDesktop, getSortedTracks, useShallowEqualSelector } from '../utils';\n\nimport { lighten, makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Box from '@material-ui/core/Box';\nimport Fab from '@material-ui/core/Fab';\nimport AddIcon from '@material-ui/icons/Add';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport EditIcon from '@material-ui/icons/Edit';\nimport Backdrop from '@material-ui/core/Backdrop';\n\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { batchActions } from 'redux-batched-actions';\n\nimport { RenameDialog } from './rename-dialog';\nimport { UploadDialog } from './upload-dialog';\nimport { RecordDialog } from './record-dialog';\nimport { ErrorDialog } from './error-dialog';\nimport { PanicDialog } from './panic-dialog';\nimport { ConvertDialog } from './convert-dialog';\nimport { AboutDialog } from './about-dialog';\nimport { DumpDialog } from './dump-dialog';\nimport { TopMenu } from './topmenu';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport * as BadgeImpl from '@material-ui/core/Badge/Badge';\nimport Button from '@material-ui/core/Button';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nconst useStyles = makeStyles(theme => ({\n    add: {\n        position: 'absolute',\n        bottom: theme.spacing(3),\n        right: theme.spacing(3),\n        [belowDesktop(theme)]: {\n            bottom: theme.spacing(2),\n        },\n    },\n    main: {\n        overflowY: 'auto',\n        flex: '1 1 auto',\n        marginBottom: theme.spacing(3),\n        outline: 'none',\n        marginLeft: theme.spacing(-1),\n        marginRight: theme.spacing(-1),\n        [forAnyDesktop(theme)]: {\n            marginLeft: theme.spacing(-2),\n            marginRight: theme.spacing(-2),\n        },\n    },\n    toolbar: {\n        marginTop: theme.spacing(3),\n        marginLeft: theme.spacing(-2),\n        marginRight: theme.spacing(-2),\n        [theme.breakpoints.up(600 + theme.spacing(2) * 2)]: {\n            marginLeft: theme.spacing(-3),\n            marginRight: theme.spacing(-3),\n        },\n    },\n    toolbarLabel: {\n        flex: '1 1 100%',\n    },\n    toolbarHighlight:\n        theme.palette.type === 'light'\n            ? {\n                  color: theme.palette.secondary.main,\n                  backgroundColor: lighten(theme.palette.secondary.light, 0.85),\n              }\n            : {\n                  color: theme.palette.text.primary,\n                  backgroundColor: theme.palette.secondary.dark,\n              },\n    headBox: {\n        display: 'flex',\n        justifyContent: 'space-between',\n    },\n    spacing: {\n        marginTop: theme.spacing(1),\n    },\n    formatBadge: {\n        ...(BadgeImpl as any).styles(theme).badge,\n        ...(BadgeImpl as any).styles(theme).colorPrimary,\n        position: 'static',\n        display: 'inline-flex',\n        border: `2px solid ${theme.palette.background.paper}`,\n        padding: '0 4px',\n        verticalAlign: 'middle',\n        width: theme.spacing(4.5),\n        marginRight: theme.spacing(0.5),\n    },\n    titleCell: {\n        overflow: 'hidden',\n        maxWidth: '40ch',\n        textOverflow: 'ellipsis',\n        // whiteSpace: 'nowrap',\n    },\n    durationCell: {\n        whiteSpace: 'nowrap',\n    },\n    durationCellTime: {\n        verticalAlign: 'middle',\n    },\n    indexCell: {\n        whiteSpace: 'nowrap',\n        paddingRight: 0,\n        width: `2ch`,\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n    remainingTimeTooltip: {\n        textDecoration: 'underline',\n        textDecorationStyle: 'dotted',\n    },\n}));\n\nexport const Main = (props: {}) => {\n    let dispatch = useDispatch();\n    let disc = useShallowEqualSelector(state => state.main.disc);\n    let deviceName = useShallowEqualSelector(state => state.main.deviceName);\n\n    const [selected, setSelected] = React.useState<number[]>([]);\n    const selectedCount = selected.length;\n\n    const [moveMenuAnchorEl, setMoveMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const handleShowMoveMenu = useCallback((event: React.MouseEvent<HTMLButtonElement>) => {\n        setMoveMenuAnchorEl(event.currentTarget);\n    }, []);\n    const handleCloseMoveMenu = useCallback(() => {\n        setMoveMenuAnchorEl(null);\n    }, []);\n    const handleMoveSelectedTrack = useCallback(\n        (destIndex: number) => {\n            dispatch(moveTrack(selected[0], destIndex));\n            handleCloseMoveMenu();\n        },\n        [dispatch, selected, handleCloseMoveMenu]\n    );\n\n    const handleShowDumpDialog = useCallback(() => {\n        dispatch(dumpDialogActions.setVisible(true));\n    }, [dispatch]);\n\n    useEffect(() => {\n        dispatch(listContent());\n    }, [dispatch]);\n\n    useEffect(() => {\n        setSelected([]); // Reset selection if disc changes\n    }, [disc]);\n\n    let [uploadedFiles, setUploadedFiles] = React.useState<File[]>([]);\n    const onDrop = useCallback(\n        (acceptedFiles: File[], rejectedFiles: File[]) => {\n            setUploadedFiles(acceptedFiles);\n            dispatch(convertDialogActions.setVisible(true));\n        },\n        [dispatch]\n    );\n    const { getRootProps, getInputProps, isDragActive, open } = useDropzone({\n        onDrop,\n        accept: [`audio/*`, `video/mp4`],\n        noClick: true,\n    });\n\n    const classes = useStyles();\n    const tracks = getSortedTracks(disc);\n\n    // Action Handlers\n    const handleSelectClick = (event: React.MouseEvent, item: number) => {\n        if (selected.includes(item)) {\n            setSelected(selected.filter(i => i !== item));\n        } else {\n            setSelected([...selected, item]);\n        }\n    };\n\n    const handleSelectAllClick = (event: React.ChangeEvent<HTMLInputElement>) => {\n        if (selected.length < tracks.length) {\n            setSelected(tracks.map(t => t.index));\n        } else {\n            setSelected([]);\n        }\n    };\n\n    const handleRenameDoubleClick = (event: React.MouseEvent, item: number) => {\n        let selectedIndex = item;\n        let currentName = getTracks(disc!).find(track => track.index === selectedIndex)?.title ?? '';\n\n        dispatch(\n            batchActions([\n                renameDialogActions.setVisible(true),\n                renameDialogActions.setCurrentName(currentName),\n                renameDialogActions.setIndex(selectedIndex),\n            ])\n        );\n    };\n\n    const handleRenameActionClick = (event: React.MouseEvent) => {\n        handleRenameDoubleClick(event, selected[0]);\n    };\n\n    const handleDeleteSelected = (event: React.MouseEvent) => {\n        dispatch(deleteTracks(selected));\n    };\n\n    return (\n        <React.Fragment>\n            <Box className={classes.headBox}>\n                <Typography component=\"h1\" variant=\"h4\">\n                    {deviceName || `Loading...`}\n                </Typography>\n                <TopMenu />\n            </Box>\n            <Typography component=\"h2\" variant=\"body2\">\n                {disc !== null ? (\n                    <React.Fragment>\n                        <span>{`${formatTimeFromFrames(disc.left, false)} left of ${formatTimeFromFrames(disc.total, false)} `}</span>\n                        <Tooltip\n                            title={\n                                <React.Fragment>\n                                    <span>{`${formatTimeFromFrames(disc.left * 2, false)} left in LP2 Mode`}</span>\n                                    <br />\n                                    <span>{`${formatTimeFromFrames(disc.left * 4, false)} left in LP4 Mode`}</span>\n                                </React.Fragment>\n                            }\n                            arrow\n                        >\n                            <span className={classes.remainingTimeTooltip}>SP Mode</span>\n                        </Tooltip>\n                    </React.Fragment>\n                ) : (\n                    `Loading...`\n                )}\n            </Typography>\n            <Toolbar\n                className={clsx(classes.toolbar, {\n                    [classes.toolbarHighlight]: selectedCount > 0,\n                })}\n            >\n                {selectedCount > 0 ? (\n                    <Checkbox\n                        indeterminate={selectedCount > 0 && selectedCount < tracks.length}\n                        checked={selectedCount > 0}\n                        onChange={handleSelectAllClick}\n                        inputProps={{ 'aria-label': 'select all tracks' }}\n                    />\n                ) : null}\n                {selectedCount > 0 ? (\n                    <Typography className={classes.toolbarLabel} color=\"inherit\" variant=\"subtitle1\">\n                        {selectedCount} selected\n                    </Typography>\n                ) : (\n                    <Typography component=\"h3\" variant=\"h6\" className={classes.toolbarLabel}>\n                        {disc?.title || `Untitled Disc`}\n                    </Typography>\n                )}\n                {selectedCount === 1 ? (\n                    <React.Fragment>\n                        <Tooltip title=\"Move to Position\">\n                            <Button aria-controls=\"move-menu\" aria-label=\"Move\" onClick={handleShowMoveMenu}>\n                                Move\n                            </Button>\n                        </Tooltip>\n                        <Menu\n                            id=\"move-menu\"\n                            anchorEl={moveMenuAnchorEl}\n                            open={!!moveMenuAnchorEl}\n                            onClose={handleCloseMoveMenu}\n                            PaperProps={{\n                                style: {\n                                    maxHeight: 300,\n                                },\n                            }}\n                        >\n                            {Array(tracks.length)\n                                .fill(null)\n                                .map((_, i) => {\n                                    return (\n                                        <MenuItem key={`pos-${i}`} onClick={() => handleMoveSelectedTrack(i)}>\n                                            {i + 1}\n                                        </MenuItem>\n                                    );\n                                })}\n                        </Menu>\n                    </React.Fragment>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <React.Fragment>\n                        <Tooltip title=\"Record from MD\">\n                            <Button aria-label=\"Record\" onClick={handleShowDumpDialog}>\n                                Record\n                            </Button>\n                        </Tooltip>\n                    </React.Fragment>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <Tooltip title=\"Delete\">\n                        <IconButton aria-label=\"delete\" onClick={handleDeleteSelected}>\n                            <DeleteIcon />\n                        </IconButton>\n                    </Tooltip>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <Tooltip title=\"Rename\">\n                        <IconButton aria-label=\"rename\" disabled={selectedCount !== 1} onClick={handleRenameActionClick}>\n                            <EditIcon />\n                        </IconButton>\n                    </Tooltip>\n                ) : null}\n            </Toolbar>\n            <Box className={classes.main} {...getRootProps()}>\n                <input {...getInputProps()} />\n                <Table size=\"small\">\n                    <TableHead>\n                        <TableRow>\n                            <TableCell className={classes.indexCell}>#</TableCell>\n                            <TableCell>Title</TableCell>\n                            <TableCell align=\"right\">Duration</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {tracks.map(track => (\n                            <TableRow\n                                hover\n                                selected={selected.includes(track.index)}\n                                key={track.index}\n                                onDoubleClick={event => handleRenameDoubleClick(event, track.index)}\n                                onClick={event => handleSelectClick(event, track.index)}\n                            >\n                                <TableCell className={classes.indexCell}>{track.index + 1}</TableCell>\n                                <TableCell className={classes.titleCell} title={track.title}>\n                                    {track.title || `No Title`}\n                                </TableCell>\n                                <TableCell align=\"right\" className={classes.durationCell}>\n                                    <span className={classes.formatBadge}>{track.encoding}</span>\n                                    <span className={classes.durationCellTime}>{track.duration}</span>\n                                </TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n                <Backdrop className={classes.backdrop} open={isDragActive}>\n                    Drop your Music to Upload\n                </Backdrop>\n            </Box>\n            <Fab color=\"primary\" aria-label=\"add\" className={classes.add} onClick={open}>\n                <AddIcon />\n            </Fab>\n\n            <UploadDialog />\n            <RenameDialog />\n            <ErrorDialog />\n            <ConvertDialog files={uploadedFiles} />\n            <RecordDialog />\n            <DumpDialog trackIndexes={selected} />\n            <AboutDialog />\n            <PanicDialog />\n        </React.Fragment>\n    );\n};\n","import React from 'react';\nimport { belowDesktop, forAnyDesktop, forWideDesktop, useShallowEqualSelector } from '../utils';\n\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makeStyles, createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\n\nimport { Welcome } from './welcome';\nimport { Main } from './main';\nimport { Controls } from './controls';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Link from '@material-ui/core/Link';\nimport Box from '@material-ui/core/Box';\nimport { useDispatch } from 'react-redux';\n\nconst useStyles = makeStyles(theme => ({\n    layout: {\n        width: 'auto',\n        height: '100%',\n        [forAnyDesktop(theme)]: {\n            width: 600,\n            marginLeft: 'auto',\n            marginRight: 'auto',\n        },\n        [forWideDesktop(theme)]: {\n            width: 700,\n        },\n    },\n\n    paper: {\n        position: 'relative',\n        display: 'flex',\n        flexDirection: 'column',\n        padding: theme.spacing(2),\n        height: 'calc(100% - 20px)',\n        [forAnyDesktop(theme)]: {\n            marginTop: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            padding: theme.spacing(3),\n            height: 600,\n        },\n        [forWideDesktop(theme)]: {\n            height: 700,\n        },\n    },\n    bottomBar: {\n        display: 'flex',\n        alignItems: 'center',\n        [belowDesktop(theme)]: {\n            flexWrap: 'wrap',\n        },\n        marginLeft: -theme.spacing(2),\n    },\n    copyrightTypography: {\n        marginRight: theme.spacing(1),\n        textAlign: 'center',\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n    minidiscLogo: {\n        width: 48,\n    },\n    controlsContainer: {\n        flex: '0 0 auto',\n        width: '100%',\n        paddingRight: theme.spacing(8),\n        [belowDesktop(theme)]: {\n            paddingLeft: 0,\n        },\n    },\n}));\n\nconst darkTheme = createMuiTheme({\n    palette: {\n        type: 'dark',\n        primary: {\n            light: '#6ec6ff',\n            main: '#2196f3',\n            dark: '#0069c0',\n            contrastText: '#fff',\n        },\n    },\n});\n\nconst lightTheme = createMuiTheme({\n    palette: {\n        type: 'light',\n    },\n});\n\nconst App = () => {\n    const classes = useStyles();\n\n    const dispatch = useDispatch();\n    let { mainView, loading, darkMode } = useShallowEqualSelector(state => state.appState);\n\n    return (\n        <React.Fragment>\n            <ThemeProvider theme={darkMode ? darkTheme : lightTheme}>\n                <CssBaseline />\n\n                <main className={classes.layout}>\n                    <Paper className={classes.paper}>\n                        {mainView === 'WELCOME' ? <Welcome /> : null}\n                        {mainView === 'MAIN' ? <Main /> : null}\n\n                        <Box className={classes.controlsContainer}>{mainView === 'MAIN' ? <Controls /> : null}</Box>\n                    </Paper>\n                    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.copyrightTypography}>\n                        {'© '}\n                        <Link rel=\"noopener noreferrer\" color=\"inherit\" target=\"_blank\" href=\"https://stefano.brilli.me/\">\n                            Stefano Brilli\n                        </Link>{' '}\n                        {new Date().getFullYear()}\n                        {'.'}\n                    </Typography>\n                </main>\n\n                <Backdrop className={classes.backdrop} open={loading}>\n                    <CircularProgress color=\"inherit\" />\n                </Backdrop>\n            </ThemeProvider>\n        </React.Fragment>\n    );\n};\n\nexport default App;\n","/* eslint no-restricted-globals: 0 */\nimport { getPublicPathFor } from '../utils';\nexport class AtracdencProcess {\n    private messageCallback?: (ev: MessageEvent) => void;\n\n    constructor(public worker: Worker) {\n        worker.onmessage = this.handleMessage.bind(this);\n    }\n\n    async init() {\n        await new Promise<MessageEvent>(resolve => {\n            this.messageCallback = resolve;\n            this.worker.postMessage({ action: 'init' });\n        });\n    }\n\n    async encode(data: ArrayBuffer, bitrate: string) {\n        let eventData = await new Promise<MessageEvent>(resolve => {\n            this.messageCallback = resolve;\n            this.worker.postMessage({ action: 'encode', bitrate, data }, [data]);\n        });\n        return eventData.data.result as Uint8Array;\n    }\n\n    terminate() {\n        this.worker.terminate();\n    }\n\n    handleMessage(ev: MessageEvent) {\n        this.messageCallback!(ev);\n        this.messageCallback = undefined;\n    }\n}\n\nif (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope) {\n    // Worker\n    let Module: any;\n    onmessage = async (ev: MessageEvent) => {\n        const { action, ...others } = ev.data;\n        if (action === 'init') {\n            self.importScripts(getPublicPathFor(`atracdenc.js`));\n            (self as any).Module().then((m: any) => {\n                Module = m;\n                self.postMessage({ action: 'init' });\n                Module.setLogger && Module.setLogger((msg: string, stream: string) => console.log(`${stream}: ${msg}`));\n            });\n        } else if (action === 'encode') {\n            const { bitrate, data } = others;\n            const inWavFile = `inWavFile.wav`;\n            const outAt3File = `outAt3File.aea`;\n            const dataArray = new Uint8Array(data);\n            Module.FS.writeFile(`${inWavFile}`, dataArray);\n            Module.callMain([`-e`, `atrac3`, `-i`, inWavFile, `-o`, outAt3File, `--bitrate`, bitrate]);\n\n            // Read file and trim header (96 bytes)\n            let fileStat = Module.FS.stat(outAt3File);\n            let size = fileStat.size;\n            let tmp = new Uint8Array(size - 96);\n            let outAt3FileStream = Module.FS.open(outAt3File, 'r');\n            Module.FS.read(outAt3FileStream, tmp, 0, tmp.length, 96);\n            Module.FS.close(outAt3FileStream);\n\n            let result = tmp.buffer;\n\n            self.postMessage(\n                {\n                    action: 'encode',\n                    result,\n                },\n                [result]\n            );\n        }\n    };\n} else {\n    // Main\n}\n","import { createWorker, setLogging } from '@ffmpeg/ffmpeg';\nimport { AtracdencProcess } from './atracdenc-worker';\nimport { getPublicPathFor } from '../utils';\nconst AtracdencWorker = require('worker-loader!./atracdenc-worker'); // eslint-disable-line import/no-webpack-loader-syntax\n\ninterface LogPayload {\n    message: string;\n    action: string;\n}\n\nexport interface AudioExportService {\n    init(): Promise<void>;\n    export(params: { format: string }): Promise<ArrayBuffer>;\n    info(): Promise<{ format: string | null; input: string | null }>;\n    prepare(file: File): Promise<void>;\n}\n\nexport class FFMpegAudioExportService implements AudioExportService {\n    public ffmpegProcess: any;\n    public atracdencProcess?: AtracdencProcess;\n    public loglines: { action: string; message: string }[] = [];\n    public inFileName: string = ``;\n    public outFileNameNoExt: string = ``;\n\n    async init() {\n        setLogging(true);\n    }\n\n    async prepare(file: File) {\n        this.loglines = [];\n        this.ffmpegProcess = createWorker({\n            logger: (payload: LogPayload) => {\n                this.loglines.push(payload);\n                console.log(payload.action, payload.message);\n            },\n            corePath: getPublicPathFor('ffmpeg-core.js'),\n            workerPath: getPublicPathFor('worker.min.js'),\n        });\n        await this.ffmpegProcess.load();\n\n        this.atracdencProcess = new AtracdencProcess(new AtracdencWorker());\n        await this.atracdencProcess.init();\n\n        let ext = file.name.split('.').slice(-1);\n        if (ext.length === 0) {\n            throw new Error(`Unrecognized file format: ${file.name}`);\n        }\n\n        this.inFileName = `inAudioFile.${ext[0]}`;\n        this.outFileNameNoExt = `outAudioFile`;\n\n        await this.ffmpegProcess.write(this.inFileName, file);\n    }\n\n    async info() {\n        await this.ffmpegProcess.transcode(this.inFileName, `${this.outFileNameNoExt}.metadata`, `-f ffmetadata`);\n\n        let audioFormatRegex = /Audio:\\s(.*?),/; // Actual content\n        let inputFormatRegex = /Input #0,\\s(.*?),/; // Container\n        let format: string | null = null;\n        let input: string | null = null;\n\n        for (let line of this.loglines) {\n            let match = line.message.match(audioFormatRegex);\n            if (match !== null) {\n                format = match[1];\n                continue;\n            }\n            match = line.message.match(inputFormatRegex);\n            if (match !== null) {\n                input = match[1];\n                continue;\n            }\n            if (format !== null && input !== null) {\n                break;\n            }\n        }\n\n        return { format, input };\n    }\n\n    async export({ format }: { format: string }) {\n        let result: ArrayBuffer;\n        if (format === `SP`) {\n            const outFileName = `${this.outFileNameNoExt}.raw`;\n            await this.ffmpegProcess.transcode(this.inFileName, outFileName, '-f s16be -ar 44100');\n            let { data } = await this.ffmpegProcess.read(outFileName);\n            result = data.buffer;\n        } else {\n            const outFileName = `${this.outFileNameNoExt}.wav`;\n            await this.ffmpegProcess.transcode(this.inFileName, outFileName, '-f wav -ar 44100');\n            let { data } = await this.ffmpegProcess.read(outFileName);\n            let bitrate: string = `0`;\n            switch (format) {\n                case `LP2`:\n                    bitrate = `128`;\n                    break;\n                case `LP105`:\n                    bitrate = `102`;\n                    break;\n                case `LP4`:\n                    bitrate = `64`;\n                    break;\n            }\n            result = await this.atracdencProcess!.encode(data.buffer, bitrate);\n        }\n        this.ffmpegProcess.worker.terminate();\n        this.atracdencProcess!.terminate();\n        return result;\n    }\n}\n","/* eslint no-restricted-globals: 0 */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\nimport { NetMDUSBService } from './services/netmd';\nimport { NetMDMockService } from './services/netmd-mock';\nimport serviceRegistry from './services/registry';\n\nimport { store } from './redux/store';\nimport { actions as appActions } from './redux/app-feature';\nimport { actions as mainActions } from './redux/main-feature';\n\nimport App from './components/app';\n\nimport './index.css';\nimport './fonts/fonts.css';\n\nimport { FFMpegAudioExportService } from './services/audio-export';\nimport { MediaRecorderService } from './services/mediarecorder';\n\nserviceRegistry.netmdService = new NetMDUSBService({ debug: true });\n// serviceRegistry.netmdService = new NetMDMockService(); // Uncomment to work without a device attached\nserviceRegistry.audioExportService = new FFMpegAudioExportService();\nserviceRegistry.mediaRecorderService = new MediaRecorderService();\n\n(function setupEventHandlers() {\n    window.addEventListener('beforeunload', ev => {\n        let isUploading = store.getState().uploadDialog.visible;\n        if (!isUploading) {\n            return;\n        }\n        ev.preventDefault();\n        ev.returnValue = `Warning! Recording will be interrupted`;\n    });\n\n    if (navigator && navigator.usb) {\n        navigator.usb.ondisconnect = function() {\n            store.dispatch(appActions.setState('WELCOME'));\n        };\n    } else {\n        store.dispatch(appActions.setBrowserSupported(false));\n    }\n\n    // eslint-disable-next-line\n    let deferredPrompt: any;\n    window.addEventListener('beforeinstallprompt', (e: any) => {\n        e.preventDefault();\n        deferredPrompt = e;\n    });\n})();\n\n(function statusMonitorManager() {\n    // Polls the device for its state while playing tracks\n    let statusMonitorInterval: ReturnType<typeof setInterval> | null = null;\n    let exceptionOccurred: boolean = false;\n\n    function shouldMonitorBeRunning(state: ReturnType<typeof store.getState>): boolean {\n        return (\n            !exceptionOccurred &&\n            // App ready\n            state.appState.mainView === 'MAIN' &&\n            state.appState.loading === false &&\n            // Disc playing\n            state.main.deviceStatus?.state === 'playing' &&\n            // No operational dialogs running\n            state.convertDialog.visible === false &&\n            state.uploadDialog.visible === false &&\n            state.recordDialog.visible === false &&\n            state.panicDialog.visible === false &&\n            state.errorDialog.visible === false &&\n            state.dumpDialog.visible === false\n        );\n    }\n\n    store.subscribe(function() {\n        const state = store.getState();\n        if (shouldMonitorBeRunning(state) === true && statusMonitorInterval === null) {\n            // start monitor\n            statusMonitorInterval = setInterval(async () => {\n                try {\n                    const deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n                    store.dispatch(mainActions.setDeviceStatus(deviceStatus));\n                } catch (e) {\n                    console.error(e);\n                    exceptionOccurred = true; // Stop monitor on exception\n                }\n            }, 5000);\n        } else if (shouldMonitorBeRunning(state) === false && statusMonitorInterval !== null) {\n            // stop monitor\n            clearInterval(statusMonitorInterval);\n            statusMonitorInterval = null;\n        }\n    });\n})();\n\nReactDOM.render(\n    <Provider store={store}>\n        <App />\n    </Provider>,\n    document.getElementById('root')\n);\n\n// serviceWorker.unregister();\nserviceWorker.register();\n","import { sanitizeTitle, getPublicPathFor } from '../utils';\nimport Recorder from 'recorderjs';\n\nexport class MediaRecorderService {\n    public recorder: any;\n    public stream?: MediaStream;\n    public audioContext?: AudioContext;\n    public analyserNode?: AnalyserNode;\n    public gainNode?: GainNode;\n\n    playTestInput(deviceId: string) {\n        this.audioContext = new AudioContext();\n        this.gainNode = this.audioContext.createGain();\n        this.analyserNode = this.audioContext.createAnalyser();\n\n        this.initStream(deviceId).then(() => {\n            const source = this.audioContext!.createMediaStreamSource(this.stream!);\n            source.connect(this.gainNode!);\n            this.gainNode!.connect(this.analyserNode!);\n            this.analyserNode!.connect(this.audioContext!.destination);\n        });\n    }\n\n    stopTestInput() {\n        if (!this.audioContext) {\n            return;\n        }\n        this.audioContext?.close();\n        delete this.audioContext;\n        this.closeStream();\n    }\n\n    async initStream(deviceId: string) {\n        const recordConstraints = {\n            // Try to set the best recording params for ripping the audio tracks\n            autoGainControl: false,\n            channelCount: 2,\n            deviceId: deviceId,\n            echoCancellation: false,\n            noiseSuppression: false,\n            sampleRate: 44100,\n            highpassFilter: false,\n        };\n        this.stream = await navigator.mediaDevices.getUserMedia({ audio: recordConstraints });\n\n        // Dump recording settings\n        const audioTracks = this.stream.getAudioTracks();\n        if (audioTracks.length > 0) {\n            console.log('Record Setings:', audioTracks[0].getSettings());\n        }\n    }\n\n    async startRecording() {\n        this.audioContext = new AudioContext();\n        const input = this.audioContext.createMediaStreamSource(this.stream!);\n        this.recorder = new Recorder(input, { workerPath: getPublicPathFor(`recorderWorker.js`) });\n        this.recorder.record();\n    }\n\n    async stopRecording() {\n        this.recorder.stop();\n    }\n\n    async closeStream() {\n        this.stream?.getTracks().forEach(track => track.stop());\n    }\n\n    downloadRecorded(title: string) {\n        this.recorder.exportWAV((buffer: Blob) => {\n            let url = URL.createObjectURL(buffer);\n            let a = document.createElement('a');\n            document.body.appendChild(a);\n            a.style.display = 'none';\n            a.href = url;\n            a.download = `${sanitizeTitle(title)}.wav`;\n            a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(a);\n        });\n    }\n}\n"],"sourceRoot":""}