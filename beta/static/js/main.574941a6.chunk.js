(this.webpackJsonpwebmd=this.webpackJsonpwebmd||[]).push([[0],{175:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function c(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(276),o=n(75);t.DevicesIds=[{vendorId:1245,deviceId:29186,name:"Sharp IM-MT899H"},{vendorId:1245,deviceId:36883,name:"Sharp IM-DR400"},{vendorId:1245,deviceId:36884,name:"Sharp IM-DR80"},{vendorId:1356,deviceId:52,name:"Sony PCLK-XX"},{vendorId:1356,deviceId:54,name:"Sony"},{vendorId:1356,deviceId:117,name:"Sony MZ-N1"},{vendorId:1356,deviceId:124,name:"Sony"},{vendorId:1356,deviceId:128,name:"Sony LAM-1"},{vendorId:1356,deviceId:129,name:"Sony MDS-JB980"},{vendorId:1356,deviceId:132,name:"Sony MZ-N505"},{vendorId:1356,deviceId:133,name:"Sony MZ-S1"},{vendorId:1356,deviceId:134,name:"Sony MZ-N707"},{vendorId:1356,deviceId:142,name:"Sony CMT-C7NT"},{vendorId:1356,deviceId:151,name:"Sony PCGA-MDN1"},{vendorId:1356,deviceId:173,name:"Sony CMT-L7HD"},{vendorId:1356,deviceId:198,name:"Sony MZ-N10"},{vendorId:1356,deviceId:199,name:"Sony MZ-N910"},{vendorId:1356,deviceId:200,name:"Sony MZ-N710/NF810"},{vendorId:1356,deviceId:201,name:"Sony MZ-N510/N610"},{vendorId:1356,deviceId:202,name:"Sony MZ-NE410/NF520D"},{vendorId:1356,deviceId:235,name:"Sony MZ-NE810/NE910"},{vendorId:1356,deviceId:257,name:"Sony LAM-10"},{vendorId:1356,deviceId:275,name:"Aiwa AM-NX1"},{vendorId:1356,deviceId:332,name:"Aiwa AM-NX9"},{vendorId:1356,deviceId:382,name:"Sony MZ-NH1"},{vendorId:1356,deviceId:384,name:"Sony MZ-NH3D"},{vendorId:1356,deviceId:386,name:"Sony MZ-NH900"},{vendorId:1356,deviceId:388,name:"Sony MZ-NH700/NH800"},{vendorId:1356,deviceId:390,name:"Sony MZ-NH600/NH600D"},{vendorId:1356,deviceId:392,name:"Sony MZ-N920"},{vendorId:1356,deviceId:394,name:"Sony LAM-3"},{vendorId:1356,deviceId:489,name:"Sony MZ-DH10P"},{vendorId:1356,deviceId:537,name:"Sony MZ-RH10"},{vendorId:1356,deviceId:539,name:"Sony MZ-RH710/MZ-RH910"},{vendorId:1356,deviceId:541,name:"Sony CMT-AH10"},{vendorId:1356,deviceId:556,name:"Sony CMT-AH10"},{vendorId:1356,deviceId:572,name:"Sony DS-HMD1"},{vendorId:1356,deviceId:646,name:"Sony MZ-RH1"}];var c=function(){function e(e,t,n){var r;void 0===t&&(t=0),this.device=e,this.iface=t,this.logger=n,this.logger=null===(r=n)||void 0===r?void 0:r.child({class:"NetMD"})}return e.prototype.init=function(){var e,t;return r(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null===(e=this.logger)||void 0===e||e.debug("Init"),this.device.opened?[3,2]:(null===(t=this.logger)||void 0===t||t.debug("Opening device"),[4,this.device.open()]);case 1:n.sent(),n.label=2;case 2:return[4,this.device.selectConfiguration(1)];case 3:return n.sent(),[4,this.device.claimInterface(this.iface)];case 4:return n.sent(),[4,this.getReplyLength()];case 5:return n.sent()>0?[4,this.readReply()]:[3,7];case 6:n.sent(),n.label=7;case 7:return[2]}}))}))},e.prototype.getDeviceName=function(){var e,n,r=this.device,a=r.vendorId,i=r.productId;return null!==(n=null===(e=t.DevicesIds.find((function(e){return e.deviceId===i&&e.vendorId===a})))||void 0===e?void 0:e.name)&&void 0!==n?n:"Unknown Device"},e.prototype.finalize=function(){var e,t;return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:null===(e=this.logger)||void 0===e||e.debug("Finalize"),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,this.device.reset()];case 2:return r.sent(),[4,this.device.releaseInterface(this.iface)];case 3:return r.sent(),[4,this.device.close()];case 4:return r.sent(),[3,6];case 5:return n=r.sent(),null===(t=this.logger)||void 0===t||t.error({err:n}),[3,6];case 6:return[2]}}))}))},e.prototype.getReplyLength=function(){var e,t,n;return r(this,void 0,void 0,(function(){var r,o;return a(this,(function(a){switch(a.label){case 0:return[4,this.device.controlTransferIn({requestType:"vendor",recipient:"interface",request:1,value:0,index:0},4)];case 1:return r=a.sent(),t=null===(e=r.data)||void 0===e?void 0:e.getUint8(2),o=null!==t&&void 0!==t?t:0,null===(n=this.logger)||void 0===n||n.debug({action:"getReplyLength",result:i.inspect(r),len:o}),[2,o]}}))}))},e.prototype.sendCommand=function(e){var t;return r(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return null===(t=this.logger)||void 0===t||t.debug({action:"sendCommand",command:i.inspect(e)}),[4,this.device.controlTransferOut({requestType:"vendor",recipient:"interface",request:128,value:0,index:0},e)];case 1:return n.sent(),[2]}}))}))},e.prototype.readReply=function(){var t;return r(this,void 0,void 0,(function(){var n,r,c;return a(this,(function(a){switch(a.label){case 0:return[4,this.getReplyLength()];case 1:n=a.sent(),r=0,a.label=2;case 2:return 0!==n?[3,5]:[4,o.sleep(e.readReplyRetryIntervalInMsec*Math.pow(2,~~(r/10)))];case 3:return a.sent(),[4,this.getReplyLength()];case 4:return n=a.sent(),r++,[3,2];case 5:return[4,this.device.controlTransferIn({requestType:"vendor",recipient:"interface",request:129,value:0,index:0},n)];case 6:return c=a.sent(),null===(t=this.logger)||void 0===t||t.debug({action:"readReply",result:i.inspect(c)}),[2,c]}}))}))},e.prototype.readBulk=function(e){return r(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,this.readBulkToArray(e)];case 1:return t=n.sent(),[2,new Uint8Array(t)]}}))}))},e.prototype.readBulkToArray=function(e,t){return void 0===t&&(t=65536),r(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(a){switch(a.label){case 0:t=0,n=new ArrayBuffer(0),a.label=1;case 1:return t<e?[4,this.device.transferIn(this.iface,Math.min(e-t,e))]:[3,3];case 2:if(!(r=a.sent()).data)throw new Error("expected data");return t+=r.data.byteLength,n=o.concatArrayBuffers(n,r.data.buffer),[3,1];case 3:return[2,n]}}))}))},e.prototype.writeBulk=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.device.transferOut(2,e)];case 1:return[2,t.sent()]}}))}))},e.readReplyRetryIntervalInMsec=10,e}();t.NetMD=c},177:function(e,t,n){"use strict";var r,a,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function c(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}l((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},l=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof p?p(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},u=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||c(e,t)}))})}function c(e,t){try{(n=a[e](t)).value instanceof s?Promise.resolve(n.value.v).then(l,u):d(i[0][2],n)}catch(r){d(i[0][3],r)}var n}function l(e){c("next",e)}function u(e){c("throw",e)}function d(e,t){e(t),i.shift(),i.length&&c(i[0][0],i[0][1])}},d=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},f=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e},p=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var m,y,v,g,b,w=n(288),E=n(75),k=h(n(178)),S=h(n(179));!function(e){e[e.control=0]="control",e[e.status=1]="status",e[e.specificInquiry=2]="specificInquiry",e[e.notify=3]="notify",e[e.generalInquiry=4]="generalInquiry",e[e.notImplemented=8]="notImplemented",e[e.accepted=9]="accepted",e[e.rejected=10]="rejected",e[e.inTransition=11]="inTransition",e[e.implemented=12]="implemented",e[e.changed=13]="changed",e[e.interim=15]="interim"}(m||(m={})),function(e){e[e.play=117]="play",e[e.pause=125]="pause",e[e.fastForward=57]="fastForward",e[e.rewind=73]="rewind"}(y||(y={})),function(e){e[e.previous=2]="previous",e[e.next=32769]="next",e[e.restart=1]="restart"}(v||(v={})),function(e){e[e.lp4=0]="lp4",e[e.lp2=2]="lp2",e[e.spMono=4]="spMono",e[e.spStereo=6]="spStereo"}(g=t.DiscFormat||(t.DiscFormat={})),function(e){e[e.pcm=0]="pcm",e[e.l105kbps=144]="l105kbps",e[e.lp2=148]="lp2",e[e.lp4=168]="lp4"}(b=t.Wireformat||(t.Wireformat={})),function(e){e[e.sp=144]="sp",e[e.lp2=146]="lp2",e[e.lp4=147]="lp4"}(t.Encoding||(t.Encoding={})),function(e){e[e.mono=1]="mono",e[e.stereo=0]="stereo"}(t.Channels||(t.Channels={})),function(e){e[e.mono=1]="mono",e[e.stereo=2]="stereo"}(t.ChannelCount||(t.ChannelCount={})),function(e){e[e.protected=3]="protected",e[e.unprotected=0]="unprotected"}(t.TrackFlag||(t.TrackFlag={})),function(e){e[e.writable=16]="writable",e[e.writeProtected=64]="writeProtected"}(t.DiscFlag||(t.DiscFlag={})),t.FrameSize=((r={})[b.pcm]=2048,r[b.lp2]=192,r[b.l105kbps]=152,r[b.lp4]=96,r);var C=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(Error),I=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(C),x=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t}(C),T=function(){function e(e,t){var n;this.netMd=e,this.logger=t,this.logger=null===(n=t)||void 0===n?void 0:n.child({class:"NetMDInterface"})}return e.prototype.sendQuery=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,this.sendCommand(e,t)];case 1:return n.sent(),[2,this.readReply()]}}))}))},e.prototype.sendCommand=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var n;return c(this,(function(r){return n=t?new Uint8Array([m.specificInquiry]).buffer:new Uint8Array([m.control]).buffer,this.netMd.sendCommand(E.concatArrayBuffers(n,e)),[2]}))}))},e.prototype.sendHandshake=function(e){return o(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return t=w.formatQuery(e),[4,this.sendQuery(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.readReply=function(){return o(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<e.maxInterimReadAttempts?[4,this.netMd.readReply()]:[3,9];case 2:if(void 0===(n=a.sent().data))throw new Error("unexpected undefined value in readReply");if((r=n.getUint8(0))!==m.notImplemented)return[3,3];throw new I("Not implemented");case 3:if(r!==m.rejected)return[3,4];throw new x("Rejected");case 4:if(!([m.accepted,m.implemented].indexOf(r)<-1))return[3,5];throw new I("Unknown return status: "+r);case 5:return r!==m.interim?[3,7]:[4,E.sleep(e.interimResponseRetryIntervalInMs*(Math.pow(2,t)-1))];case 6:return a.sent(),t+=1,[3,1];case 7:return[3,9];case 8:return[3,1];case 9:if(t>=e.maxInterimReadAttempts)throw new x("Max attempts read attempts for interim status reached");return[2,n.buffer.slice(1)]}}))}))},e.prototype.acquire=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("ff 010c ffff ffff ffff ffff ffff ffff"),[4,this.sendQuery(e)];case 1:return t=n.sent(),w.scanQuery(t,"ff 010c ffff ffff ffff ffff ffff ffff"),[2]}}))}))},e.prototype.release=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("ff 0100 ffff ffff ffff ffff ffff ffff"),[4,this.sendQuery(e)];case 1:return t=n.sent(),w.scanQuery(t,"ff 0100 ffff ffff ffff ffff ffff ffff"),[2]}}))}))},e.prototype.getStatus=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return[4,this.sendHandshake("1808 8000 0100")];case 1:return n.sent(),e=w.formatQuery("1809 8001 0230 8800 0030 8804 00 ff00 00000000"),[4,this.sendQuery(e)];case 2:return t=n.sent(),[2,w.scanQuery(t,"1809 8001 0230 8800 0030 8804 00 1000 00090000 %x")[0]]}}))}))},e.prototype.isDiscPresent=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.getStatus()];case 1:return[2,64===e.sent()[4]]}}))}))},e.prototype.getOperatingStatus=function(){return o(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:return[4,this.sendHandshake("1808 8000 0100")];case 1:return r.sent(),e=w.formatQuery("1809 8001 0330 8802 0030 8805 0030 8806 00 ff00 00000000"),[4,this.sendQuery(e)];case 2:return t=r.sent(),n=w.scanQuery(t,"1809 8001 0330 8802 0030 8805 0030 8806 00 1000 00%?0000 0006 8806 0002 %w")[0],[2,k.default.toNumber(n)]}}))}))},e.prototype._getPlaybackStatus=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return c(this,(function(a){switch(a.label){case 0:return n=w.formatQuery("1809 8001 0330 %w 0030 8805 0030 %w 00 ff00 00000000",e,t),[4,this.sendQuery(n)];case 1:return r=a.sent(),[2,w.scanQuery(r,"1809 8001 0330 %?%? %?%? %?%? %?%? %?%? %? 1000 00%?0000 %x")[0]]}}))}))},e.prototype.getPlaybackStatus1=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this._getPlaybackStatus(34817,34823)]}))}))},e.prototype.getPlaybackStatus2=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this._getPlaybackStatus(34818,34822)]}))}))},e.prototype.getPosition=function(){return o(this,void 0,void 0,(function(){var e,t,n,r;return c(this,(function(a){switch(a.label){case 0:e=w.formatQuery("1809 8001 0430 8802 0030 8805 0030 0003 0030 0002 00 ff00 00000000"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.sendQuery(e)];case 2:return t=a.sent(),[3,4];case 3:if((n=a.sent())instanceof x)return[2,null];throw n;case 4:return(r=w.scanQuery(t,"1809 8001 0430 %?%? %?%? %?%? %?%? %?%? %?%? %?%? %? %?00 00%?0000 000b 0002 0007 00 %w %b %b %b %b"))[0]=k.default.toNumber(r[0]),r[1]=w.BCD2int(k.default.toNumber(r[1])),r[2]=w.BCD2int(k.default.toNumber(r[2])),r[3]=w.BCD2int(k.default.toNumber(r[3])),r[4]=w.BCD2int(k.default.toNumber(r[4])),[2,r]}}))}))},e.prototype._play=function(e){return o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=w.formatQuery("18c3 ff %b 000000",e),[4,this.sendQuery(t)];case 1:return n=r.sent(),w.scanQuery(n,"18c3 00 %b 000000"),[2]}}))}))},e.prototype.play=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._play(y.play)];case 1:return e.sent(),[2]}}))}))},e.prototype.fast_forward=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._play(y.fastForward)];case 1:return e.sent(),[2]}}))}))},e.prototype.rewind=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._play(y.rewind)];case 1:return e.sent(),[2]}}))}))},e.prototype.pause=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._play(y.pause)];case 1:return e.sent(),[2]}}))}))},e.prototype.stop=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("18c5 ff 00000000"),[4,this.sendQuery(e)];case 1:return t=n.sent(),w.scanQuery(t,"18c5 00 00000000"),[2]}}))}))},e.prototype.gotoTrack=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){switch(a.label){case 0:return t=w.formatQuery("1850 ff010000 0000 %w",e),[4,this.sendQuery(t)];case 1:return n=a.sent(),r=w.scanQuery(n,"1850 00010000 0000 %w")[0],[2,k.default.toNumber(r)]}}))}))},e.prototype.gotoTime=function(e,t,n,r,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),o(this,void 0,void 0,(function(){var i,o;return c(this,(function(c){switch(c.label){case 0:return i=w.formatQuery("1850 ff000000 0000 %w %b%b%b%b",e,w.int2BCD(t),w.int2BCD(n),w.int2BCD(r),w.int2BCD(a)),[4,this.sendQuery(i)];case 1:return o=c.sent(),[2,w.scanQuery(o,"1850 00000000 %?%? %w %b%b%b%b").map((function(e){return k.default.toNumber(e)}))]}}))}))},e.prototype._trackChange=function(e){return o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=w.formatQuery("1850 ff10 00000000 %w",e),[4,this.sendQuery(t)];case 1:return n=r.sent(),[2,w.scanQuery(n,"1850 0010 00000000 %?%?")]}}))}))},e.prototype.nextTrack=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._trackChange(v.next)];case 1:return e.sent(),[2]}}))}))},e.prototype.previousTrack=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._trackChange(v.previous)];case 1:return e.sent(),[2]}}))}))},e.prototype.restartTrack=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._trackChange(v.restart)];case 1:return e.sent(),[2]}}))}))},e.prototype.eraseDisc=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1840 ff 0000"),[4,this.sendQuery(e)];case 1:return t=n.sent(),w.scanQuery(t,"1840 00 0000"),[2]}}))}))},e.prototype.syncTOC=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return[4,this.sendHandshake("180810 1801 0000")];case 1:return n.sent(),e=w.formatQuery("1808 10180200 00"),[4,this.sendQuery(e)];case 2:return t=n.sent(),w.scanQuery(t,"1808 10180200 00"),[2]}}))}))},e.prototype.cacheTOC=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1808 10180203 00"),[4,this.sendQuery(e)];case 1:return t=n.sent(),w.scanQuery(t,"1808 10180203 00"),[2]}}))}))},e.prototype.getDiscFlags=function(){return o(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:return e=w.formatQuery("1806 01101000 ff00 0001000b"),[4,this.sendQuery(e)];case 1:return t=r.sent(),n=w.scanQuery(t,"1806 01101000 1000 0001000b %b"),[2,k.default.toNumber(n[0])]}}))}))},e.prototype.getTrackCount=function(){var e;return o(this,void 0,void 0,(function(){var t,n,r,a,i;return c(this,(function(o){switch(o.label){case 0:return[4,this.sendHandshake("180810 1001 0100")];case 1:return o.sent(),t=w.formatQuery("1806 02101001 3000 1000 ff00 00000000"),[4,this.sendQuery(t)];case 2:return n=o.sent(),r=w.scanQuery(n,"1806 02101001 %?%? %?%? 1000 00%?0000 %x"),a=String.fromCharCode.apply(String,f(r[0])),E.assert(6===a.length,"Expected length === 6 for data"),E.assert("\0\x10\0\x02\0"===a.substring(0,5),"Wrong header in data response"),i=a.charCodeAt(5),null===(e=this.logger)||void 0===e||e.debug({method:"getTrackCount",result:i}),[2,i]}}))}))},e.prototype._getDiscTitle=function(e){var t;return void 0===e&&(e=!1),o(this,void 0,void 0,(function(){var n,r,a,i,o,l,s,u,d,f,p,h;return c(this,(function(c){switch(c.label){case 0:n=e?1:0,r=0,a=0,i=1,o=[],c.label=1;case 1:return r<i?(u=w.formatQuery("1806 02201801 00%b 3000 0a00 ff00 %w%w",n,a,r),[4,this.sendQuery(u)]):[3,3];case 2:return d=c.sent(),0===a?(f=w.scanQuery(d,"1806 02201801 00%? 3000 0a00 1000 %w0000 %?%?000a %w %*"),l=k.default.toNumber(f[0]),i=k.default.toNumber(f[1]),s=E.decodeFromSJIS(f[2]),l-=6):(p=w.scanQuery(d,"1806 02201801 00%? 3000 0a00 1000 %w%?%? %*"),l=k.default.toNumber(p[0]),s=E.decodeFromSJIS(p[1])),o.push(s),a=i-(r+=l),[3,1];case 3:return h=o.join(""),null===(t=this.logger)||void 0===t||t.debug({method:"_getDiscTitle",result:h}),[2,h]}}))}))},e.prototype.getDiscTitle=function(e){return void 0===e&&(e=!1),o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return[4,this._getDiscTitle(e)];case 1:return(t=r.sent()).endsWith("//")&&(n=t.split("//")[0],t=n.startsWith("0;")?n.substring(2):""),[2,t]}}))}))},e.prototype.getTrackGroupList=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,i,o,l,s,u,h,m,y,v,g,b,w,k,S,C,I,x,T,D;return c(this,(function(c){switch(c.label){case 0:return[4,this._getDiscTitle()];case 1:return e=c.sent(),t=e.split("//"),n={},[4,this.getTrackCount()];case 2:r=c.sent(),a=[];try{for(i=p(t.entries()),o=i.next();!o.done;o=i.next())if(l=d(o.value,2),s=l[0],""!==(u=l[1])&&!u.startsWith("0;")&&-1!==u.indexOf(";")&&-1!==e.indexOf("//")){for(h=d(u.split(";",1),1),m=h[0],y=u.substring(m.length+1),v=void 0,g=void 0,m.indexOf("-")>=0?(D=d(m.split("-"),2),v=D[0],g=D[1]):v=g=m,b=d([Number.parseInt(v,10),Number.parseInt(g,10)],2),w=b[0],k=b[1],k=Math.min(k,r),E.assert(0<=w),E.assert(w<=k),S=[],C=w-1;C<k;C++){if(C in n)throw new Error("Track "+C+" is in 2 groups: "+n[C][0]);n[C]=[y,s],S.push(C)}a.push([y,S])}}catch(O){x={error:O}}finally{try{o&&!o.done&&(T=i.return)&&T.call(i)}finally{if(x)throw x.error}}return(I=f(Array(r).keys()).filter((function(e){return!(e in n)}))).length>0&&a.unshift([null,I]),[2,a]}}))}))},e.prototype.getTrackTitle=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var n,r,a,i;return c(this,(function(o){switch(o.label){case 0:return n=t?3:2,r=w.formatQuery("1806 022018%b %w 3000 0a00 ff00 00000000",n,e),[4,this.sendQuery(r)];case 1:return a=o.sent(),i=w.scanQuery(a,"1806 022018%? %?%? %?%? %?%? 1000 00%?0000 00%?000a %x"),[2,E.decodeFromSJIS(i[0])]}}))}))},e.prototype.setDiscTitle=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var n,r,a,i,o,l;return c(this,(function(c){switch(c.label){case 0:return a=E.getLengthAfterEncodingToSJIS,[4,this.getDiscTitle()];case 1:return r=a.apply(void 0,[c.sent()]),i=E.getLengthAfterEncodingToSJIS(e),n=t?1:0,[4,this.sendHandshake("180810 1801 0100")];case 2:return c.sent(),[4,this.sendHandshake("180810 1801 0000")];case 3:return c.sent(),[4,this.sendHandshake("180810 1801 0300")];case 4:return c.sent(),o=w.formatQuery("1807 02201801 00%b 3000 0a00 5000 %w 0000 %w %*",n,i,r,E.encodeToSJIS(e)),[4,this.sendQuery(o)];case 5:return l=c.sent(),w.scanQuery(l,"1807 02201801 00%? 3000 0a00 5000 %?%? 0000 %?%?"),[4,this.sendHandshake("180810 1801 0100")];case 6:return c.sent(),[2]}}))}))},e.prototype.setTrackTitle=function(e,t,n){return void 0===n&&(n=!1),o(this,void 0,void 0,(function(){var r,a,i,o,l,s,u;return c(this,(function(c){switch(c.label){case 0:r=n?3:2,i=E.getLengthAfterEncodingToSJIS(t),c.label=1;case 1:return c.trys.push([1,3,,4]),o=E.getLengthAfterEncodingToSJIS,[4,this.getTrackTitle(e)];case 2:return a=o.apply(void 0,[c.sent()]),[3,4];case 3:if(!((l=c.sent())instanceof x))throw l;return a=0,[3,4];case 4:return[4,this.sendHandshake("180810 1802 0100")];case 5:return c.sent(),[4,this.sendHandshake("180810 1802 0000")];case 6:return c.sent(),[4,this.sendHandshake("180810 1802 0300")];case 7:return c.sent(),s=w.formatQuery("1807 022018%b %w 3000 0a00 5000 %w 0000 %w %*",r,e,i,a,E.encodeToSJIS(t)),[4,this.sendQuery(s)];case 8:return u=c.sent(),w.scanQuery(u,"1807 022018%? %?%? 3000 0a00 5000 %?%? 0000 %?%?"),[2]}}))}))},e.prototype.eraseTrack=function(e){return o(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return t=w.formatQuery("1840 ff01 00 201001 %w",e),[4,this.sendQuery(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.moveTrack=function(e,t){return o(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,this.sendHandshake("180810 1001 0000")];case 1:return r.sent(),n=w.formatQuery("1843 ff00 00 201001 %w 201001 %w",e,t),[4,this.sendQuery(n)];case 2:return r.sent(),[2]}}))}))},e.prototype._getTrackInfo=function(e,t,n){return o(this,void 0,void 0,(function(){var r,a,i;return c(this,(function(o){switch(o.label){case 0:return[4,this.sendHandshake("180810 1001 0100")];case 1:return o.sent(),r=w.formatQuery("1806 02201001 %w %w %w ff00 00000000",e,t,n),[4,this.sendQuery(r)];case 2:return a=o.sent(),i=w.scanQuery(a,"1806 02201001 %?%? %?%? %?%? 1000 00%?0000 %x"),[2,String.fromCharCode.apply(String,f(i[0]))]}}))}))},e.prototype.getTrackLength=function(e){return o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return[4,this._getTrackInfo(e,12288,256)];case 1:return t=r.sent(),(n=w.scanQuery(E.stringToCharCodeArray(t),"0001 0006 0000 %b %b %b %b"))[0]=w.BCD2int(k.default.toNumber(n[0])),n[1]=w.BCD2int(k.default.toNumber(n[1])),n[2]=w.BCD2int(k.default.toNumber(n[2])),n[3]=w.BCD2int(k.default.toNumber(n[3])),[2,n]}}))}))},e.prototype.getTrackEncoding=function(e){return o(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this._getTrackInfo(e,12416,1792)];case 1:return t=n.sent(),[2,w.scanQuery(E.stringToCharCodeArray(t),"8007 0004 0110 %b %b").map((function(e){return k.default.toNumber(e)}))]}}))}))},e.prototype.getTrackFlags=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){switch(a.label){case 0:return t=w.formatQuery("1806 01201001 %w ff00 00010008",e),[4,this.sendQuery(t)];case 1:return n=a.sent(),r=w.scanQuery(n,"1806 01201001 %?%? 10 00 00010008 %b")[0],[2,k.default.toNumber(r)]}}))}))},e.prototype.getDiscCapacity=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,i,o;return c(this,(function(c){switch(c.label){case 0:return[4,this.sendHandshake("180810 1000 0100")];case 1:return c.sent(),e=w.formatQuery("1806 02101000 3080 0300 ff00 00000000"),[4,this.sendQuery(e)];case 2:for(t=c.sent(),n=[],r=w.scanQuery(t,"1806 02101000 3080 0300 1000 001d0000 001b 8003 0017 8000 0005 %w %b %b %b 0005 %w %b %b %b 0005 %w %b %b %b"),a=0;a<3;a++)i=4*a,o=[w.BCD2int(k.default.toNumber(r[i+0])),w.BCD2int(k.default.toNumber(r[i+1])),w.BCD2int(k.default.toNumber(r[i+2])),w.BCD2int(k.default.toNumber(r[i+3]))],n.push(o);return[2,n]}}))}))},e.prototype.getRecordingParameters=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1809 8001 0330 8801 0030 8805 0030 8807 00 ff00 00000000"),[4,this.sendQuery(e)];case 1:return t=n.sent(),[2,w.scanQuery(t,"1809 8001 0330 8801 0030 8805 0030 8807 00 1000 000e0000 000c 8805 0008 80e0 0110 %b %b 4000").map((function(e){return k.default.toNumber(e)}))]}}))}))},e.prototype.disableNewTrackProtection=function(e){return o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=w.formatQuery("1800 080046 f0030103 2b ff %w",e),[4,this.sendQuery(t)];case 1:return n=r.sent(),w.scanQuery(n,"1800 080046 f0030103 2b 00 %?%?"),[2]}}))}))},e.prototype.enterSecureSession=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1800 080046 f0030103 80 ff"),[4,this.sendQuery(e)];case 1:return t=n.sent(),[2,w.scanQuery(t,"1800 080046 f0030103 80 00")]}}))}))},e.prototype.leaveSecureSession=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1800 080046 f0030103 81 ff"),[4,this.sendQuery(e)];case 1:return t=n.sent(),[2,w.scanQuery(t,"1800 080046 f0030103 81 00")]}}))}))},e.prototype.getLeafID=function(){return o(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:return e=w.formatQuery("1800 080046 f0030103 11 ff"),[4,this.sendQuery(e)];case 1:return t=r.sent(),n=w.scanQuery(t,"1800 080046 f0030103 11 00 %*"),[2,String.fromCharCode.apply(String,f(n[0]))]}}))}))},e.prototype.sendKeyData=function(e,t,n,r){return o(this,void 0,void 0,(function(){var a,i,o,l,s,u,d,h,m,y;return c(this,(function(c){switch(c.label){case 0:a=t.length,i=16+16*a+24;try{for(o=p(t),l=o.next();!l.done;l=o.next())if(16!==(s=l.value).length)throw new Error("Each key in the chain needs to have 16 bytes; this one has "+s.length)}catch(v){m={error:v}}finally{try{l&&!l.done&&(y=o.return)&&y.call(o)}finally{if(m)throw m.error}}if(n<1||n>63)throw new Error("Supplied depth is invalid");if(24!==r.length)throw new Error("Supplied EKB signature length wrong");return u=E.concatUint8Arrays.apply(void 0,f(t)),d=w.formatQuery("1800 080046 f0030103 12 ff %w %d %d %d %d 00000000 %* %*",i,i,a,n,e,u,r),[4,this.sendQuery(d)];case 1:return h=c.sent(),[2,w.scanQuery(h,"1800 080046 f0030103 12 01 %?%? %?%?%?%?")]}}))}))},e.prototype.sessionKeyExchange=function(e){return o(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:if(8!==e.length)throw new Error("Supplied host nonce length wrong");return t=w.formatQuery("1800 080046 f0030103 20 ff 000000 %*",e),[4,this.sendQuery(t)];case 1:return n=r.sent(),[2,w.scanQuery(n,"1800 080046 f0030103 20 00 000000 %#")[0]]}}))}))},e.prototype.sessionKeyForget=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return e=w.formatQuery("1800 080046 f0030103 21 ff 000000"),[4,this.sendQuery(e)];case 1:return t=n.sent(),[2,w.scanQuery(t,"1800 080046 f0030103 21 00 000000")]}}))}))},e.prototype.setupDownload=function(e,t,n){return o(this,void 0,void 0,(function(){var r,a,i,o;return c(this,(function(c){switch(c.label){case 0:if(20!==e.length)throw new Error("Supplied Content ID length wrong");if(8!==t.length)throw new Error("Supplied Key Encryption Key length wrong");if(16!==n.length)throw new Error("Supplied Session Key length wrong");return r=E.concatUint8Arrays(new Uint8Array([1,1,1,1]),e,t),a=S.default.DES.encrypt(S.default.lib.WordArray.create(r),S.default.enc.Hex.parse(n),{mode:S.default.mode.CBC,padding:S.default.pad.NoPadding,iv:S.default.enc.Hex.parse("0000000000000000")}),i=w.formatQuery("1800 080046 f0030103 22 ff 0000 %*",E.wordArrayToByteArray(a.ciphertext)),[4,this.sendQuery(i)];case 1:return o=c.sent(),[2,w.scanQuery(o,"1800 080046 f0030103 22 00 0000")]}}))}))},e.prototype.commitTrack=function(e,t){return o(this,void 0,void 0,(function(){var n,r,a;return c(this,(function(i){switch(i.label){case 0:if(16!==t.length)throw new Error("Supplied Session Key length wrong");return n=S.default.DES.encrypt(S.default.enc.Hex.parse("0000000000000000"),S.default.enc.Hex.parse(t),{mode:S.default.mode.ECB,padding:S.default.pad.NoPadding}),r=w.formatQuery("1800 080046 f0030103 48 ff 00 1001 %w %*",e,E.wordArrayToByteArray(n.ciphertext)),[4,this.sendQuery(r)];case 1:return a=i.sent(),[2,w.scanQuery(a,"1800 080046 f0030103 48 00 00 1001 %?%?")]}}))}))},e.prototype.sendTrack=function(e,t,n,r,a,i,s){var u,d,f,p;return o(this,void 0,void 0,(function(){var o,h,m,y,v,g,b,C,I,x,T,D,O,M,j;return c(this,(function(c){switch(c.label){case 0:if(16!==i.length)throw new Error("Supplied Session Key length wrong");return o=r+24,h=w.formatQuery("1800 080046 f0030103 28 ff 000100 1001 ffff 00 %b %b %d %d",e,t,n,o),[4,this.sendQuery(h)];case 1:m=c.sent(),w.scanQuery(m,"1800 080046 f0030103 28 00 000100 1001 %?%? 00 %*"),y=!E.isBigEndian(),v=0,g=0,c.label=2;case 2:c.trys.push([2,8,9,14]),u=l(a),c.label=3;case 3:return[4,u.next()];case 4:return(d=c.sent()).done?[3,7]:(b=d.value,C=b.key,I=b.iv,x=b.data,s&&s({totalBytes:o,writtenBytes:g}),T=void 0,0===v?(D=new Uint8Array(new Uint32Array([r]).buffer),y&&D.reverse(),T=E.concatUint8Arrays(new Uint8Array([0,0,0,0]),D,C,I,x)):T=x,[4,this.netMd.writeBulk(T)]);case 5:c.sent(),v+=1,g+=x.length,c.label=6;case 6:return[3,3];case 7:return[3,14];case 8:return O=c.sent(),f={error:O},[3,14];case 9:return c.trys.push([9,,12,13]),d&&!d.done&&(p=u.return)?[4,p.call(u)]:[3,11];case 10:c.sent(),c.label=11;case 11:return[3,13];case 12:if(f)throw f.error;return[7];case 13:return[7];case 14:return s&&s({totalBytes:o,writtenBytes:g}),[4,this.readReply()];case 15:return m=c.sent(),[4,this.netMd.getReplyLength()];case 16:return c.sent(),M=w.scanQuery(m,"1800 080046 f0030103 28 00 000100 1001 %w 00 %?%? %?%?%?%? %?%?%?%? %*"),j=S.default.DES.decrypt(S.default.lib.WordArray.create(M[1]),S.default.enc.Hex.parse(i),{mode:S.default.mode.CBC,iv:S.default.enc.Hex.parse("0000000000000000")}).toString(S.default.enc.Utf8),[2,[k.default.toNumber(M[0]),j.substring(0,8),j.substring(12,32)]]}}))}))},e.prototype.getTrackUUID=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return c(this,(function(a){switch(a.label){case 0:return t=w.formatQuery("1800 080046 f0030103 23 ff 1001 %w",e),[4,this.sendQuery(t)];case 1:return n=a.sent(),r=w.scanQuery(n,"1800 080046 f0030103 23 00 1001 %?%? %*"),[2,String.fromCharCode.apply(String,f(r[0]))]}}))}))},e.maxInterimReadAttempts=3,e.interimResponseRetryIntervalInMs=100,e}();function D(e,t,n){void 0===n&&(n=new Uint8Array([0,0,0,0,0,0,0,0]));var r=e.subarray(0,8),a=t.subarray(0,t.length-8),i=t.subarray(t.length-8,t.length),o=S.default.DES.encrypt(S.default.lib.WordArray.create(a),S.default.lib.WordArray.create(r),{mode:S.default.mode.CBC,iv:S.default.lib.WordArray.create(n)}),c=S.default.enc.Hex.stringify(o.ciphertext);c=c.substring(0,c.length-16);var l=S.default.TripleDES.encrypt(S.default.lib.WordArray.create(i),S.default.lib.WordArray.create(e),{mode:S.default.mode.CBC,iv:S.default.enc.Hex.parse(c)});return S.default.enc.Hex.stringify(l.ciphertext).substring(0,16)}t.NetMDInterface=T,t.retailmac=D;var O=((a={})[b.pcm]=g.spStereo,a[b.lp2]=g.lp2,a[b.l105kbps]=g.lp2,a[b.lp4]=g.lp4,a),M=function(){function e(){}return e.prototype.getRootKey=function(){return new Uint8Array([18,52,86,120,154,188,222,240,15,237,203,169,135,101,67,33])},e.prototype.getEKBID=function(){return 641869378},e.prototype.getEKBDataForLeafId=function(){return[[new Uint8Array([37,69,6,77,234,202,20,249,150,189,200,164,6,194,43,129]),new Uint8Array([251,96,189,221,13,188,171,132,138,0,94,3,25,77,62,218])],9,new Uint8Array([143,43,195,82,232,108,94,211,6,220,174,24,210,243,140,127,137,181,225,133,85,161,5,234])]},e}();t.EKBOpenSource=M;var j=function(){function e(e,t,n,r,a){this.title=e,this.format=t,this.data=n,this.chunkSize=r,this.encryptPacketsIterator=a}return e.prototype.getTitle=function(){return this.title},e.prototype.getDataFormat=function(){return this.format},e.prototype.getFrameCount=function(){return this.getTotalSize()/this.getFrameSize()},e.prototype.getFrameSize=function(){return t.FrameSize[this.format]},e.prototype.getChunkSize=function(){return this.chunkSize},e.prototype.getTotalSize=function(){var e=this.getFrameSize(),t=this.data.byteLength;return t%e!==0&&(t+=e-t%e),t},e.prototype.getContentID=function(){return new Uint8Array([1,15,80,0,0,4,0,0,0,72,162,141,62,26,59,12,68,175,47,160])},e.prototype.getKEK=function(){return new Uint8Array([20,227,131,78,226,211,204,165])},e.prototype.getPackets=function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]),t=new Uint8Array([0,0,0,0,0,0,0,0]),n=S.default.lib.WordArray.create(e),r=S.default.lib.WordArray.create(this.getKEK()),a=S.default.DES.encrypt(n,r,{mode:S.default.mode.ECB}),i=S.default.lib.WordArray.create(t),o=S.default.lib.WordArray.create(this.data),c=S.default.DES.encrypt(o,a.ciphertext,{mode:S.default.mode.CBC,iv:i}),l=E.wordArrayToByteArray(c.ciphertext);return[[e,t,l=l.subarray(0,this.data.byteLength)]]},e.prototype.getPacketWorkerIterator=function(){return this.encryptPacketsIterator({kek:this.getKEK(),data:this.data,frameSize:this.getFrameSize(),chunkSize:this.chunkSize})},e.prototype.getPacketIterator=function(){return u(this,arguments,(function(){var e,t,n,r,a,i,o,l,u,d,f,p,h,m,y,v,g;return c(this,(function(c){switch(c.label){case 0:e=new Uint8Array([0,0,0,0,0,0,0,0]),t=S.default.lib.WordArray.create(e),n=S.default.lib.WordArray.create(this.getKEK()),r=S.default.lib.WordArray.random(8),(a=S.default.DES.decrypt({ciphertext:r},n,{mode:S.default.mode.ECB,padding:S.default.pad.Pkcs7})).sigBytes=8,i=E.wordArrayToByteArray(a),o=1048576,l=0,u=0,d=new Uint8Array(this.data),f=this.getFrameSize(),d.length%f!==0&&(p=f-d.length%f,d=E.concatUint8Arrays(d,new Uint8Array(Array(p).fill(0)))),h=0,c.label=1;case 1:return h<d.length?(u=l>0?o:o-24,u=Math.min(u,d.length-h),m=d.subarray(h,h+u),y=S.default.lib.WordArray.create(m),v=S.default.DES.encrypt(y,r,{mode:S.default.mode.CBC,iv:t}),g=(g=E.wordArrayToByteArray(v.ciphertext)).subarray(0,u),[4,s([i,e,g])]):[3,4];case 2:return[4,c.sent()];case 3:return c.sent(),t=S.default.lib.WordArray.create(g.subarray(g.length-8,g.length)),e=E.wordArrayToByteArray(t),h+=u,l+=1,[3,1];case 4:return[2]}}))}))},e}();t.MDTrack=j;var N=function(){function e(e,t,n){this.md=e,this.ekbobject=t,this.hexSessionKey=n}return e.prototype.init=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,i,o;return c(this,(function(c){switch(c.label){case 0:return[4,this.md.enterSecureSession()];case 1:return c.sent(),e=d(this.ekbobject.getEKBDataForLeafId(),3),t=e[0],n=e[1],r=e[2],[4,this.md.sendKeyData(k.default.BigInt(this.ekbobject.getEKBID()),t,n,r)];case 2:return c.sent(),a=new Uint8Array(Array(8).fill(0).map((function(e){return Math.round(255*Math.random())}))),[4,this.md.sessionKeyExchange(a)];case 3:return i=c.sent(),o=E.concatUint8Arrays(a,i),this.hexSessionKey=D(this.ekbobject.getRootKey(),o),[2]}}))}))},e.prototype.downloadTrack=function(e,t){return o(this,void 0,void 0,(function(){var n,r,a,i,o;return c(this,(function(c){switch(c.label){case 0:if(!this.hexSessionKey)throw new Error("Call init first!");return[4,this.md.setupDownload(e.getContentID(),e.getKEK(),this.hexSessionKey)];case 1:return c.sent(),n=e.getDataFormat(),[4,this.md.sendTrack(n,O[n],e.getFrameCount(),e.getTotalSize(),e.getPacketWorkerIterator(),this.hexSessionKey,t)];case 2:return r=d.apply(void 0,[c.sent(),3]),a=r[0],i=r[1],o=r[2],[4,this.md.cacheTOC()];case 3:return c.sent(),[4,this.md.setTrackTitle(a,e.title)];case 4:return c.sent(),[4,this.md.syncTOC()];case 5:return c.sent(),[4,this.md.commitTrack(a,this.hexSessionKey)];case 6:return c.sent(),[2,[a,i,o]]}}))}))},e.prototype.close=function(){return o(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:if(void 0===this.hexSessionKey)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.md.sessionKeyForget()];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:this.hexSessionKey=void 0,e.label=5;case 5:return[4,this.md.leaveSecureSession()];case 6:return e.sent(),[2]}}))}))},e}();t.MDSession=N},19:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(175)),r(n(177)),r(n(391)),r(n(218));var a=n(75);t.formatTimeFromFrames=a.formatTimeFromFrames},218:function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__await||function(e){return this instanceof a?(this.v=e,this):new a(e)},i=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||l(e,t)}))})}function l(e,t){try{(n=i[e](t)).value instanceof a?Promise.resolve(n.value.v).then(s,u):d(o[0][2],n)}catch(r){d(o[0][3],r)}var n}function s(e){l("next",e)}function u(e){l("throw",e)}function d(e,t){e(t),o.shift(),o.length&&l(o[0][0],o[0][1])}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=o(n(179)),l=n(75);t.getAsyncPacketIterator=function(e){var t=e.data,n=e.frameSize,o=e.kek,s=e.chunkSize;return i(this,arguments,(function(){var e,i,u,d,f,p,h,m,y,v,g,b,w,E,k,S,C,I;return r(this,(function(r){switch(r.label){case 0:e=new Uint8Array([0,0,0,0,0,0,0,0]),i=c.default.lib.WordArray.create(e),u=c.default.lib.WordArray.create(o),d=c.default.lib.WordArray.random(8),(f=c.default.DES.decrypt({ciphertext:d},u,{mode:c.default.mode.ECB,padding:c.default.pad.Pkcs7})).sigBytes=8,p=l.wordArrayToByteArray(f),h=s||1048576,m=0,y=0,(v=new Uint8Array(t)).length%n!==0&&(g=n-v.length%n,v=l.concatUint8Arrays(v,new Uint8Array(Array(g).fill(0)))),b=0,r.label=1;case 1:return b<v.length?(y=m>0?h:h-24,y=Math.min(y,v.length-b),w=v.subarray(b,b+y),E=c.default.lib.WordArray.create(w),k=c.default.DES.encrypt(E,d,{mode:c.default.mode.CBC,iv:i}),S=(S=l.wordArrayToByteArray(k.ciphertext)).subarray(0,y),C=c.default.lib.WordArray.create(S.subarray(S.length-8,S.length)),I=l.wordArrayToByteArray(i),[4,a({key:p,iv:e,data:S})]):[3,4];case 2:return[4,r.sent()];case 3:return r.sent(),i=C,e=I,b+=y,m+=1,[3,1];case 4:return[2]}}))}))}},227:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function c(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__await||function(e){return this instanceof i?(this.v=e,this):new i(e)},o=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||l(e,t)}))})}function l(e,t){try{(n=a[e](t)).value instanceof i?Promise.resolve(n.value.v).then(s,u):d(o[0][2],n)}catch(r){d(o[0][3],r)}var n}function s(e){l("next",e)}function u(e){l("throw",e)}function d(e,t){e(t),o.shift(),o.length&&l(o[0][0],o[0][1])}},c=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var l,s=n(218);(t.makeGetAsyncPacketIteratorOnWorkerThread=function(e,t){return function(n){var r=n.data,c=n.frameSize,l=n.kek,s=n.chunkSize;return o(this,arguments,(function(){var n,o,u,d,f,p,h,m,y,v;return a(this,(function(a){switch(a.label){case 0:o=function(){n.postMessage({action:"init",data:r,frameSize:c,kek:l,chunkSize:s},[r])},u=function(){n.postMessage({action:"getChunk"})},(n=e).onmessage=function(e){d(e.data)},f=0,p=r.byteLength,h=[],m=function(){var e=new Promise((function(e){d=function(n){null!==n&&(f+=n.data.byteLength,t&&t({totalBytes:p,encryptedBytes:f}),m()),e(n)}}));h.push(e),u()},o(),m(),y=0,a.label=1;case 1:return[4,i(h[y])];case 2:return null===(v=a.sent())?[3,5]:[4,i(v)];case 3:return[4,a.sent()];case 4:return a.sent(),delete h[y],y++,[3,1];case 5:return[2]}}))}))}},"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope)&&(onmessage=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r,i,o,u,d,f,p,h,m;return a(this,(function(a){switch(a.label){case 0:return t=e.data,n=t.action,r=c(t,["action"]),"init"!==n?[3,1]:(m=r.data,i=r.frameSize,o=r.kek,u=r.chunkSize,l=s.getAsyncPacketIterator({data:m,frameSize:i,kek:o,chunkSize:u}),[3,3]);case 1:return"getChunk"!==n?[3,3]:[4,l.next()];case 2:d=a.sent(),f=d.value,d.done?(postMessage(null),self.close()):(p=f.key,h=f.iv,m=f.data,postMessage({key:p,iv:h,data:m},[m.buffer])),a.label=3;case 3:return[2]}}))}))})},240:function(e,t,n){e.exports=n.p+"static/media/chrome-icon.f3b6c54c.svg"},267:function(e,t,n){e.exports=n(435)},288:function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(75),l=o(n(178)),s={b:1,w:2,d:4,q:8};t.formatQuery=function(e){for(var t,n,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];var u=[],d=null,f=Array.from(a),p=!1;try{for(var h=r(e),m=h.next();!m.done;m=h.next()){var y=m.value;if(p){p=!1;var v=f.shift();if(y in s)for(var g=l.default.BigInt(v),b=s[y]-1;b>=0;b--){var w=l.default.signedRightShift(g,l.default.BigInt(8*b));w=l.default.bitwiseAnd(w,l.default.BigInt(255)),u.push(l.default.toNumber(w))}else if("x"===y||"s"===y){var E=c.assertUint8Array(v),k=E.byteLength;"s"===y&&(k+=1),u.push(k>>8&255),u.push(255&k),u.push.apply(u,i(E)),"s"===y&&u.push(0)}else"*"===y?v instanceof Uint8Array?u.push.apply(u,i(v)):c.assert(!1,"Unexpected type for value"):c.assert(!1,"Unrecognized format char "+y)}else"%"!==y?" "!==y&&(null===d?d=y:(u.push(Number.parseInt(d+y,16)),d=null)):(c.assert(null===d,'Expected "half" to be null'),p=!0)}}catch(S){t={error:S}}finally{try{m&&!m.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}return new Uint8Array(u).buffer},t.scanQuery=function(e,t){var n,a,i,o=[],u=(i=e instanceof ArrayBuffer?Array.from(new Uint8Array(e)):e).length,d=null,f=!1;try{for(var p=r(t),h=p.next();!h.done;h=p.next()){var m=h.value;if(f){if(f=!1,"?"===m){i.shift();continue}if(m in s){for(var y=l.default.BigInt(0),v=s[m]-1;v>=0;v--){var g=l.default.BigInt(i.shift());g=l.default.leftShift(g,l.default.BigInt(8*v)),y=l.default.bitwiseOr(y,g)}o.push(y)}else if("s"===m||"x"===m){var b=i.shift()<<8|i.shift(),w=i.splice(b),E=new Uint8Array(i);i=w,o.push(E)}else if("*"===m){E=new Uint8Array(i.splice(0));o.push(E)}else{if("#"!==m)throw new Error("Unrecognized format char "+m);y=new Uint8Array(i.splice(0));o.push(y)}}else if("%"!==m){if(" "!==m)if(null===d)d=m;else{var k=i.shift(),S=Number.parseInt(d+m,16);if(S!=k){var C=u-i.length-1;throw new Error("Format and input mismatch at "+C+": expected "+S+", got "+k)}d=null}}else c.assert(null===d),f=!0}}catch(I){n={error:I}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return c.assert(0===i.length,i.length+" Bytes remaining to parse"),o},t.BCD2int=function(e){for(var t=0,n=0;0!==e;){var r=15&e;e>>>=4,t+=r*Math.pow(10,n),n+=1}return t},t.int2BCD=function(e,t){var n;if(void 0===t&&(t=1),t>4)throw new Error("Unsupported length. Max allowed is 4");if(e>Math.pow(10,2*t)-1)throw new Error("Value "+e+" cannot fit in "+t+" bytes in BCD");for(var r=0,i=0;e;)e=(n=a([Math.floor(e/10),e%10],2))[0],r|=n[1]<<4*i,i+=1;return r}},290:function(e,t){},292:function(e,t){},325:function(e,t){},326:function(e,t){},391:function(e,t,n){"use strict";var r,a,i,o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function c(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}l((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},l=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},s=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var u=n(175),d=n(177),f=n(75);t.EncodingName=((r={})[d.Encoding.sp]="sp",r[d.Encoding.lp2]="lp2",r[d.Encoding.lp4]="lp4",r),t.ChannelName=((a={})[d.Channels.mono]="mono",a[d.Channels.stereo]="stereo",a),t.Flag=((i={})[d.TrackFlag.protected]="protected",i[d.TrackFlag.unprotected]="unprotected",i),t.openPairedDevice=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return c(this,(function(a){switch(a.label){case 0:return[4,e.getDevices()];case 1:return 0===(n=a.sent()).length?[2,null]:[4,(r=new u.NetMD(n[0],0,t)).init()];case 2:return a.sent(),[2,new d.NetMDInterface(r,t)]}}))}))},t.openNewDevice=function(e,t){return o(this,void 0,void 0,(function(){var n,r,a;return c(this,(function(i){switch(i.label){case 0:n=u.DevicesIds.map((function(e){return{vendorId:e.vendorId,deviceId:e.deviceId}})),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.requestDevice({filters:n})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),[2,null];case 4:return[4,(a=new u.NetMD(r,0,t)).init()];case 5:return i.sent(),[2,new d.NetMDInterface(a,t)]}}))}))},t.listDevice=function(e){var t,n,r,a;return o(this,void 0,void 0,(function(){var i,o,l;return c(this,(function(c){switch(c.label){case 0:return i=u.DevicesIds.map((function(e){return{vendorId:e.vendorId,deviceId:e.deviceId}})),[4,e.requestDevice({filters:i})];case 1:return o=c.sent(),l=u.DevicesIds.find((function(e){return e.deviceId==o.productId&&e.vendorId===o.vendorId})),[2,{manufacturerName:(t=o.manufacturerName,null!==t&&void 0!==t?t:"unknown"),productName:(n=o.productName,null!==n&&void 0!==n?n:"unknown"),vendorId:o.vendorId,productId:o.productId,name:(a=null===(r=l)||void 0===r?void 0:r.name,null!==a&&void 0!==a?a:"unknown")}]}}))}))};var p={50687:"ready",50037:"playing",49983:"fastForward",49999:"rewind",65315:"readingTOC"};t.getDeviceStatus=function(e){return o(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,u,d,f,h;return c(this,(function(c){switch(c.label){case 0:return[4,e.getStatus()];case 1:return t=c.sent(),[4,e.getPlaybackStatus2()];case 2:return n=c.sent(),r=l([n[4],n[5]],2),a=r[0],i=r[1],o=a<<8|i,[4,e.getPosition()];case 3:return s=c.sent(),u=s?s[0]:null,d=64===t[4],"playing"!==(f=o in p?p[o]:"unknown")||d||(f="ready"),h=s?{minute:s[2],second:s[3],frame:s[4]}:null,[2,{discPresent:d,state:f,track:u,time:h}]}}))}))},t.countTracksInDisc=function(e){return e.groups.reduce((function(e,t,n){return e+t.tracks.length}),0)},t.getTracks=function(e){var t,n,r,a,i=[];try{for(var o=s(e.groups),c=o.next();!c.done;c=o.next()){var l=c.value;try{for(var u=(r=void 0,s(l.tracks)),d=u.next();!d.done;d=u.next()){var f=d.value;i.push(f)}}catch(p){r={error:p}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},t.listContent=function(e){return o(this,void 0,void 0,(function(){var t,n,r,a,i,o,u,p,h,m,y,v,g,b,w,E,k,S,C,I,x,T,D,O,M,j,N,A,P,B,_,F,z,R,Q,W;return c(this,(function(c){switch(c.label){case 0:return[4,e.getDiscFlags()];case 1:return t=c.sent(),[4,e.getDiscTitle()];case 2:return n=c.sent(),[4,e.getDiscCapacity()];case 3:return r=l.apply(void 0,[c.sent(),3]),a=r[0],i=r[1],o=r[2],[4,e.getTrackCount()];case 4:return u=c.sent(),p={title:n,writable:!!(t&d.DiscFlag.writable),writeProtected:!!(t&d.DiscFlag.writeProtected),used:f.timeToFrames(a),left:f.timeToFrames(o),total:f.timeToFrames(i),trackCount:u,groups:[]},[4,e.getTrackGroupList()];case 5:h=c.sent(),c.label=6;case 6:c.trys.push([6,21,22,23]),m=s(h.entries()),y=m.next(),c.label=7;case 7:if(y.done)return[3,20];v=l(y.value,2),g=v[0],b=l(v[1],2),w=b[0],E=b[1],k={index:g,title:w,tracks:[]},p.groups.push(k),S=[],c.label=8;case 8:c.trys.push([8,16,17,18]),Q=void 0,C=s(E.entries()),I=C.next(),c.label=9;case 9:return I.done?[3,15]:(x=l(I.value,2),x[0],T=x[1],[4,e.getTrackTitle(T)]);case 10:return D=c.sent(),[4,e.getTrackEncoding(T)];case 11:return O=l.apply(void 0,[c.sent(),2]),M=O[0],j=O[1],A=f.timeToFrames,[4,e.getTrackLength(T)];case 12:return N=A.apply(void 0,[c.sent()]),[4,e.getTrackFlags(T)];case 13:P=c.sent(),B={index:T,title:D,duration:N,channel:j,encoding:M,protected:P},S.push(B),c.label=14;case 14:return I=C.next(),[3,9];case 15:return[3,18];case 16:return _=c.sent(),Q={error:_},[3,18];case 17:try{I&&!I.done&&(W=C.return)&&W.call(C)}finally{if(Q)throw Q.error}return[7];case 18:k.tracks=k.tracks.concat(S),c.label=19;case 19:return y=m.next(),[3,7];case 20:return[3,23];case 21:return F=c.sent(),z={error:F},[3,23];case 22:try{y&&!y.done&&(R=m.return)&&R.call(m)}finally{if(z)throw z.error}return[7];case 23:return[2,p]}}))}))},t.download=function(e,t,n){return o(this,void 0,void 0,(function(){var r,a,i,o,s;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),[4,e.sessionKeyForget()];case 1:return c.sent(),[4,e.leaveSecureSession()];case 2:return c.sent(),[3,4];case 3:return c.sent(),[3,4];case 4:return[4,e.acquire()];case 5:c.sent(),c.label=6;case 6:return c.trys.push([6,8,,9]),[4,e.disableNewTrackProtection(1)];case 7:return c.sent(),[3,9];case 8:return c.sent(),[3,9];case 9:return[4,(r=new d.MDSession(e,new d.EKBOpenSource)).init()];case 10:return c.sent(),[4,r.downloadTrack(t,n)];case 11:return a=l.apply(void 0,[c.sent(),3]),i=a[0],o=a[1],s=a[2],[4,r.close()];case 12:return c.sent(),[4,e.release()];case 13:return c.sent(),[2,[i,o,s]]}}))}))}},392:function(e,t,n){e.exports=function(){return new Worker(n.p+"0aba6782ae4344385c04.worker.js")}},418:function(e,t,n){},419:function(e,t,n){},434:function(e,t,n){e.exports=function(){return new Worker(n.p+"7a2cdea617fc7c50ff57.worker.js")}},435:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(14),o=n.n(i),c=n(16),l=n(26),s=n(19),u=n(227);function d(e){return new Promise(t=>{setTimeout(t,e)})}async function f(e,t){let n=1,r=setInterval(()=>{n++,t(Math.min(100,1e3*n/e*100))},1e3);await d(e),window.clearInterval(r)}function p(e){return Object(c.d)(e,c.b)}function h(e){return`/webminidisc/beta/${e}`}function m(e,t){localStorage.setItem(e,JSON.stringify(t))}function y(e,t){let n=localStorage.getItem(e);if(null===n)return t;try{return JSON.parse(n)}catch(r){return t}}function v(e){return e.normalize("NFD").replace(/[^\x00-\x7F]/g,"")}const g={[s.Encoding.sp]:"SP",[s.Encoding.lp2]:"LP2",[s.Encoding.lp4]:"LP4"};function b(e){let t=[];if(null!==e)for(let a of e.groups)for(let e of a.tracks){var n,r;t.push({index:e.index,title:null!==(n=e.title)&&void 0!==n?n:"Unknown Title",group:null!==(r=a.title)&&void 0!==r?r:"",encoding:g[e.encoding],duration:Object(s.formatTimeFromFrames)(e.duration,!1)})}return t.sort((e,t)=>e.index-t.index),t}function w(e,t,n){const r=n.value;return n.value=async function(...e){const t=this.mutex,n=await t.acquire();try{return await r.apply(this,e)}finally{n()}},n}function E(e){return e.breakpoints.up(600+2*e.spacing(2))}function k(e){return e.breakpoints.down(600+2*e.spacing(2))}function S(e){return e.breakpoints.up(700+2*e.spacing(2))+" and (min-height: 750px)"}var C,I=n(252);const x=n(392);let T=(C=class{constructor({debug:e=!1}){if(this.netmdInterface=void 0,this.logger=void 0,this.mutex=new I.a,this.statusMonitorTimer=void 0,e){const e=(...e)=>{e&&e[0]&&e[0].method&&console.log(...e)};this.logger={debug:e,info:e,warn:e,error:e,child:()=>this.logger}}}async pair(){let e=await Object(s.openNewDevice)(navigator.usb,this.logger);return null!==e&&(this.netmdInterface=e,!0)}async connect(){let e=await Object(s.openPairedDevice)(navigator.usb,this.logger);return null!==e&&(this.netmdInterface=e,!0)}async listContent(){return await Object(s.listContent)(this.netmdInterface)}async getDeviceStatus(){return await Object(s.getDeviceStatus)(this.netmdInterface)}async getDeviceName(){return await this.netmdInterface.netMd.getDeviceName()}async finalize(){await this.netmdInterface.netMd.finalize()}async renameTrack(e,t){t=v(t),await this.netmdInterface.cacheTOC(),await this.netmdInterface.setTrackTitle(e,t),await this.netmdInterface.syncTOC()}async renameDisc(e){const t=await this.netmdInterface.getDiscTitle(),n=await this.netmdInterface._getDiscTitle(),r=n.indexOf("//")>=0,a=n.startsWith("0;");if(e===t)return;let i;i=r?a?n.replace(/^0;.*?\/\//,""!==e?`0;${e}//`:""):`0;${e}//${n}`:e,await this.netmdInterface.cacheTOC(),await this.netmdInterface.setDiscTitle(i),await this.netmdInterface.syncTOC()}async deleteTrack(e){await this.netmdInterface.eraseTrack(e),await d(100)}async wipeDisc(){await this.netmdInterface.eraseDisc()}async moveTrack(e,t){await this.netmdInterface.moveTrack(e,t)}async upload(e,t,n,r){let a=t.byteLength,i=0,o=0;function c(){r({written:i,encrypted:o,total:a})}let l=new x,d=Object(u.makeGetAsyncPacketIteratorOnWorkerThread)(l,({encryptedBytes:e})=>{o=e,c()});e=v(e);let f=new s.MDTrack(e,n,t,524288,d);await Object(s.download)(this.netmdInterface,f,({writtenBytes:e})=>{i=e,c()}),l.terminate()}async play(){await this.netmdInterface.play()}async pause(){await this.netmdInterface.pause()}async stop(){await this.netmdInterface.stop()}async next(){await this.netmdInterface.nextTrack()}async prev(){await this.netmdInterface.previousTrack()}async gotoTrack(e){await this.netmdInterface.gotoTrack(e)}async getPosition(){return await this.netmdInterface.getPosition()}},Object(l.a)(C.prototype,"listContent",[w],Object.getOwnPropertyDescriptor(C.prototype,"listContent"),C.prototype),Object(l.a)(C.prototype,"getDeviceStatus",[w],Object.getOwnPropertyDescriptor(C.prototype,"getDeviceStatus"),C.prototype),Object(l.a)(C.prototype,"getDeviceName",[w],Object.getOwnPropertyDescriptor(C.prototype,"getDeviceName"),C.prototype),Object(l.a)(C.prototype,"finalize",[w],Object.getOwnPropertyDescriptor(C.prototype,"finalize"),C.prototype),Object(l.a)(C.prototype,"renameTrack",[w],Object.getOwnPropertyDescriptor(C.prototype,"renameTrack"),C.prototype),Object(l.a)(C.prototype,"renameDisc",[w],Object.getOwnPropertyDescriptor(C.prototype,"renameDisc"),C.prototype),Object(l.a)(C.prototype,"deleteTrack",[w],Object.getOwnPropertyDescriptor(C.prototype,"deleteTrack"),C.prototype),Object(l.a)(C.prototype,"wipeDisc",[w],Object.getOwnPropertyDescriptor(C.prototype,"wipeDisc"),C.prototype),Object(l.a)(C.prototype,"moveTrack",[w],Object.getOwnPropertyDescriptor(C.prototype,"moveTrack"),C.prototype),Object(l.a)(C.prototype,"play",[w],Object.getOwnPropertyDescriptor(C.prototype,"play"),C.prototype),Object(l.a)(C.prototype,"pause",[w],Object.getOwnPropertyDescriptor(C.prototype,"pause"),C.prototype),Object(l.a)(C.prototype,"stop",[w],Object.getOwnPropertyDescriptor(C.prototype,"stop"),C.prototype),Object(l.a)(C.prototype,"next",[w],Object.getOwnPropertyDescriptor(C.prototype,"next"),C.prototype),Object(l.a)(C.prototype,"prev",[w],Object.getOwnPropertyDescriptor(C.prototype,"prev"),C.prototype),Object(l.a)(C.prototype,"gotoTrack",[w],Object.getOwnPropertyDescriptor(C.prototype,"gotoTrack"),C.prototype),Object(l.a)(C.prototype,"getPosition",[w],Object.getOwnPropertyDescriptor(C.prototype,"getPosition"),C.prototype),C);var D={},O=n(40),M=n(20),j=n(15);const N=Object(M.b)({name:"uploadDialog",initialState:{visible:!1,writtenProgress:0,encryptedProgress:0,totalProgress:1,trackTotal:1,trackConverting:0,trackCurrent:0,titleCurrent:"",titleConverting:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setWriteProgress:(e,t)=>{e.encryptedProgress=t.payload.encrypted,e.writtenProgress=t.payload.written,e.totalProgress=t.payload.total},setTrackProgress:(e,t)=>{e.trackTotal=t.payload.total,e.trackCurrent=t.payload.current,e.trackConverting=t.payload.converting,e.titleCurrent=t.payload.titleCurrent,e.titleConverting=t.payload.titleConverting}}}),{reducer:A,actions:P}=N;var B=Object(j.enableBatching)(A);const _=Object(M.b)({name:"renameDialog",initialState:{visible:!1,title:"",index:-1},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setCurrentName:(e,t)=>{e.title=t.payload},setIndex:(e,t)=>{e.index=t.payload}}}),{reducer:F,actions:z}=_;var R=Object(j.enableBatching)(F);const Q={visible:!1,error:""},W=Object(M.b)({name:"errorDialog",initialState:Q,reducers:{setVisible:(e,t)=>{e.visible=t.payload},setErrorMessage:(e,t)=>{e.error=`${t.payload}`}}}),{actions:L,reducer:U}=W;var H=Object(j.enableBatching)(U);const $=Object(M.b)({name:"panicDialog",initialState:{visible:!1,dismissed:!1},reducers:{setVisible:(e,t)=>{e.visible=t.payload},dismiss:(e,t)=>{e.visible=!1,e.dismissed=!0}}}),{actions:K,reducer:V}=$;var G=Object(j.enableBatching)(V);const J={visible:!1,format:"LP2",titleSource:y("trackTitleSource","file"),titleFormat:y("trackTitleFormat","title")},Z=Object(M.b)({name:"convertDialog",initialState:J,reducers:{setVisible:(e,t)=>{e.visible=t.payload},setFormat:(e,t)=>{e.format=t.payload},setTitleSource:(e,t)=>{e.titleSource=t.payload,m("trackTitleSource",e.titleSource)},setTitleFormat:(e,t)=>{e.titleFormat=t.payload,m("trackTitleFormat",e.titleFormat)}}}),{actions:q,reducer:X}=Z;var Y=Object(j.enableBatching)(X);const ee=Object(M.b)({name:"dumpDialog",initialState:{visible:!1,inputDeviceId:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setInputDeviceId:(e,t)=>{e.inputDeviceId=t.payload}}}),{reducer:te,actions:ne}=ee;var re=Object(j.enableBatching)(te);const ae=Object(M.b)({name:"recordDialog",initialState:{visible:!1,trackTotal:1,trackDone:0,trackCurrent:0,titleCurrent:""},reducers:{setVisible:(e,t)=>{e.visible=t.payload},setProgress:(e,t)=>{e.trackTotal=t.payload.trackTotal,e.trackDone=t.payload.trackDone,e.trackCurrent=t.payload.trackCurrent,e.titleCurrent=t.payload.titleCurrent}}}),{reducer:ie,actions:oe}=ae;var ce=Object(j.enableBatching)(ie);const le={mainView:"WELCOME",loading:!1,pairingFailed:!1,pairingMessage:"",browserSupported:!0,darkMode:y("darkMode",!1),aboutDialogVisible:!1},se=Object(M.b)({name:"app",initialState:le,reducers:{setState:(e,t)=>{e.mainView=t.payload},setLoading:(e,t)=>{e.loading=t.payload},setPairingFailed:(e,t)=>{e.pairingFailed=t.payload},setPairingMessage:(e,t)=>{e.pairingMessage=t.payload},setBrowserSupported:(e,t)=>{e.browserSupported=t.payload},setDarkMode:(e,t)=>{e.darkMode=t.payload,m("darkMode",e.darkMode)},showAboutDialog:(e,t)=>{e.aboutDialogVisible=t.payload}}}),{reducer:ue,actions:de}=se;var fe=Object(j.enableBatching)(ue);const pe=Object(M.b)({name:"main",initialState:{disc:null,deviceName:"",deviceStatus:null},reducers:{setDisc:(e,t)=>{e.disc=t.payload},setDeviceName:(e,t)=>{e.deviceName=t.payload},setDeviceStatus:(e,t)=>{e.deviceStatus=t.payload}}}),{reducer:he,actions:me}=pe;var ye=Object(j.enableBatching)(he);let ve=Object(O.c)({renameDialog:R,uploadDialog:B,errorDialog:H,panicDialog:G,convertDialog:Y,dumpDialog:re,recordDialog:ce,appState:fe,main:ye});const ge=de.setState.toString(),be=Object(M.a)({reducer:function(...e){const[t,n]=e;return n.type===ge&&"WELCOME"===n.payload?we:ve(...e)},middleware:[e=>e=>async t=>{try{await e(t)}catch(n){console.error(n),e(K.setVisible(!0))}},...Object(M.c)()]}),we=Object.freeze(be.getState());var Ee=n(499),ke=n(440),Se=n(500),Ce=n(479),Ie=n(250),xe=n(491),Te=n(228),De=n.n(Te);function Oe(e,t){return async function(n,r){switch(e){case"play":await D.netmdService.play();break;case"stop":await D.netmdService.stop();break;case"next":await D.netmdService.next();break;case"prev":await D.netmdService.prev();break;case"goto":t&&"number"===typeof t&&t>=0&&await D.netmdService.gotoTrack(t)}await d(500);try{let e=await D.netmdService.getDeviceStatus();n(me.setDeviceStatus(e))}catch(a){console.log("control: Cannot get device status")}}}function Me(){return async function(e){e(de.setLoading(!0));let t=await D.netmdService.listContent(),n=await D.netmdService.getDeviceName(),r=null;try{r=await D.netmdService.getDeviceStatus()}catch(a){console.log("listContent: Cannot get device status")}e(Object(j.batchActions)([me.setDisc(t),me.setDeviceName(n),me.setDeviceStatus(r),de.setLoading(!1)]))}}const je={SP:s.Wireformat.pcm,LP2:s.Wireformat.lp2,LP105:s.Wireformat.l105kbps,LP4:s.Wireformat.lp4};async function Ne(e,t){const n=await e.arrayBuffer();return await new Promise((e,r)=>{De.a.read(new Blob([n]),{onSuccess:n=>{var r,a,i;const o=null!==(r=n.tags.title)&&void 0!==r?r:"Unknown Title",c=null!==(a=n.tags.artist)&&void 0!==a?a:"Unknown Artist",l=null!==(i=n.tags.album)&&void 0!==i?i:"Unknown Album";switch(t){case"title":e(o);break;case"artist-title":e(`${c} - ${o}`);break;case"album-title":e(`${l} - ${o}`);break;case"artist-album-title":e(`${c} - ${l} - ${o}`)}},onError:e=>{r(e)}})})}function Ae(e,t,n,r){return async function(a,i){const{audioExportService:o,netmdService:c}=D,l=je[t];await(null===c||void 0===c?void 0:c.stop()),a(P.setVisible(!0));const u=({written:e,encrypted:t,total:n})=>{a(P.setWriteProgress({written:e,encrypted:t,total:n}))};let d={current:0,converting:0,total:e.length,titleCurrent:"",titleConverting:""};const f=()=>{a(P.setTrackProgress(d))};let p=i().main.disc,h=p?1700-Object(s.getTracks)(p).map(e=>e.title||"").reduce((e,t)=>e+t.length,0):-1;let m;h=Math.floor(h/e.length);let y="",v=1;for await(let s of async function*(e){let n=[],r=0;!function a(){if(r===e.length)return d.converting=r,d.titleConverting="",void f();let i=e[r];d.converting=r,d.titleConverting=i.name,f(),r++,n.push(new Promise(async(e,n)=>{let r;try{await o.prepare(i),r=await o.export({format:t}),a(),e({file:i,data:r})}catch(c){m=c,y=`${i.name}: Unsupported or unrecognized format`,n(c)}}))}();let a=0;for(;a<n.length;)yield await n[a],delete n[a],a++}(e)){const{file:e,data:t}=s;let a=e.name;if("media"===n)try{a=await Ne(e,r)}catch(b){console.error(b)}const i=a.lastIndexOf(".");i>0&&(a=a.substring(0,i)),h>-1&&(a=a.substring(0,h)),d.current=v++,d.titleCurrent=a,f(),u({written:0,encrypted:0,total:100});try{await(null===c||void 0===c?void 0:c.upload(a,t,l,u))}catch(b){m=b,y=`${e.name}: Error uploading to device`;break}}let g=[P.setVisible(!1)];m&&(console.error(m),g=g.concat([L.setVisible(!0),L.setErrorMessage(y)])),a(Object(j.batchActions)(g)),Me()(a)}}var Pe=n(478),Be=n(72),_e=n(485),Fe=n(486),ze=n(505),Re=n(476),Qe=n(470),We=n(477),Le=n(474),Ue=n(475),He=n(473),$e=n(469);const Ke=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Ve=e=>{const t=Object(c.c)();let n=p(e=>e.appState.aboutDialogVisible);return a.a.createElement(Qe.a,{open:n,maxWidth:"sm",fullWidth:!0,TransitionComponent:Ke,"aria-labelledby":"about-dialog-slide-title"},a.a.createElement(He.a,{id:"about-dialog-slide-title"},"About Web MiniDisc"),a.a.createElement(Le.a,null,a.a.createElement(Ue.a,null,"Web MiniDisc has been made possible by"),a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://www.ffmpeg.org/",target:"_blank"},"FFmpeg")," ","and"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://github.com/ffmpegjs/FFmpeg",target:"_blank"},"ffmpegjs"),", to read your audio files (wav, mp3, ogg, mp4, etc...)."),a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://github.com/dcherednik/atracdenc/",target:"_blank"},"Atracdenc"),", to support atrac3 encoding (lp2, lp4 audio formats)."),a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://emscripten.org/",target:"_blank"},"Emscripten"),", to run both FFmpeg and Atracdenc in the browser."),a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://github.com/cybercase/netmd-js",target:"_blank"},"netmd-js"),", to send commands to NetMD devices using Javascript."),a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://github.com/glaubitz/linux-minidisc",target:"_blank"},"linux-minidisc"),", to make the netmd-js project possible."),a.a.createElement("li",null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://material-ui.com/",target:"_blank"},"material-ui"),", to build the user interface.")),a.a.createElement(Ue.a,null,"Attribution"),a.a.createElement("ul",null,a.a.createElement("li",null,"MiniDisc logo from"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://en.wikipedia.org/wiki/MiniDisc",target:"_blank"},"https://en.wikipedia.org/wiki/MiniDisc")),a.a.createElement("li",null,"MiniDisc icon from"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://www.deviantart.com/blinkybill/art/Sony-MiniDisc-Plastic-Icon-473812540",target:"_blank"},"http://fav.me/d7u3g3g")))),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:()=>{t(de.showAboutDialog(!1))}},"Close")))};var Ge=n(482),Je=n(253),Ze=n(506),qe=n(239),Xe=n.n(qe),Ye=n(480),et=n(481),tt=n(232),nt=n.n(tt),rt=n(122),at=n.n(rt),it=n(238),ot=n.n(it),ct=n(233),lt=n.n(ct),st=n(234),ut=n.n(st),dt=n(237),ft=n.n(dt),pt=n(236),ht=n.n(pt),mt=n(235),yt=n.n(mt);const vt=Object(Ce.a)(e=>({listItemIcon:{minWidth:e.spacing(5)}})),gt=function(){const e=vt(),t=Object(c.c)();let{mainView:n,darkMode:i}=p(e=>e.appState),o=p(e=>{var t,n;return null!==(t=null===(n=e.main.disc)||void 0===n?void 0:n.title)&&void 0!==t?t:""});const l=a.a.useRef(null),[s,u]=a.a.useState(null),d=Boolean(s),f=Object(r.useCallback)(e=>{u(e.currentTarget)},[u]),h=Object(r.useCallback)(()=>{t(de.setDarkMode(!i))},[t,i]),m=Object(r.useCallback)(()=>{u(null)},[u]),y=Object(r.useCallback)(()=>{t((async function(e){if(!window.confirm("Proceed with Wipe Disc? This operation cannot be undone."))return;const{netmdService:t}=D;e(de.setLoading(!0)),await t.wipeDisc(),Me()(e)})),m()},[t,m]),v=Object(r.useCallback)(()=>{t(Me()),m()},[t,m]),g=Object(r.useCallback)(()=>{t(Object(j.batchActions)([z.setVisible(!0),z.setCurrentName(o),z.setIndex(-1)])),m()},[t,m]),b=Object(r.useCallback)(()=>{t(de.setState("WELCOME")),m()},[t,m]),w=Object(r.useCallback)(()=>{t(de.showAboutDialog(!0)),m()},[t,m]),E=Object(r.useCallback)(e=>{var t;(e.stopPropagation(),e.target!==l.current)&&(null===(t=l.current)||void 0===t||t.click());m()},[m]),k=[];return"MAIN"===n&&(k.push(a.a.createElement(Ze.a,{key:"update",onClick:v},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(nt.a,{fontSize:"small"})),a.a.createElement(et.a,null,"Reload TOC"))),k.push(a.a.createElement(Ze.a,{key:"title",onClick:g},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(at.a,{fontSize:"small"})),a.a.createElement(et.a,null,"Rename Disc"))),k.push(a.a.createElement(Ze.a,{key:"wipe",onClick:y},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(lt.a,{fontSize:"small"})),a.a.createElement(et.a,null,"Wipe Disc"))),k.push(a.a.createElement(Ze.a,{key:"exit",onClick:b},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(ut.a,{fontSize:"small"})),a.a.createElement(et.a,null,"Exit")))),k.push(a.a.createElement(Ze.a,{key:"darkMode",onClick:h},a.a.createElement(Ye.a,{className:e.listItemIcon},i?a.a.createElement(yt.a,{fontSize:"small"}):a.a.createElement(ht.a,{fontSize:"small"})),a.a.createElement(et.a,null,"Dark Mode"))),k.push(a.a.createElement(Ze.a,{key:"about",onClick:w},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(ft.a,{fontSize:"small"})),a.a.createElement(et.a,null,"About"))),k.push(a.a.createElement(Ze.a,{key:"github",onClick:E},a.a.createElement(Ye.a,{className:e.listItemIcon},a.a.createElement(ot.a,{fontSize:"small"})),a.a.createElement(et.a,null,a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"https://github.com/cybercase/webminidisc",target:"_blank",ref:l,onClick:E},"Fork me on GitHub")))),a.a.createElement(a.a.Fragment,null,a.a.createElement(Ge.a,{"aria-label":"actions","aria-controls":"actions-menu","aria-haspopup":"true",onClick:f},a.a.createElement(Xe.a,null)),a.a.createElement(Je.a,{id:"actions-menu",anchorEl:s,keepMounted:!0,open:d,onClose:m},k))};var bt=n(240),wt=n.n(bt);const Et=Object(Ce.a)(e=>({main:{position:"relative",flex:"1 1 auto",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},button:{marginTop:e.spacing(3),minWidth:150},spacing:{marginTop:e.spacing(1)},chromeLogo:{marginTop:e.spacing(1),width:96,height:96},why:{alignSelf:"flex-start",marginTop:e.spacing(3)},headBox:{display:"flex",justifyContent:"space-between"}})),kt=e=>{const t=Et(),n=Object(c.c)(),{browserSupported:i,pairingFailed:o,pairingMessage:l}=p(e=>e.appState);l.toLowerCase().match(/denied/);const[s,u]=Object(r.useState)(!1);return a.a.createElement(a.a.Fragment,null,a.a.createElement(ze.a,{className:t.headBox},a.a.createElement(Be.a,{component:"h1",variant:"h4"},"Web MiniDisc"),a.a.createElement(gt,null)),a.a.createElement(Be.a,{component:"h2",variant:"body2"},"Brings NetMD Devices to the Web"),a.a.createElement(ze.a,{className:t.main},i?a.a.createElement(a.a.Fragment,null,a.a.createElement(Be.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"Press the button to connect to a NetMD device"),a.a.createElement(Pe.a,{variant:"contained",color:"primary",onClick:()=>n((async function(e,t){e(de.setPairingFailed(!1)),await D.audioExportService.init();try{if(await D.netmdService.connect())return void e(de.setState("MAIN"))}catch(n){console.error(n)}try{if(await D.netmdService.pair())return void e(de.setState("MAIN"));e(Object(j.batchActions)([de.setPairingMessage("Connection Failed"),de.setPairingFailed(!0)]))}catch(n){console.error(n);let t=n.message;e(Object(j.batchActions)([de.setPairingMessage(t),de.setPairingFailed(!0)]))}})),className:t.button},"Connect"),a.a.createElement(_e.a,{error:!0,className:t.spacing,style:{visibility:o?"visible":"hidden"}},a.a.createElement(Fe.a,null,l))):a.a.createElement(a.a.Fragment,null,a.a.createElement(Be.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"This Web browser is not supported.\xa0",a.a.createElement(Re.a,{rel:"noopener noreferrer",href:"#",onClick:e=>{e.preventDefault(),u(!0)}},"Learn Why")),a.a.createElement(Re.a,{rel:"noopener noreferrer",target:"_blank",href:"https://www.google.com/chrome/"},a.a.createElement("img",{alt:"Chrome Logo",src:wt.a,className:t.chromeLogo})),a.a.createElement(Be.a,{component:"h2",variant:"subtitle1",align:"center",className:t.spacing},"Try using"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",target:"_blank",href:"https://www.google.com/chrome/"},"Chrome")," ","instead"),s?a.a.createElement(a.a.Fragment,null,a.a.createElement(Be.a,{component:"p",variant:"body2",className:t.why},"Web MiniDisc requires a browser that supports both"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",target:"_blank",href:"https://wicg.github.io/webusb/"},"WebUSB")," ","and"," ",a.a.createElement(Re.a,{rel:"noopener noreferrer",target:"_blank",href:"https://webassembly.org/"},"WebAssembly"),"."),a.a.createElement("ul",null,a.a.createElement("li",null,"WebUSB is needed to control the NetMD device via the USB connection to your computer."),a.a.createElement("li",null,"WebAssembly is used to convert the music to a MiniDisc compatible format"))):null)),a.a.createElement(Ve,null))};var St=n(3),Ct=n(251),It=n(11),xt=n(498),Tt=n(248),Dt=n.n(Tt),Ot=n(247),Mt=n.n(Ot),jt=n(493),Nt=n(497),At=n(496),Pt=n(494),Bt=n(495),_t=n(492),Ft=n(503),zt=n(504);const Rt=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Qt=e=>{let t=Object(c.c)(),n=p(e=>e.renameDialog.visible),r=p(e=>e.renameDialog.title),i=p(e=>e.renameDialog.index);const o=i<0?"Disc":"Track",l=()=>{t(z.setVisible(!1))},s=()=>{t(i<0?function({newName:e}){return async function(t){const{netmdService:n}=D;await n.renameDisc(e),t(z.setVisible(!1)),Me()(t)}}({newName:r}):function({index:e,newName:t}){return async function(n){const{netmdService:r}=D;n(z.setVisible(!1));try{await r.renameTrack(e,t)}catch(a){console.error(a),n(Object(j.batchActions)([L.setVisible(!0),L.setErrorMessage("Rename failed.")]))}Me()(n)}}({index:i,newName:r}))};return a.a.createElement(Qe.a,{open:n,onClose:l,maxWidth:"sm",fullWidth:!0,TransitionComponent:Rt,"aria-labelledby":"rename-dialog-title"},a.a.createElement(He.a,{id:"rename-dialog-title"},"Rename ",o),a.a.createElement(Le.a,null,a.a.createElement(zt.a,{autoFocus:!0,id:"name",label:`${o} Name`,type:"text",fullWidth:!0,value:r,onKeyDown:e=>{"Enter"===e.key&&s()},onChange:e=>{t(z.setCurrentName(e.target.value.substring(0,120)))}})),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:l},"Cancel"),a.a.createElement(Pe.a,{color:"primary",onClick:s},"Rename")))};var Wt=n(489);const Lt=Object(Ce.a)(e=>({progressPerc:{marginTop:e.spacing(1)},progressBar:{marginTop:e.spacing(3)},uploadLabel:{marginTop:e.spacing(3)}})),Ut=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Ht=e=>{const t=Lt();let{visible:n,writtenProgress:r,encryptedProgress:i,totalProgress:o,trackTotal:c,trackCurrent:l,trackConverting:s,titleCurrent:u,titleConverting:d}=p(e=>e.uploadDialog),f=Math.floor(r/o*100),h=Math.floor(i/o*100),m=Math.floor(s/c*100);return a.a.createElement(Qe.a,{open:n,maxWidth:"sm",fullWidth:!0,TransitionComponent:Ut,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},a.a.createElement(He.a,{id:"alert-dialog-slide-title"},"Recording..."),a.a.createElement(Le.a,null,a.a.createElement(Ue.a,{id:"alert-dialog-slide-description"},100===m&&s===c?"Conversion completed":`Converting ${s+1} of ${c}: ${d}`),a.a.createElement(Wt.a,{className:t.progressBar,variant:0===m?"indeterminate":"determinate",color:"primary",value:m}),a.a.createElement(ze.a,{className:t.progressPerc},m,"%"),a.a.createElement(Ue.a,{id:"alert-dialog-slide-description",className:t.uploadLabel},"Uploading ",l," of ",c,": ",u),a.a.createElement(Wt.a,{className:t.progressBar,variant:"buffer",color:"secondary",value:f,valueBuffer:h}),a.a.createElement(ze.a,{className:t.progressPerc},f,"%")),a.a.createElement(We.a,null))},$t=Object(Ce.a)(e=>({progressPerc:{marginTop:e.spacing(1)},progressBar:{marginTop:e.spacing(3)}})),Kt=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Vt=e=>{const t=$t();let{visible:n,trackTotal:r,trackDone:i,trackCurrent:o,titleCurrent:c}=p(e=>e.recordDialog),l=Math.round(o);return a.a.createElement(Qe.a,{open:n,maxWidth:"sm",fullWidth:!0,TransitionComponent:Kt,"aria-labelledby":"record-dialog-slide-title","aria-describedby":"record-dialog-slide-description"},a.a.createElement(He.a,{id:"record-dialog-slide-title"},"Recording..."),a.a.createElement(Le.a,null,a.a.createElement(Ue.a,{id:"record-dialog-slide-description"},`Recording track ${i+1} of ${r}: ${c}`),a.a.createElement(Wt.a,{className:t.progressBar,variant:o>=0?"determinate":"indeterminate",color:"primary",value:l}),a.a.createElement(ze.a,{className:t.progressPerc},l>=0?`${l}%`:"")),a.a.createElement(We.a,null))},Gt=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Jt=e=>{const t=Object(c.c)();let{visible:n,error:i}=p(e=>e.errorDialog);const o=Object(r.useCallback)(()=>{t(L.setVisible(!1))},[t]);return a.a.createElement(Qe.a,{open:n,maxWidth:"sm",fullWidth:!0,TransitionComponent:Gt,"aria-labelledby":"error-dialog-slide-title","aria-describedby":"error-dialog-slide-description"},a.a.createElement(He.a,{id:"alert-dialog-slide-title"},"Error"),a.a.createElement(Le.a,null,a.a.createElement(Ue.a,{id:"alert-dialog-slide-description"},i)),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:o},"Close")))},Zt=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),qt=e=>{const t=Object(c.c)();let{visible:n,dismissed:i}=p(e=>e.panicDialog);const o=Object(r.useCallback)(()=>{window.location.reload()},[]),l=Object(r.useCallback)(()=>{t(K.dismiss())},[t]);return a.a.createElement(Qe.a,{open:n&&!i,maxWidth:"sm",fullWidth:!0,scroll:"paper",TransitionComponent:Zt,"aria-labelledby":"error-dialog-slide-title","aria-describedby":"error-dialog-slide-description"},a.a.createElement(He.a,{id:"alert-dialog-slide-title"},"Oops\u2026 Something unexpected happened."),a.a.createElement(Le.a,null,a.a.createElement(Be.a,{color:"textSecondary",variant:"body1",component:"div"},"Try to restart the app. If the error persists, try the followings:",a.a.createElement("ol",null,a.a.createElement("li",null,"Use your browser in incognito mode."),a.a.createElement("li",null,"Use a blank MiniDisc."),a.a.createElement("li",null,"Try to use Web MiniDisc on another computer.")),"If this does not solve the error, your unit might not be supported yet or you have encountered a bug. The full error is reported in the JS console.")),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:l,size:"small"},"Ignore and Continue"),a.a.createElement(Pe.a,{onClick:o,color:"primary"},"Restart the App")))};var Xt=n(490),Yt=n(508),en=n(502),tn=n(487);const nn=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),rn=Object(Ce.a)(e=>({container:{display:"flex",flexDirection:"row"},formControl:{minWidth:60},toggleButton:{minWidth:40},dialogContent:{display:"flex",flexWrap:"wrap",justifyContent:"space-between"},rightBlock:{display:"flex",flexDirection:"column"},titleFormControl:{marginTop:e.spacing(1)}})),an=e=>{const t=Object(c.c)(),n=rn();let{visible:i,format:o,titleSource:l,titleFormat:s}=p(e=>e.convertDialog);const u=Object(r.useCallback)(()=>{t(q.setVisible(!1))},[t]),d=Object(r.useCallback)((e,n)=>{null!==n&&t(q.setFormat(n))},[t]),f=Object(r.useCallback)((e,n)=>{null!==n&&t(q.setTitleSource(n))},[t]),h=Object(r.useCallback)(e=>{t(q.setTitleFormat(e.target.value))},[t]),m=Object(r.useCallback)(()=>{u(),t(Ae(e.files,o,l,s))},[t,e,o,l,s]);return a.a.createElement(Qe.a,{open:i,maxWidth:"xs",fullWidth:!0,TransitionComponent:nn,"aria-labelledby":"convert-dialog-slide-title","aria-describedby":"convert-dialog-slide-description"},a.a.createElement(He.a,{id:"convert-dialog-slide-title"},"Upload Settings"),a.a.createElement(Le.a,{className:n.dialogContent},a.a.createElement(_e.a,null,a.a.createElement(Be.a,{component:"label",variant:"caption",color:"textSecondary"},"Recording Mode"),a.a.createElement(Yt.a,{value:o,exclusive:!0,onChange:d,size:"small"},a.a.createElement(Xt.a,{className:n.toggleButton,value:"SP"},"SP"),a.a.createElement(Xt.a,{className:n.toggleButton,value:"LP2"},"LP2"),a.a.createElement(Xt.a,{className:n.toggleButton,value:"LP4"},"LP4"))),a.a.createElement("div",{className:n.rightBlock},a.a.createElement(_e.a,{className:n.formControl},a.a.createElement(Be.a,{component:"label",variant:"caption",color:"textSecondary"},"Track title"),a.a.createElement(Yt.a,{value:l,exclusive:!0,onChange:f,size:"small"},a.a.createElement(Xt.a,{className:n.toggleButton,value:"file"},"Filename"),a.a.createElement(Xt.a,{className:n.toggleButton,value:"media"},"Media tags"))),"media"===l?a.a.createElement(_e.a,{className:n.titleFormControl},a.a.createElement(en.a,{value:s,color:"secondary",input:a.a.createElement(tn.a,null),onChange:h},a.a.createElement(Ze.a,{value:"title"},"Title"),a.a.createElement(Ze.a,{value:"album-title"},"Album - Title"),a.a.createElement(Ze.a,{value:"artist-title"},"Artist - Title"),a.a.createElement(Ze.a,{value:"artist-album-title"},"Artist - Album - Title"))):null)),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:u},"Cancel"),a.a.createElement(Pe.a,{onClick:m},"Ok")))};var on=n(243),cn=n.n(on),ln=n(244),sn=n.n(ln),un=n(245),dn=n.n(un),fn=n(242),pn=n.n(fn);function hn(){return(hn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var mn=a.a.createElement("g",{fill:"#000",fillRule:"evenodd"},a.a.createElement("g",{fillRule:"nonzero"},a.a.createElement("path",{d:"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z"})),a.a.createElement("path",{d:"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z"}));const yn=({svgRef:e,title:t,...n})=>a.a.createElement("svg",hn({width:98,height:52,viewBox:"0 0 98 52",ref:e},n),t?a.a.createElement("title",null,t):null,mn),vn=a.a.forwardRef((e,t)=>a.a.createElement(yn,hn({svgRef:t},e)));n.p;function gn(){return(gn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var bn=a.a.createElement("g",{fill:"#000",fillRule:"evenodd"},a.a.createElement("g",{fillRule:"nonzero"},a.a.createElement("path",{d:"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z"})),a.a.createElement("path",{d:"M36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z"}));const wn=({svgRef:e,title:t,...n})=>a.a.createElement("svg",gn({width:98,height:52,viewBox:"0 0 98 52",ref:e},n),t?a.a.createElement("title",null,t):null,bn),En=a.a.forwardRef((e,t)=>a.a.createElement(wn,gn({svgRef:t},e)));n.p;function kn(){return(kn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Sn=a.a.createElement("g",{fill:"#000",fillRule:"evenodd"},a.a.createElement("g",{fillRule:"nonzero"},a.a.createElement("path",{d:"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z"})),a.a.createElement("path",{d:"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45z"}));const Cn=({svgRef:e,title:t,...n})=>a.a.createElement("svg",kn({width:98,height:52,viewBox:"0 0 98 52",ref:e},n),t?a.a.createElement("title",null,t):null,Sn),In=a.a.forwardRef((e,t)=>a.a.createElement(Cn,kn({svgRef:t},e)));n.p;function xn(){return(xn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Tn=a.a.createElement("g",{fill:"#000",fillRule:"evenodd"},a.a.createElement("g",{fillRule:"nonzero"},a.a.createElement("path",{d:"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z"})),a.a.createElement("path",{d:"M61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362z"}));const Dn=({svgRef:e,title:t,...n})=>a.a.createElement("svg",xn({width:98,height:52,viewBox:"0 0 98 52",ref:e},n),t?a.a.createElement("title",null,t):null,Tn),On=a.a.forwardRef((e,t)=>a.a.createElement(Dn,xn({svgRef:t},e)));n.p;const Mn=[vn,En,In,On],jn=Object(Ce.a)(e=>({"@keyframes scrollLeft":{from:{transform:"translateX(0%)"},to:{}},container:{display:"flex",flex:"1 1 auto",[k(e)]:{flexWrap:"wrap"}},lcd:{flex:"1 1 auto",position:"relative",marginLeft:e.spacing(1.5),marginRight:e.spacing(1.5),paddingLeft:e.spacing(3),paddingRight:e.spacing(3),borderRadius:e.spacing(3),backgroundColor:e.palette.background.default,minWidth:150,height:48,[k(e)]:{marginLeft:0,marginRight:e.spacing(2)}},lcdText:{overflow:"hidden",position:"relative",width:"calc(100% - 40px)",left:40,height:"100%",fontFamily:"LCDDot"},lcdDisc:{position:"absolute",top:0,left:20},lcdDiscIcon:{width:28,height:48,"& g":{fill:e.palette.action.active}},scrollingStatusMessage:{position:"absolute",width:"100%",whiteSpace:"nowrap",animationName:"$scrollLeft",animationTimingFunction:"linear",animationIterationCount:"1",top:15,left:1},statusMessage:{position:"absolute",width:"100%",whiteSpace:"nowrap",top:15,left:1},button:{}})),Nn=()=>{var e,t,n;const i=Object(c.c)(),o=p(e=>e.main.deviceStatus),l=p(e=>e.main.disc),s=jn(),u=Object(r.useCallback)(()=>{i(Oe("prev"))},[i]),d=Object(r.useCallback)(()=>{i(Oe("play"))},[i]),f=Object(r.useCallback)(()=>{i(Oe("stop"))},[i]),h=Object(r.useCallback)(()=>{i(Oe("next"))},[i]);let m="",y=null!==(e=null===o||void 0===o?void 0:o.track)&&void 0!==e?e:null,v=null!==(t=null===o||void 0===o?void 0:o.state)&&void 0!==t?t:null,g=null!==(n=null===o||void 0===o?void 0:o.discPresent)&&void 0!==n&&n;const w=b(l);g?"readingTOC"===v?m="READING TOC":0===w.length?m="BLANKDISC":o&&null!==o.track&&(m=`${o.track+1} - `+w[o.track].title):m="";const[E,k]=Object(r.useState)(0),[S,C]=Object(r.useState)(0),[I,x]=Object(r.useState)(0),T=Object(r.useRef)(null),D=Object(r.useRef)(null);Object(r.useEffect)(()=>(clearTimeout(T.current),k(0),T.current=setTimeout(()=>{(()=>{var e,t,n;const r=D.current,a=null!==(e=null===r||void 0===r?void 0:r.scrollWidth)&&void 0!==e?e:0,i=null!==(t=null===r||void 0===r?void 0:null===(n=r.parentElement)||void 0===n?void 0:n.offsetWidth)&&void 0!==t?t:0,o=a>i?a/20:0;k(a>i?100*a/i:0),C(o),o>0&&(T.current=setTimeout(()=>{k(0)},1e3*o+500))})()},2e3),()=>{clearTimeout(T.current)}),[y,v,m]);const O=Object(r.useRef)(null);Object(r.useEffect)(()=>(clearInterval(O.current),"playing"===v||"readingTOC"===v?O.current=setInterval(()=>{x(1+I%(Mn.length-1))},600):x(0),()=>{clearInterval(O.current)}),[v,I]);const M=Mn[I];return a.a.createElement(ze.a,{className:s.container},a.a.createElement(Ge.a,{"aria-label":"prev",onClick:u,className:s.button},a.a.createElement(pn.a,null)),a.a.createElement(Ge.a,{"aria-label":"play",onClick:d,className:s.button},a.a.createElement(cn.a,null)),a.a.createElement(Ge.a,{"aria-label":"stop",onClick:f,className:s.button},a.a.createElement(sn.a,null)),a.a.createElement(Ge.a,{"aria-label":"next",onClick:h,className:s.button},a.a.createElement(dn.a,null)),a.a.createElement("div",{className:s.lcd},a.a.createElement("div",{className:s.lcdText},a.a.createElement("span",{className:E?s.scrollingStatusMessage:s.statusMessage,ref:D,style:m&&E>0?{animationDuration:`${S}s`,transform:`translate(-${E}%)`}:{}},m)),a.a.createElement("div",{className:s.lcdDisc},g&&a.a.createElement(M,{className:s.lcdDiscIcon}))))},An=a.a.forwardRef((function(e,t){return a.a.createElement($e.a,Object.assign({direction:"up",ref:t},e))})),Pn=Object(Ce.a)(e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between",marginRight:-e.spacing(2),flexFlow:"wrap"},formControl:{minWidth:120},selectEmpty:{marginTop:e.spacing(2)},head:{textShadow:"0px 0px 12px rgba(150, 150, 150, 1)",fontSize:e.typography.h2.fontSize,textAlign:"center",marginBottom:e.spacing(2)}})),Bn=({trackIndexes:e})=>{const t=Object(c.c)(),n=Pn(),[i,o]=Object(r.useState)([]),[l,u]=Object(r.useState)("");let{visible:h}=p(e=>e.dumpDialog);const m=Object(r.useCallback)(()=>{var e;u(""),null===(e=D.mediaRecorderService)||void 0===e||e.stopTestInput(),t(ne.setVisible(!1))},[t]),y=Object(r.useCallback)(e=>{var t,n;const r=e.target.value;u(r),null===(t=D.mediaRecorderService)||void 0===t||t.stopTestInput(),null===(n=D.mediaRecorderService)||void 0===n||n.playTestInput(r)},[u]),v=Object(r.useCallback)(()=>{var n,r;t((n=e,r=l,async function(e,t){e(Object(j.batchActions)([oe.setVisible(!0),oe.setProgress({trackTotal:n.length,trackDone:0,trackCurrent:0,titleCurrent:""})]));let a=t().main.disc,i=Object(s.getTracks)(a).filter(e=>n.indexOf(e.index)>=0);const{netmdService:o,mediaRecorderService:c}=D;await D.netmdService.stop();for(let[n,s]of i.entries()){var l;e(oe.setProgress({trackTotal:i.length,trackDone:n,trackCurrent:-1,titleCurrent:null!==(l=s.title)&&void 0!==l?l:""})),await o.gotoTrack(s.index),await o.play(),console.log("Waiting for track to be ready to play");let t=await o.getPosition(),a=[s.index,0,0,1];for(;null===t||!a.every((e,n)=>a[n]===t[n]);)await d(250),t=await o.getPosition();await o.pause(),await(null===o||void 0===o?void 0:o.gotoTrack(s.index)),console.log("Track is ready to play"),await(null===c||void 0===c?void 0:c.initStream(r)),await(null===c||void 0===c?void 0:c.startRecording()),await o.play();let u=s.duration/512;await f(1e3*u,t=>{var r;e(oe.setProgress({trackTotal:i.length,trackDone:n,trackCurrent:t,titleCurrent:null!==(r=s.title)&&void 0!==r?r:""}))}),await(null===c||void 0===c?void 0:c.stopRecording()),null===c||void 0===c||c.downloadRecorded(`${s.title}`),await(null===c||void 0===c?void 0:c.closeStream())}await o.stop(),e(oe.setVisible(!1))})),m()},[e,l,t,m]);return Object(r.useEffect)(()=>{h&&async function(){await navigator.mediaDevices.getUserMedia({audio:!0});let e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind).map(e=>({deviceId:e.deviceId,label:e.label}));o(e)}()},[h,o]),a.a.createElement(Qe.a,{open:h,maxWidth:"sm",fullWidth:!0,TransitionComponent:An,"aria-labelledby":"dump-dialog-slide-title","aria-describedby":"dump-dialog-slide-description"},a.a.createElement(He.a,{id:"dump-dialog-slide-title"},"Record Selected Tracks"),a.a.createElement(Le.a,null,a.a.createElement(Be.a,{component:"p",variant:"h2",className:n.head},"\ud83d\udcbb \u2b05 \ud83d\udcbd"),a.a.createElement(Be.a,{component:"p",variant:"body2"},"1. Connect your MD Player line-out to your PC audio line-in."),a.a.createElement(Be.a,{component:"p",variant:"body2"},"2. Use the controls at the bottom right to play some tracks."),a.a.createElement(Be.a,{component:"p",variant:"body2"},"3. Select the input source. You should hear the tracks playing on your PC."),a.a.createElement(Be.a,{component:"p",variant:"body2"},"4. Adjust the input gain and the line-out volume of your device."),a.a.createElement(ze.a,{className:n.container},a.a.createElement(_e.a,{className:n.formControl},a.a.createElement(en.a,{value:l,onChange:y,displayEmpty:!0,className:n.selectEmpty},a.a.createElement(Ze.a,{value:"",disabled:!0},"Input Source"),i.map(e=>a.a.createElement(Ze.a,{key:e.deviceId,value:e.deviceId},e.label))),a.a.createElement(Fe.a,null,"Input Source")),a.a.createElement(Nn,null))),a.a.createElement(We.a,null,a.a.createElement(Pe.a,{onClick:m},"Cancel"),a.a.createElement(Pe.a,{onClick:v,disabled:""===l},"Start Record")))};var _n=n(501),Fn=n(158);const zn=Object(Ce.a)(e=>({add:{position:"absolute",bottom:e.spacing(3),right:e.spacing(3),[k(e)]:{bottom:e.spacing(2)}},main:{overflowY:"auto",flex:"1 1 auto",marginBottom:e.spacing(3),outline:"none",marginLeft:e.spacing(-1),marginRight:e.spacing(-1),[E(e)]:{marginLeft:e.spacing(-2),marginRight:e.spacing(-2)}},toolbar:{marginTop:e.spacing(3),marginLeft:e.spacing(-2),marginRight:e.spacing(-2),[e.breakpoints.up(600+2*e.spacing(2))]:{marginLeft:e.spacing(-3),marginRight:e.spacing(-3)}},toolbarLabel:{flex:"1 1 100%"},toolbarHighlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(It.d)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},headBox:{display:"flex",justifyContent:"space-between"},spacing:{marginTop:e.spacing(1)},formatBadge:{...Fn.styles(e).badge,...Fn.styles(e).colorPrimary,position:"static",display:"inline-flex",border:`2px solid ${e.palette.background.paper}`,padding:"0 4px",verticalAlign:"middle",width:e.spacing(4.5),marginRight:e.spacing(.5)},titleCell:{overflow:"hidden",maxWidth:"40ch",textOverflow:"ellipsis"},durationCell:{whiteSpace:"nowrap"},durationCellTime:{verticalAlign:"middle"},indexCell:{whiteSpace:"nowrap",paddingRight:0,width:"2ch"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},remainingTimeTooltip:{textDecoration:"underline",textDecorationStyle:"dotted"}})),Rn=e=>{let t=Object(c.c)(),n=p(e=>e.main.disc),i=p(e=>e.main.deviceName);const[o,l]=a.a.useState([]),u=o.length,[d,f]=a.a.useState(null),h=Object(r.useCallback)(e=>{f(e.currentTarget)},[]),m=Object(r.useCallback)(()=>{f(null)},[]),y=Object(r.useCallback)(e=>{t(function(e,t){return async function(n){const{netmdService:r}=D;await r.moveTrack(e,t),Me()(n)}}(o[0],e)),m()},[t,o,m]),v=Object(r.useCallback)(()=>{t(ne.setVisible(!0))},[t]);Object(r.useEffect)(()=>{t(Me())},[t]),Object(r.useEffect)(()=>{l([])},[n]);let[g,w]=a.a.useState([]);const E=Object(r.useCallback)((e,n)=>{w(e),t(q.setVisible(!0))},[t]),{getRootProps:k,getInputProps:S,isDragActive:C,open:I}=Object(Ct.a)({onDrop:E,accept:["audio/*","video/mp4"],noClick:!0}),x=zn(),T=b(n),O=(e,r)=>{var a,i;let o=r,c=null!==(a=null===(i=Object(s.getTracks)(n).find(e=>e.index===o))||void 0===i?void 0:i.title)&&void 0!==a?a:"";t(Object(j.batchActions)([z.setVisible(!0),z.setCurrentName(c),z.setIndex(o)]))};return a.a.createElement(a.a.Fragment,null,a.a.createElement(ze.a,{className:x.headBox},a.a.createElement(Be.a,{component:"h1",variant:"h4"},i||"Loading..."),a.a.createElement(gt,null)),a.a.createElement(Be.a,{component:"h2",variant:"body2"},null!==n?a.a.createElement(a.a.Fragment,null,a.a.createElement("span",null,`${Object(s.formatTimeFromFrames)(n.left,!1)} left of ${Object(s.formatTimeFromFrames)(n.total,!1)} `),a.a.createElement(Ft.a,{title:a.a.createElement(a.a.Fragment,null,a.a.createElement("span",null,`${Object(s.formatTimeFromFrames)(2*n.left,!1)} left in LP2 Mode`),a.a.createElement("br",null),a.a.createElement("span",null,`${Object(s.formatTimeFromFrames)(4*n.left,!1)} left in LP4 Mode`)),arrow:!0},a.a.createElement("span",{className:x.remainingTimeTooltip},"SP Mode"))):"Loading..."),a.a.createElement(_t.a,{className:Object(St.default)(x.toolbar,{[x.toolbarHighlight]:u>0})},u>0?a.a.createElement(_n.a,{indeterminate:u>0&&u<T.length,checked:u>0,onChange:e=>{o.length<T.length?l(T.map(e=>e.index)):l([])},inputProps:{"aria-label":"select all tracks"}}):null,u>0?a.a.createElement(Be.a,{className:x.toolbarLabel,color:"inherit",variant:"subtitle1"},u," selected"):a.a.createElement(Be.a,{component:"h3",variant:"h6",className:x.toolbarLabel},(null===n||void 0===n?void 0:n.title)||"Untitled Disc"),1===u?a.a.createElement(a.a.Fragment,null,a.a.createElement(Ft.a,{title:"Move to Position"},a.a.createElement(Pe.a,{"aria-controls":"move-menu","aria-label":"Move",onClick:h},"Move")),a.a.createElement(Je.a,{id:"move-menu",anchorEl:d,open:!!d,onClose:m,PaperProps:{style:{maxHeight:300}}},Array(T.length).fill(null).map((e,t)=>a.a.createElement(Ze.a,{key:`pos-${t}`,onClick:()=>y(t)},t+1)))):null,u>0?a.a.createElement(a.a.Fragment,null,a.a.createElement(Ft.a,{title:"Record from MD"},a.a.createElement(Pe.a,{"aria-label":"Record",onClick:v},"Record"))):null,u>0?a.a.createElement(Ft.a,{title:"Delete"},a.a.createElement(Ge.a,{"aria-label":"delete",onClick:e=>{var n;t((n=o,async function(e){if(!window.confirm(`Proceed with Delete Track${1!==n.length?"s":""}? This operation cannot be undone.`))return;const{netmdService:t}=D;e(de.setLoading(!0)),(n=n.sort()).reverse();for(let r of n)await t.deleteTrack(r);Me()(e)}))}},a.a.createElement(Mt.a,null))):null,u>0?a.a.createElement(Ft.a,{title:"Rename"},a.a.createElement(Ge.a,{"aria-label":"rename",disabled:1!==u,onClick:e=>{O(0,o[0])}},a.a.createElement(at.a,null))):null),a.a.createElement(ze.a,Object.assign({className:x.main},k()),a.a.createElement("input",S()),a.a.createElement(jt.a,{size:"small"},a.a.createElement(Pt.a,null,a.a.createElement(Bt.a,null,a.a.createElement(At.a,{className:x.indexCell},"#"),a.a.createElement(At.a,null,"Title"),a.a.createElement(At.a,{align:"right"},"Duration"))),a.a.createElement(Nt.a,null,T.map(e=>a.a.createElement(Bt.a,{hover:!0,selected:o.includes(e.index),key:e.index,onDoubleClick:t=>O(0,e.index),onClick:t=>{return n=e.index,void(o.includes(n)?l(o.filter(e=>e!==n)):l([...o,n]));var n}},a.a.createElement(At.a,{className:x.indexCell},e.index+1),a.a.createElement(At.a,{className:x.titleCell,title:e.title},e.title||"No Title"),a.a.createElement(At.a,{align:"right",className:x.durationCell},a.a.createElement("span",{className:x.formatBadge},e.encoding),a.a.createElement("span",{className:x.durationCellTime},e.duration)))))),a.a.createElement(ke.a,{className:x.backdrop,open:C},"Drop your Music to Upload")),a.a.createElement(xt.a,{color:"primary","aria-label":"add",className:x.add,onClick:I},a.a.createElement(Dt.a,null)),a.a.createElement(Ht,null),a.a.createElement(Qt,null),a.a.createElement(Jt,null),a.a.createElement(an,{files:g}),a.a.createElement(Vt,null),a.a.createElement(Bn,{trackIndexes:o}),a.a.createElement(Ve,null),a.a.createElement(qt,null))};var Qn=n(436);const Wn=Object(Ce.a)(e=>({layout:{width:"auto",height:"100%",[E(e)]:{width:600,marginLeft:"auto",marginRight:"auto"},[S(e)]:{width:700}},paper:{position:"relative",display:"flex",flexDirection:"column",padding:e.spacing(2),height:"calc(100% - 20px)",[E(e)]:{marginTop:e.spacing(2),marginBottom:e.spacing(1),padding:e.spacing(3),height:600},[S(e)]:{height:700}},bottomBar:{display:"flex",alignItems:"center",[k(e)]:{flexWrap:"wrap"},marginLeft:-e.spacing(2)},copyrightTypography:{marginRight:e.spacing(1),textAlign:"center"},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},minidiscLogo:{width:48},controlsContainer:{flex:"0 0 auto",width:"100%",paddingRight:e.spacing(8),[k(e)]:{paddingLeft:0}}})),Ln=Object(Ie.a)({palette:{type:"dark",primary:{light:"#6ec6ff",main:"#2196f3",dark:"#0069c0",contrastText:"#fff"}}}),Un=Object(Ie.a)({palette:{type:"light"}});var Hn=()=>{const e=Wn();Object(c.c)();let{mainView:t,loading:n,darkMode:r}=p(e=>e.appState);return a.a.createElement(a.a.Fragment,null,a.a.createElement(xe.a,{theme:r?Ln:Un},a.a.createElement(Ee.a,null),a.a.createElement("main",{className:e.layout},a.a.createElement(Qn.a,{className:e.paper},"WELCOME"===t?a.a.createElement(kt,null):null,"MAIN"===t?a.a.createElement(Rn,null):null,a.a.createElement(ze.a,{className:e.controlsContainer},"MAIN"===t?a.a.createElement(Nn,null):null)),a.a.createElement(Be.a,{variant:"body2",color:"textSecondary",className:e.copyrightTypography},"\xa9 ",a.a.createElement(Re.a,{rel:"noopener noreferrer",color:"inherit",target:"_blank",href:"https://stefano.brilli.me/"},"Stefano Brilli")," ",(new Date).getFullYear(),".")),a.a.createElement(ke.a,{className:e.backdrop,open:n},a.a.createElement(Se.a,{color:"inherit"}))))},$n=(n(418),n(419),n(159));class Kn{constructor(e){this.worker=e,this.messageCallback=void 0,e.onmessage=this.handleMessage.bind(this)}async init(){await new Promise(e=>{this.messageCallback=e,this.worker.postMessage({action:"init"})})}async encode(e,t){return(await new Promise(n=>{this.messageCallback=n,this.worker.postMessage({action:"encode",bitrate:t,data:e},[e])})).data.result}terminate(){this.worker.terminate()}handleMessage(e){this.messageCallback(e),this.messageCallback=void 0}}if("undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){let e;onmessage=async t=>{const{action:n,...r}=t.data;if("init"===n)self.importScripts(h("atracdenc.js")),self.Module().then(t=>{e=t,self.postMessage({action:"init"}),e.setLogger&&e.setLogger((e,t)=>console.log(`${t}: ${e}`))});else if("encode"===n){const{bitrate:t,data:n}=r,a="inWavFile.wav",i="outAt3File.aea",o=new Uint8Array(n);e.FS.writeFile(`${a}`,o),e.callMain(["-e","atrac3","-i",a,"-o",i,"--bitrate",t]);let c=e.FS.stat(i).size,l=new Uint8Array(c-96),s=e.FS.open(i,"r");e.FS.read(s,l,0,l.length,96),e.FS.close(s);let u=l.buffer;self.postMessage({action:"encode",result:u},[u])}}}const Vn=n(434);var Gn=n(249),Jn=n.n(Gn);D.netmdService=new T({debug:!0}),D.audioExportService=new class{constructor(){this.ffmpegProcess=void 0,this.atracdencProcess=void 0,this.loglines=[],this.inFileName="",this.outFileNameNoExt=""}async init(){Object($n.setLogging)(!0)}async prepare(e){this.loglines=[],this.ffmpegProcess=Object($n.createWorker)({logger:e=>{this.loglines.push(e),console.log(e.action,e.message)},corePath:h("ffmpeg-core.js"),workerPath:h("worker.min.js")}),await this.ffmpegProcess.load(),this.atracdencProcess=new Kn(new Vn),await this.atracdencProcess.init();let t=e.name.split(".").slice(-1);if(0===t.length)throw new Error(`Unrecognized file format: ${e.name}`);this.inFileName=`inAudioFile.${t[0]}`,this.outFileNameNoExt="outAudioFile",await this.ffmpegProcess.write(this.inFileName,e)}async info(){await this.ffmpegProcess.transcode(this.inFileName,`${this.outFileNameNoExt}.metadata`,"-f ffmetadata");let e=/Audio:\s(.*?),/,t=/Input #0,\s(.*?),/,n=null,r=null;for(let a of this.loglines){let i=a.message.match(e);if(null===i)if(i=a.message.match(t),null===i){if(null!==n&&null!==r)break}else r=i[1];else n=i[1]}return{format:n,input:r}}async export({format:e}){let t;if("SP"===e){const e=`${this.outFileNameNoExt}.raw`;await this.ffmpegProcess.transcode(this.inFileName,e,"-f s16be -ar 44100");let{data:n}=await this.ffmpegProcess.read(e);t=n.buffer}else{const n=`${this.outFileNameNoExt}.wav`;await this.ffmpegProcess.transcode(this.inFileName,n,"-f wav -ar 44100");let{data:r}=await this.ffmpegProcess.read(n),a="0";switch(e){case"LP2":a="128";break;case"LP105":a="102";break;case"LP4":a="64"}t=await this.atracdencProcess.encode(r.buffer,a)}return this.ffmpegProcess.worker.terminate(),this.atracdencProcess.terminate(),t}},D.mediaRecorderService=new class{constructor(){this.recorder=void 0,this.stream=void 0,this.audioContext=void 0,this.analyserNode=void 0,this.gainNode=void 0}playTestInput(e){this.audioContext=new AudioContext,this.gainNode=this.audioContext.createGain(),this.analyserNode=this.audioContext.createAnalyser(),this.initStream(e).then(()=>{this.audioContext.createMediaStreamSource(this.stream).connect(this.gainNode),this.gainNode.connect(this.analyserNode),this.analyserNode.connect(this.audioContext.destination)})}stopTestInput(){var e;this.audioContext&&(null===(e=this.audioContext)||void 0===e||e.close(),delete this.audioContext,this.closeStream())}async initStream(e){const t={autoGainControl:!1,channelCount:2,deviceId:e,echoCancellation:!1,noiseSuppression:!1,sampleRate:44100,highpassFilter:!1};this.stream=await navigator.mediaDevices.getUserMedia({audio:t});const n=this.stream.getAudioTracks();n.length>0&&console.log("Record Setings:",n[0].getSettings())}async startRecording(){this.audioContext=new AudioContext;const e=this.audioContext.createMediaStreamSource(this.stream);this.recorder=new Jn.a(e,{workerPath:h("recorderWorker.js")}),this.recorder.record()}async stopRecording(){this.recorder.stop()}async closeStream(){var e;null===(e=this.stream)||void 0===e||e.getTracks().forEach(e=>e.stop())}downloadRecorded(e){this.recorder.exportWAV(t=>{let n=URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=n,r.download=`${v(e)}.wav`,r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)})}},function(){let e;window.addEventListener("beforeunload",e=>{be.getState().uploadDialog.visible&&(e.preventDefault(),e.returnValue="Warning! Recording will be interrupted")}),navigator&&navigator.usb?navigator.usb.ondisconnect=function(){be.dispatch(de.setState("WELCOME"))}:be.dispatch(de.setBrowserSupported(!1)),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t})}(),function(){let e=null,t=!1;function n(e){var n;return!t&&"MAIN"===e.appState.mainView&&!1===e.appState.loading&&"playing"===(null===(n=e.main.deviceStatus)||void 0===n?void 0:n.state)&&!1===e.convertDialog.visible&&!1===e.uploadDialog.visible&&!1===e.recordDialog.visible&&!1===e.panicDialog.visible&&!1===e.errorDialog.visible&&!1===e.dumpDialog.visible}be.subscribe((function(){const r=be.getState();!0===n(r)&&null===e?e=setInterval(async()=>{try{const e=await D.netmdService.getDeviceStatus();be.dispatch(me.setDeviceStatus(e))}catch(e){console.error(e),t=!0}},5e3):!1===n(r)&&null!==e&&(clearInterval(e),e=null)}))}(),o.a.render(a.a.createElement(c.a,{store:be},a.a.createElement(Hn,null)),document.getElementById("root"))},75:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function c(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(21),l=o(n(281));function s(e,t){if(!e)throw t=t||"no message provided",new Error("Assertion failed: "+t)}function u(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=0;n<e.byteLength;n++)if(e.getUint8(n)!==t.getUint8(n))return!1;return!0}function d(e){var t=Array(e.length);return e.forEach((function(e,n){return t[n]=String.fromCharCode(e)})),t.join("")}function f(e,t){var n=[];return t>0&&n.push(e>>>24),t>1&&n.push(e>>>16&255),t>2&&n.push(e>>>8&255),t>3&&n.push(255&e),n}function p(e,t){return(t+e).slice(-t.length)}function h(e){return l.default.encode(e,"SJIS")}t.sleep=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))},t.withTimeout=function(e,t){var n=this;return new Promise((function(i,o){return r(n,void 0,void 0,(function(){var n,r;return a(this,(function(a){switch(a.label){case 0:return n=setTimeout((function(){o(new Error("Operation timed out"))}),e),[4,t()];case 1:return r=a.sent(),clearTimeout(n),i(r),[2]}}))}))}))},t.assert=s,t.assertBigInt=function(e,t){if("bigint"===typeof e)return e;throw s(!1,"Expected BigInt type - "+t)},t.assertNumber=function(e,t){if("number"===typeof e)return e;throw s(!1,"Expected number type - "+t)},t.assertString=function(e,t){if("string"===typeof e)return e;throw s(!1,"Expected string type - "+t)},t.assertUint8Array=function(e,t){if(e instanceof Uint8Array)return e;throw s(!1,"Expected Uint8Array type - "+t)},t.stringToCharCodeArray=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},t.arrayBuffersAreEqual=function(e,t){return u(new DataView(e),new DataView(t))},t.dataViewsAreEqual=u,t.isBigEndian=function(){return 18===new Uint8Array(new Uint32Array([305419896]).buffer)[0]},t.hexEncode=function(e){for(var t="",n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t},t.arrayBufferToBinaryString=function(e){return d(new Uint8Array(e))},t.uint8arrayToBinaryString=d,t.concatUint8Arrays=function(){for(var e,t,n,r,a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var c=0;try{for(var l=i(a),s=l.next();!s.done;s=l.next()){c+=(h=s.value).length}}catch(m){e={error:m}}finally{try{s&&!s.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}var u=new Uint8Array(c),d=0;try{for(var f=i(a),p=f.next();!p.done;p=f.next()){var h=p.value;u.set(h,d),d+=h.length}}catch(y){n={error:y}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}return u},t.concatArrayBuffers=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer},t.wordArrayToByteArray=function(e,t){void 0===t&&(t=e.sigBytes);for(var n,r=new Uint8Array(t),a=0,i=0;t>0;)n=f(e.words[a],Math.min(4,t)),r.set(n,i),t-=n.length,i+=n.length,a++;return r},t.timeToFrames=function(e){return s(4===e.length),512*(60*(60*e[0]+e[1])+e[2])+e[3]},t.pad=p,t.formatTimeFromFrames=function(e,t){void 0===t&&(t=!0);var n=e%512,r=(e=(e-n)/512)%60,a=(e=(e-r)/60)%60;return p(e=(e-a)/60,"00")+":"+p(a,"00")+":"+p(r,"00")+(t?"+"+p(n,"000"):"")},t.sanitizeTrackTitle=function(e){return encodeURIComponent(e)},t.encodeToSJIS=h,t.decodeFromSJIS=function(e){return l.default.decode(c.Buffer.from(e),"SJIS")},t.getLengthAfterEncodingToSJIS=function(e){return h(e).length}}},[[267,1,2]]]);
//# sourceMappingURL=main.574941a6.chunk.js.map